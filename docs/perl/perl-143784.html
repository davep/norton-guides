





<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="generator" content="ng2web v1.1.0 (ngdb v1.1.0)">
    <link rel="stylesheet" type="text/css" href="perl-style.css">
    <title>PERL 4.0 Reference Guide » PERL » Languages</title>
    <meta name="description" content="PERL 4.0 Reference Guide">
    <link rel="prev" href="perl-141310.html">
    <link rel="next" href="perl-147931.html">
    
  </head>

  <body>

    <header>
      <nav class="box">
        <ul>
          

<li><a href="perl-about.html">About</a></li>


          

<li><a href="perl-141310.html">Previous</a></li>


          

<li><a href="perl-90961.html">Up</a></li>


          

<li><a href="perl-147931.html">Next</a></li>


        </ul>
      </nav>
    </header>

    <section>

      <nav class="menu box">
        <ul>
            <li>PERL</li>
            <ul>
              <li><a href="index.html">Commands</a></li>
              <li><a href="perl-90961.html">Languages</a></li>
              <li><a href="perl-159711.html">Command line options</a></li>
              <li><a href="perl-170094.html">Regular Expressions</a></li>
              <li><a href="perl-171332.html">Special Variables</a></li>
              <li><a href="perl-188582.html">Operators</a></li>
              <li><a href="perl-197905.html">Debugging</a></li>
              
            </ul>
            <li>Tables</li>
            <ul>
              <li><a href="perl-204383.html">ASCII Chart</a></li>
              <li><a href="perl-207014.html">Literals</a></li>
              <li><a href="perl-207867.html">Credits</a></li>
              
            </ul>
        </ul>
      </nav>

      <article class="box">
        
  
  
    <pre class="entry"><span class="line"></span><br /><span class="line">     Setuid Scripts</span><br /><span class="line"></span><br /><span class="line">     Setuid processes  are  not  supported  on  MS-DOS.  Perl  is</span><br /><span class="line">     designed  to  make it easy to write secure setuid and setgid</span><br /><span class="line">     scripts.  Unlike shells, which are based on multiple substi-</span><br /><span class="line">     tution  passes  on each line of the script, perl uses a more</span><br /><span class="line">     conventional evaluation scheme with fewer hidden  &#34;gotchas&#34;.</span><br /><span class="line">     Additionally,  since  the  language  has more built-in func-</span><br /><span class="line">     tionality, it has to rely less upon external  (and  possibly</span><br /><span class="line">     untrustworthy) programs to accomplish its purposes.</span><br /><span class="line"></span><br /><span class="line">     In an unpatched 4.2 or 4.3bsd  kernel,  setuid  scripts  are</span><br /><span class="line">     intrinsically  insecure, but this kernel feature can be dis-</span><br /><span class="line">     abled.  If it is, perl can emulate  the  setuid  and  setgid</span><br /><span class="line">     mechanism  when  it notices the otherwise useless setuid/gid</span><br /><span class="line">     bits on perl scripts.  If the kernel feature isn&#39;t disabled,</span><br /><span class="line">     perl  will  complain  loudly  that  your  setuid  script  is</span><br /><span class="line">     insecure.  You&#39;ll need to either disable the  kernel  setuid</span><br /><span class="line">     script feature, or put a C wrapper around the script.</span><br /><span class="line"></span><br /><span class="line">     When perl is executing a setuid  script,  it  takes  special</span><br /><span class="line">     precautions  to  prevent  you  from falling into any obvious</span><br /><span class="line">     traps.  (In some ways, a perl script is more secure than the</span><br /><span class="line">     corresponding   C  program.)   Any  command  line  argument,</span><br /><span class="line">     environment variable, or input is marked as  &#34;tainted&#34;,  and</span><br /><span class="line">     may not be used, directly or indirectly, in any command that</span><br /><span class="line">     invokes a subshell, or in any command that  modifies  files,</span><br /><span class="line">     directories  or  processes.  Any variable that is set within</span><br /><span class="line">     an expression that has previously referenced a tainted value</span><br /><span class="line">     also becomes tainted (even if it is logically impossible for</span><br /><span class="line">     the tainted value to influence the variable).  For example:</span><br /><span class="line"></span><br /><span class="line">          $foo = shift;            # $foo is tainted</span><br /><span class="line">          $bar = $foo,&#39;bar&#39;;       # $bar is also tainted</span><br /><span class="line">          $xxx = &lt;&gt;;               # Tainted</span><br /><span class="line">          $path = $ENV{&#39;PATH&#39;};    # Tainted, but see below</span><br /><span class="line">          $abc = &#39;abc&#39;;            # Not tainted</span><br /><span class="line"></span><br /><span class="line">          system &#34;echo $foo&#34;;      # Insecure</span><br /><span class="line">          system &#34;/bin/echo&#34;, $foo;     # Secure (doesn&#39;t use sh)</span><br /><span class="line">          system &#34;echo $bar&#34;;      # Insecure</span><br /><span class="line">          system &#34;echo $abc&#34;;      # Insecure until PATH set</span><br /><span class="line"></span><br /><span class="line">          $ENV{&#39;PATH&#39;} = &#39;/bin:/usr/bin&#39;;</span><br /><span class="line">          $ENV{&#39;IFS&#39;} = &#39;&#39; if $ENV{&#39;IFS&#39;} ne &#39;&#39;;</span><br /><span class="line"></span><br /><span class="line">          $path = $ENV{&#39;PATH&#39;};    # Not tainted</span><br /><span class="line">          system &#34;echo $abc&#34;;      # Is secure now!</span><br /><span class="line"></span><br /><span class="line">          open(FOO,&#34;$foo&#34;);        # OK</span><br /><span class="line">          open(FOO,&#34;&gt;$foo&#34;);       # Not OK</span><br /><span class="line"></span><br /><span class="line">          open(FOO,&#34;echo $foo|&#34;);  # Not OK, but...</span><br /><span class="line">          open(FOO,&#34;-|&#34;) || exec &#39;echo&#39;, $foo;    # OK</span><br /><span class="line"></span><br /><span class="line">          $zzz = `echo $foo`;      # Insecure, zzz tainted</span><br /><span class="line"></span><br /><span class="line">          unlink $abc,$foo;        # Insecure</span><br /><span class="line">          umask $foo;              # Insecure</span><br /><span class="line"></span><br /><span class="line">          exec &#34;echo $foo&#34;;        # Insecure</span><br /><span class="line">          exec &#34;echo&#34;, $foo;       # Secure (doesn&#39;t use sh)</span><br /><span class="line">          exec &#34;sh&#34;, &#39;-c&#39;, $foo;   # Considered secure, alas</span><br /><span class="line"></span><br /><span class="line">     The taintedness is associated with  each  scalar  value,  so</span><br /><span class="line">     some elements of an array can be tainted, and others not.</span><br /><span class="line"></span><br /><span class="line">     If you try to do something insecure, you will  get  a  fatal</span><br /><span class="line">     error   saying   something  like  &#34;Insecure  dependency&#34;  or</span><br /><span class="line">     &#34;Insecure PATH&#34;.  Note that you can still write an  insecure</span><br /><span class="line">     system  call or exec, but only by explicitly doing something</span><br /><span class="line">     like the last example above.  You can also bypass the taint-</span><br /><span class="line">     ing mechanism by referencing subpatterns--perl presumes that</span><br /><span class="line">     if you reference a substring using $1,  $2,  etc,  you  knew</span><br /><span class="line">     what you were doing when you wrote the pattern:</span><br /><span class="line"></span><br /><span class="line">          $ARGV[0] =~ /^-P(\w+)$/;</span><br /><span class="line">          $printer = $1;      # Not tainted</span><br /><span class="line"></span><br /><span class="line">     This is fairly secure since \w+ doesn&#39;t  match  shell  meta-</span><br /><span class="line">     characters.   Use  of  .+ would have been insecure, but perl</span><br /><span class="line">     doesn&#39;t check for that, so you must  be  careful  with  your</span><br /><span class="line">     patterns.   This  is  the ONLY mechanism for untainting user</span><br /><span class="line">     supplied filenames if you want to do file operations on them</span><br /><span class="line">     (unless you make $&gt; equal to $&lt;).</span><br /><span class="line"></span><br /><span class="line">     It&#39;s also possible to get into trouble with other operations</span><br /><span class="line">     that don&#39;t care whether they use tainted values.  Make judi-</span><br /><span class="line">     cious use of the  file  tests  in  dealing  with  any  user-</span><br /><span class="line">     supplied  filenames.  When possible, do opens and such after</span><br /><span class="line">     setting $&gt; = $&lt;.  Perl  doesn&#39;t  prevent  you  from  opening</span><br /><span class="line">     tainted  filenames for reading, so be careful what you print</span><br /><span class="line">     out.  The tainting mechanism is intended to  prevent  stupid</span><br /><span class="line">     mistakes, not to remove the need for thought.</span><br /></pre>
  
  
  


      </article>

    </section>

  </body>

</html>

