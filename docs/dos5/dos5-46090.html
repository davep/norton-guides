





<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="generator" content="ng2web v1.1.0 (ngdb v1.1.0)">
    <link rel="stylesheet" type="text/css" href="dos5-style.css">
    <title>DOS 5.0 Ref. » DOS » Functions (Int 21h)</title>
    <meta name="description" content="DOS 5.0 Ref.">
    <link rel="prev" href="dos5-45096.html">
    <link rel="next" href="dos5-50964.html">
    
  </head>

  <body>

    <header>
      <nav class="box">
        <ul>
          

<li><a href="dos5-about.html">About</a></li>


          

<li><a href="dos5-45096.html">Previous</a></li>


          

<li><a href="index.html">Up</a></li>


          

<li><a href="dos5-50964.html">Next</a></li>


        </ul>
      </nav>
    </header>

    <section>

      <nav class="menu box">
        <ul>
            <li>DOS</li>
            <ul>
              <li><a href="index.html">Functions (Int 21h)</a></li>
              <li><a href="dos5-135422.html">Multiplex (Int 2Fh)</a></li>
              <li><a href="dos5-159299.html">Interrupts 20h-28h</a></li>
              <li><a href="dos5-182062.html">Device Driver Fnx</a></li>
              <li><a href="dos5-221655.html">Structures</a></li>
              <li><a href="dos5-268064.html">Extended key codes</a></li>
              
            </ul>
        </ul>
      </nav>

      <article class="box">
        
  
  
    <pre class="entry"><span class="line"><span class="ngb">Function 4400h          Get Device Data</span></span><br /><span class="line"></span><br /><span class="line">    Returns information about a handle, such as whether it identifies</span><br /><span class="line">    a file or a device.</span><br /><span class="line"></span><br /><span class="line">        <span class="ngb">Entry</span>   AX = 4400h</span><br /><span class="line">                BX = Device or file handle</span><br /><span class="line"></span><br /><span class="line">        <span class="ngb">Return</span>  DX = Device information</span><br /><span class="line">                AX changed</span><br /><span class="line">                or</span><br /><span class="line">                AX = Error code, if CF is set</span><br /><span class="line">                     | 01h Invalid function</span><br /><span class="line">                     | 05h Access denied</span><br /><span class="line">                     | 06h Invalid handle</span><br /><span class="line"></span><br /><span class="line">    ──────────────────────────────────────────────────────────────────</span><br /><span class="line"></span><br /><span class="line">    The information returned in the DX register is:</span><br /><span class="line"></span><br /><span class="line">        <span class="ngb">Disk file (DX bit 7 = 0)</span></span><br /><span class="line">        <span class="ngb">Bit     Description</span></span><br /><span class="line">        0-5     Drive number (0 = A, 1 = B, etc.)</span><br /><span class="line">        6       1 = File has not been written to</span><br /><span class="line">        7       0 = Handle identifies a file (not a device)</span><br /><span class="line">        8-15    Zero</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">        <span class="ngb">Device (DX bit 7 = 1)</span></span><br /><span class="line">        <span class="ngb">Bit     Description</span></span><br /><span class="line">        0       1 = Console input device</span><br /><span class="line">        1       1 = Console output device</span><br /><span class="line">        2       1 = Null device</span><br /><span class="line">        3       1 = Clock device</span><br /><span class="line">        4       1 = Special device</span><br /><span class="line">        5       1 = Binary mode, 0 = ASCII mode</span><br /><span class="line">        6       0 = EOF returned if device is read</span><br /><span class="line">        7       1 = Handle identifies a device (not a file)</span><br /><span class="line">        8-15    Identical to high 8 bits of the dhAttribute field</span><br /><span class="line">                in the DeviceHeader structure for the device</span><br /><span class="line"></span><br /><span class="line">    ──────────────────────────────────────────────────────────────────</span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">Input and Output Modes</span></span><br /><span class="line">    I/O modes determine how character devices process input and</span><br /><span class="line">    output. DOS has two I/O modes: ASCII and binary (sometimes called</span><br /><span class="line">    &#34;cooked&#34; and &#34;raw&#34;, respectively).</span><br /><span class="line"></span><br /><span class="line">    The chief difference between these two modes is the way in which</span><br /><span class="line">    DOS processes control characters. In ASCII mode, DOS checks for</span><br /><span class="line">    control characters as it processes input or output for a device.</span><br /><span class="line">    If it encounters a control character, it removes the character</span><br /><span class="line">    from the input and carries out its corresponding action:</span><br /><span class="line"></span><br /><span class="line">        Ctrl-C   Passes control to the Ctrl-C exception handler.</span><br /><span class="line">                 Subsequent actions depend on the current handler;</span><br /><span class="line">                 the default handler terminates the program.</span><br /><span class="line">        Ctrl-P   Copies all subsequent input characters, up to the</span><br /><span class="line">                 next Ctrl-P, to the printer device.</span><br /><span class="line">        Ctrl-S   Suspends further output to the device. The next input</span><br /><span class="line">                 character restores output.</span><br /><span class="line">        Ctrl-Z   Marks the end of the file. Subsequent calls to Int</span><br /><span class="line">                 21h function 3Fh (Read File or Device) return zero</span><br /><span class="line">                 bytes.</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">    In ASCII mode, using function 3Fh (Read File or Device) to <span class="ngb">read</span></span><br /><span class="line">    from the standard input device, DOS reads characters from the</span><br /><span class="line">    keyboard and copies the characters to standard output. It checks</span><br /><span class="line">    for control characters (ctrl-c etc.) and for the special line</span><br /><span class="line">    editing keys (F1 thru F6, backspace, left, right, del, ins, esc,</span><br /><span class="line">    and enter); it one is found, the corresponding (editing) action is</span><br /><span class="line">    carried out and the control character/editing key code is removed</span><br /><span class="line">    from the input.</span><br /><span class="line"></span><br /><span class="line">    In binary mode, DOS reads the exact number of characters requested</span><br /><span class="line">    by the program. It does not copy characters to the screen, nor</span><br /><span class="line">    does it process editing keys and control characters. Instead, it</span><br /><span class="line">    reads all characters as input.</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">    In ASCII mode, using function 40h (Write File or Device) to <span class="ngb">write</span></span><br /><span class="line">    to the standard output device, DOS sends all characters to the</span><br /><span class="line">    screen, checks at the keyboard for control characters as it writes</span><br /><span class="line">    and, if it finds one, carries out its corresponding action. Tab</span><br /><span class="line">    characters (ASCII 09h) are expanded to space characters based on</span><br /><span class="line">    8-space tab settings. DOS continues to write characters to the</span><br /><span class="line">    screen until it has sent the requested number of characters or</span><br /><span class="line">    reached an end-of-file character (ASCII 1Ah).</span><br /><span class="line"></span><br /><span class="line">    In binary mode, DOS writes the exact number of characters</span><br /><span class="line">    requested by the program. It does not process control characters</span><br /><span class="line">    (except CR and LF characters), expand tab characters, or stop</span><br /><span class="line">    writing at an end-of-file character.</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">    By <span class="ngb">default</span>, the DOS I/O mode is ASCII. A program can determine or</span><br /><span class="line">    change the current I/O mode for a device by using functions 4400h</span><br /><span class="line">    or 4401h.</span><br /><span class="line">    The I/O mode is a property of the device handle and affects the</span><br /><span class="line">    input and output only of those programs that own the handle. Note,</span><br /><span class="line">    however, that the standard devices are shared by all programs. If</span><br /><span class="line">    a program needs to change the device attributes of a standard</span><br /><span class="line">    device, it should open the device using function 3Dh (Open File</span><br /><span class="line">    with Handle) using its device name and an appropriate access code.</span><br /><span class="line"></span><br /><span class="line">    ──────────────────────────────────────────────────────────────────</span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">Example</span></span><br /><span class="line"></span><br /><span class="line">        ; Test redirection of standard input/output</span><br /><span class="line">        ; Entry : Handle = 0 (StdIn) or 1 (StdOut)</span><br /><span class="line">        ; Exit  : cf = 1     Error on DOS call</span><br /><span class="line">        ;         else zf=0  Device is redirected</span><br /><span class="line">        ;              zf=1  Device is not redirected</span><br /><span class="line">        ; Used  : ax,bx,dx,flags</span><br /><span class="line"></span><br /><span class="line">        MACRO isDeviceRedirected Handle</span><br /><span class="line">        local ahead</span><br /><span class="line">        mov     bx,Handle       ; StdIn (Stdout)</span><br /><span class="line">        mov     ax,4400h        ; Get Device Data</span><br /><span class="line">        int     21h             ;   using DOS</span><br /><span class="line">        jc      ahead           ; cf set on error</span><br /><span class="line">        mov     al,81h + Handle ; 81h (82h)</span><br /><span class="line">        and     dl,al           ; Isolate bits 7,0 (7,1)</span><br /><span class="line">        cmp     al,dl           ; zf=1 if original device</span><br /><span class="line">        ahead:                  ;   attributes, cf=0</span><br /><span class="line">        ENDM</span><br /></pre>
  
  
  
    <nav class="seeAlso">
      <ul>
        <li>See Also:</li>
        
          <li><a href="dos5-50964.html">4401h</a></li>
        
          <li><a href="dos5-227497.html">DeviceHeader</a></li>
        
          <li><a href="dos5-258925.html">StdDevices</a></li>
        
      </ul>
    </nav>
  


      </article>

    </section>

  </body>

</html>

