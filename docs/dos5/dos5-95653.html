





<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="generator" content="ng2web v1.1.0 (ngdb v1.1.0)">
    <link rel="stylesheet" type="text/css" href="dos5-style.css">
    <title>DOS 5.0 Ref. » DOS » Functions (Int 21h)</title>
    <meta name="description" content="DOS 5.0 Ref.">
    <link rel="prev" href="dos5-94701.html">
    <link rel="next" href="dos5-98231.html">
    
  </head>

  <body>

    <header>
      <nav class="box">
        <ul>
          

<li><a href="dos5-about.html">About</a></li>


          

<li><a href="dos5-94701.html">Previous</a></li>


          

<li><a href="index.html">Up</a></li>


          

<li><a href="dos5-98231.html">Next</a></li>


        </ul>
      </nav>
    </header>

    <section>

      <nav class="menu box">
        <ul>
            <li>DOS</li>
            <ul>
              <li><a href="index.html">Functions (Int 21h)</a></li>
              <li><a href="dos5-135422.html">Multiplex (Int 2Fh)</a></li>
              <li><a href="dos5-159299.html">Interrupts 20h-28h</a></li>
              <li><a href="dos5-182062.html">Device Driver Fnx</a></li>
              <li><a href="dos5-221655.html">Structures</a></li>
              <li><a href="dos5-268064.html">Extended key codes</a></li>
              
            </ul>
        </ul>
      </nav>

      <article class="box">
        
  
  
    <pre class="entry"><span class="line"><span class="ngb">Function 4Eh            Find First File (FIND FIRST)</span></span><br /><span class="line"></span><br /><span class="line">    Searches a directory for the first file or directory whose name</span><br /><span class="line">    and attributes match the specified name and attributes.</span><br /><span class="line"></span><br /><span class="line">        <span class="ngb">Entry</span>   AH    = 4Eh</span><br /><span class="line">                CX    = File attributes</span><br /><span class="line">                DS:DX = Pointer to ASCIIZ filespec (* ? allowed)</span><br /><span class="line"></span><br /><span class="line">        <span class="ngb">Return</span>  FileInfo structure at current DTA</span><br /><span class="line">                or</span><br /><span class="line">                AX = Error code, if CF is set</span><br /><span class="line">                     | 02h File not found</span><br /><span class="line">                     | 03h Path not found</span><br /><span class="line">                     | 12h No more files to be found</span><br /><span class="line"></span><br /><span class="line">    ──────────────────────────────────────────────────────────────────</span><br /><span class="line"></span><br /><span class="line">    This function searches for the first filename matching the filespec</span><br /><span class="line">    (ASCIIZ string pointed to by DS:DX). The filespec may include a drive</span><br /><span class="line">    letter and path, and the filename can include wildcard characters.</span><br /><span class="line"></span><br /><span class="line">    The CX register controls the scope of the search by specifying a</span><br /><span class="line">    file attribute mask. Note that bits 0 and 5 of the mask are</span><br /><span class="line">    <span class="ngb">ignored</span>, hence a search for files with attr_readonly or</span><br /><span class="line">    attr_archive must be performed by testing these bits for all files.</span><br /><span class="line">    If a program specifies any combination of attr_system,</span><br /><span class="line">    attr_hidden, and attr_directory, this function returns normal</span><br /><span class="line">    files in addition to the specified files. The program must examine</span><br /><span class="line">    the attributes contained in the returned FileInfo structure to</span><br /><span class="line">    determine the type of file found.</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">    If the DTA has not been explicitly set by function 1ah, DOS uses</span><br /><span class="line">    the default DTA at offset 80h in the program segment prefix (PSP).</span><br /><span class="line"></span><br /><span class="line">    ──────────────────────────────────────────────────────────────────</span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">Example</span></span><br /><span class="line"></span><br /><span class="line">        DATASEG</span><br /><span class="line">        fname   db &#34;\abc\*.*&#34;,0 ; Search all files/directories in \abc</span><br /><span class="line">        UDATASEG</span><br /><span class="line">        fi      FileInfo ?      ; Uninitialized structure</span><br /><span class="line">        CODESEG</span><br /><span class="line">        assume  ds:dgroup</span><br /><span class="line">        mov     dx,offset fi            ; ds:dx -&gt; new DTA</span><br /><span class="line">        mov     ah,1ah                  ; Set disk transfer address</span><br /><span class="line">        int     21h</span><br /><span class="line">        mov     dx,offset fname         ; ds:dx -&gt; ASCIIZ filespec.</span><br /><span class="line">        mov     cx,ATTR_ANY - ATTR_VOLUME   ; Exclude volume label</span><br /><span class="line">                                            ; from the search</span><br /><span class="line">        mov     ah,4eh                  ; Invoke Find First File</span><br /><span class="line">        int     21h</span><br /><span class="line">        jc      @@cf_set                ; Carry flag set if error</span><br /><span class="line">    @@got_name:</span><br /><span class="line">        mov     bx,offset fi            ; ds:bx -&gt; FileInfo</span><br /><span class="line">        test    [byte bx + 15h],ATTR_DIRECTORY</span><br /><span class="line">        jnz     @@findnxt               ; Skip if subdirectory</span><br /><span class="line">        cmp     [byte bx + 1eh],&#34;.&#34;     ;   or parent&#39;s or own dir.</span><br /><span class="line">        jz      @@findnxt</span><br /><span class="line">        lea     dx,[bx + 1eh]           ; ds:dx -&gt; filename</span><br /><span class="line">        call    process_file            ; Do something useful</span><br /><span class="line">    @@findnxt:</span><br /><span class="line">        mov     ah,4fh                  ; Invoke Find Next File</span><br /><span class="line">        int     21h</span><br /><span class="line">        jnc     @@got_name              ; Back for more</span><br /><span class="line">    @@cf_set:</span><br /><span class="line">        cmp     ax,12h                  ; No more files?</span><br /><span class="line">        jz      @@end                   ; Then return</span><br /><span class="line">        call    error_proc              ;   else trap error</span><br /><span class="line">        stc</span><br /><span class="line">    @@end:</span><br /><span class="line">        ret</span><br /></pre>
  
  
  
    <nav class="seeAlso">
      <ul>
        <li>See Also:</li>
        
          <li><a href="dos5-98231.html">4fh</a></li>
        
          <li><a href="dos5-13068.html">1ah</a></li>
        
          <li><a href="dos5-105927.html">59h</a></li>
        
          <li><a href="dos5-243784.html">FileInfo</a></li>
        
          <li><a href="dos5-241441.html">File attributes</a></li>
        
      </ul>
    </nav>
  


      </article>

    </section>

  </body>

</html>

