





<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="generator" content="ng2web v1.2.0 (ngdb v1.1.0)">
    <link rel="stylesheet" type="text/css" href="dos5-style.css">
    <title>DOS 5.0 Ref. » DOS » Interrupts 20h-28h</title>
    <meta name="description" content="DOS 5.0 Ref.">
    <link rel="prev" href="dos5-160719.html">
    <link rel="next" href="dos5-167402.html">
    
  </head>

  <body>

    <header>
      <nav class="box">
        <ul>
          

<li><a href="../index.html">Guides</a></li>


          

<li><a href="dos5-about.html">About</a></li>


          

<li><a href="dos5-160719.html">Previous</a></li>


          

<li><a href="dos5-159299.html">Up</a></li>


          

<li><a href="dos5-167402.html">Next</a></li>


        </ul>
      </nav>
    </header>

    <section>

      
        <nav class="menu box">
          <ul>
              <li>DOS</li>
              <ul>
                <li><a href="index.html">Functions (Int 21h)</a></li>
                <li><a href="dos5-135422.html">Multiplex (Int 2Fh)</a></li>
                <li><a href="dos5-159299.html">Interrupts 20h-28h</a></li>
                <li><a href="dos5-182062.html">Device Driver Fnx</a></li>
                <li><a href="dos5-221655.html">Structures</a></li>
                <li><a href="dos5-268064.html">Extended key codes</a></li>
                
              </ul>
          </ul>
        </nav>
      

      <article class="box">
        
  
  
    <pre class="entry"><span class="line"><span class="ngb">Int 23h                 Ctrl-C Handler</span></span><br /><span class="line"></span><br /><span class="line">    Ctrl-C Handler (Interrupt 23h) carries out program-specific</span><br /><span class="line">    actions in response to the Ctrl-C (ASCII 03h) key combination</span><br /><span class="line">    being pressed. DOS issues this interrupt if it receives the Ctrl-C</span><br /><span class="line">    character while processing a system function. The handler carries</span><br /><span class="line">    out its actions then returns to the system in order to restart the</span><br /><span class="line">    system function or terminate the current program.</span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">Programs must not issue Interrupt 23h.</span></span><br /><span class="line"></span><br /><span class="line">    ──────────────────────────────────────────────────────────────────</span><br /><span class="line"></span><br /><span class="line">    DOS sets the current Ctrl-C handler when starting a program,</span><br /><span class="line">    copying the address of the parent program&#39;s handler to both the</span><br /><span class="line">    vector-table entry and offset 0Eh in the new program&#39;s PSP.</span><br /><span class="line">    Although a program can change the vector-table entry, it must not</span><br /><span class="line">    change the address in its PSP, since DOS uses this address to</span><br /><span class="line">    restore the parent program&#39;s handler.</span><br /><span class="line"></span><br /><span class="line">    DOS does not immediately issue Int 23h when the user presses the</span><br /><span class="line">    Ctrl-C key combination. Instead, the system places the Ctrl-C</span><br /><span class="line">    character (ASCII 03h) in the keyboard buffer; if no other</span><br /><span class="line">    characters are ahead of the control character, the system</span><br /><span class="line">    processes it while carrying out a system function. For most</span><br /><span class="line">    computers, DOS also places a Ctrl-C character in a buffer when the</span><br /><span class="line">    user presses the Ctrl-Break key combination. Pressing this</span><br /><span class="line">    combination places a Ctrl-C character ahead of all other</span><br /><span class="line">    characters in the keyboard buffer.</span><br /><span class="line"></span><br /><span class="line">    DOS checks for the Ctrl-C character while carrying out character</span><br /><span class="line">    I/O functions (Int 21h functions 01h through 0Ch). It also checks</span><br /><span class="line">    for the character while carrying out other system functions - but</span><br /><span class="line">    only if the Ctrl-C Check Flag is set. If the I/O mode for the</span><br /><span class="line">    keyboard (or input device) is binary, the system disables Ctrl-C</span><br /><span class="line">    character processing while a program uses Read File or Device</span><br /><span class="line">    (Int 21h function 3Fh) and the Ctrl-C character is read as input.</span><br /><span class="line"></span><br /><span class="line">    ──────────────────────────────────────────────────────────────────</span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">Before</span> issuing Int 23h, DOS does the following:</span><br /><span class="line"></span><br /><span class="line">        ■   Sets all registers to the values they had when the</span><br /><span class="line">            interrupted system function was initially called.</span><br /><span class="line"></span><br /><span class="line">        ■   Sets the program&#39;s stack to be the current stack. When the</span><br /><span class="line">            handler receives control, the stack has the following</span><br /><span class="line">            contents (from the top of the stack):</span><br /><span class="line"></span><br /><span class="line">                The return address (CS:IP) and the flags needed for</span><br /><span class="line">                the IRET instruction back to the system.</span><br /><span class="line"></span><br /><span class="line">                The return address (CS:IP) and the flags needed for</span><br /><span class="line">                the IRET instruction back to the program.</span><br /><span class="line"></span><br /><span class="line">        ■   Sets to zero any internal system variables, such as the</span><br /><span class="line">            ErrorMode and InDOS variables, so that the handler can</span><br /><span class="line">            call system functions or even return directly to the</span><br /><span class="line">            program without disrupting system operations.</span><br /><span class="line"></span><br /><span class="line">    ──────────────────────────────────────────────────────────────────</span><br /><span class="line"></span><br /><span class="line">    An Int 23h handler can call any system function.</span><br /><span class="line"></span><br /><span class="line">    Upon returning from Interrupt 23h, DOS checks the method of return</span><br /><span class="line">    to determine what action to take. If the handler sets the carry</span><br /><span class="line">    flag and returns with the RETF instruction, DOS terminates the</span><br /><span class="line">    program by calling End Program (Int 21h function 4ch). If the</span><br /><span class="line">    handler returns with the IRET instruction or with the RETF</span><br /><span class="line">    instruction after clearing the carry flag, the system repeats the</span><br /><span class="line">    call to the system function, starting the function&#39;s action again</span><br /><span class="line">    from the beginning. In this case, the handler must preserve all</span><br /><span class="line">    registers, restoring them before returning to the system.</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">    COMMAND.COM provides the <span class="ngb">default Ctrl-C handler</span>, which terminates</span><br /><span class="line">    the current program unless a batch file is running, in which case</span><br /><span class="line">    the handler prompts the user to continue (or not) with the next</span><br /><span class="line">    command in the file. Since prompting the user suspends execution</span><br /><span class="line">    of the current program until the user responds, programs that lock</span><br /><span class="line">    resources (especially over a network) should replace the default</span><br /><span class="line">    handler. In general, a program should make sure that other</span><br /><span class="line">    programs can access resources even while it is suspended.</span><br /><span class="line"></span><br /><span class="line">    ──────────────────────────────────────────────────────────────────</span><br /><span class="line"></span><br /><span class="line">        <span class="ngb">Example</span></span><br /><span class="line"></span><br /><span class="line">        ; Dummy Int 1Bh/23h/24h handlers prevent</span><br /><span class="line">        ; DOS&#39;s default handlers from activating.</span><br /><span class="line">        ; (Int 1Bh is issued by Int 09h handler</span><br /><span class="line">        ; and chained by DOS)</span><br /><span class="line"></span><br /><span class="line">        UDATASEG</span><br /><span class="line">        old_i1bh dd ?           ; Saved Int 1bh vector</span><br /><span class="line">        CODESEG</span><br /><span class="line">        label i1bh far          ; Disable &#34;^C&#34; display</span><br /><span class="line">        proc i23h far           ; Ctrl-C handler</span><br /><span class="line">                iret            ; Ignore ctrl-c keystroke</span><br /><span class="line">        endp</span><br /><span class="line">        proc i24h far           ; Critical-Error handler</span><br /><span class="line">                mov     al,03h  ; &#34;Fail&#34;: failing I/O function</span><br /><span class="line">                iret            ;         returns carry flag set</span><br /><span class="line">        endp</span><br /><span class="line">        proc install_i1Bh_i23h_i24h</span><br /><span class="line">                assume  ds:dgroup</span><br /><span class="line">                push    ds</span><br /><span class="line">                mov     ax,351bh        ; Save Int 1bh vector</span><br /><span class="line">                int     21h</span><br /><span class="line">                push    es bx</span><br /><span class="line">                pop     [old_i1bh]</span><br /><span class="line">                mov     ax,cs</span><br /><span class="line">                mov     ds,ax</span><br /><span class="line">                assume  ds:@code</span><br /><span class="line">                lea     dx,[i1bh]       ; Install Int 1bh vector</span><br /><span class="line">                mov     ax,251bh</span><br /><span class="line">                int     21h</span><br /><span class="line">                lea     dx,[i23h]       ; Install Ctrl-C handler</span><br /><span class="line">                mov     ax,2523h</span><br /><span class="line">                int     21h</span><br /><span class="line">                lea     dx,[i24h]       ; Install Critical-Error handler</span><br /><span class="line">                mov     ax,2524h</span><br /><span class="line">                int     21h</span><br /><span class="line">                pop     ds</span><br /><span class="line">                ret</span><br /><span class="line">        endp</span><br /><span class="line">        proc restore_i1bh</span><br /><span class="line">                assume  ds:dgroup       ; (DOS auto-restores Int 23h and</span><br /><span class="line">                push    ds              ;  24h vectors on termination)</span><br /><span class="line">                lds     dx,[old_i1bh]</span><br /><span class="line">                assume  ds:nothing</span><br /><span class="line">                mov     ax,251bh</span><br /><span class="line">                int     21h</span><br /><span class="line">                pop     ds</span><br /><span class="line">                assume  ds:dgroup</span><br /><span class="line">                ret</span><br /><span class="line">        endp</span><br /></pre>
  
  
  
    <nav class="seeAlso">
      <ul>
        <li>See Also:</li>
        
          <li>
            
              <a href="dos5-255713.html">PSP</a>
            
          </li>
        
          <li>
            
              <a href="dos5-24819.html">3301h</a>
            
          </li>
        
          <li>
            
              <a href="dos5-37686.html">3fh</a>
            
          </li>
        
          <li>
            
              <a href="dos5-46090.html">4400h</a>
            
          </li>
        
          <li>
            
              <a href="dos5-93692.html">4ch</a>
            
          </li>
        
      </ul>
    </nav>
  


      </article>

    </section>

    
      <footer>
        <nav class="box">
          <dl>
            <dt>Generated</dt><dd>2025-12-02 09:10:23</dd>
            <dt>Generator</dt><dd><a href="https://ng2web.davep.dev">ng2web v1.2.0 (ngdb v1.1.0)</a></dd>
          </dl>
        </nav>
      </footer>
    

  </body>

</html>

