





<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="generator" content="ng2web v1.1.0 (ngdb v1.1.0)">
    <link rel="stylesheet" type="text/css" href="rbint-style.css">
    <title>Ralf Brown » Lists » Interrupts</title>
    <meta name="description" content="Ralf Brown">
    <link rel="prev" href="rbint-2497663.html">
    <link rel="next" href="rbint-2519395.html">
    
  </head>

  <body>

    <header>
      <nav class="box">
        <ul>
          

<li><a href="rbint-about.html">About</a></li>


          

<li><a href="rbint-2497663.html">Previous</a></li>


          

<li><a href="rbint-2471063.html">Up</a></li>


          

<li><a href="rbint-2519395.html">Next</a></li>


        </ul>
      </nav>
    </header>

    <section>

      <nav class="menu box">
        <ul>
            <li>Lists</li>
            <ul>
              <li><a href="index.html">Comments</a></li>
              <li><a href="rbint-7995.html">Interrupts</a></li>
              <li><a href="rbint-15401.html">Glossary</a></li>
              <li><a href="rbint-64347.html">Memory</a></li>
              <li><a href="rbint-180090.html">CMOS</a></li>
              <li><a href="rbint-250757.html">86 Bugs</a></li>
              
            </ul>
        </ul>
      </nav>

      <article class="box">
        
  
  
    <pre class="entry"><span class="line"></span><br /><span class="line"><span class="ngu">Int 21 Fn 52  U - Dos 2+ Internal - &#34;sysvars&#34; - Get List Of Lists  <span class="ngb">(Cont.)</span></span></span><br /><span class="line"></span><br /><span class="line">         the next stack to be allocated (initially same as value in</span><br /><span class="line">         0Eh and works its way down in steps of 8 to the value in</span><br /><span class="line">         0Ch as hardware interrupts pre-empt each other)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Note:</span>  the STACKS code segment data may, if present, be located as follows:</span><br /><span class="line">    DOS 3.2:   The code segment data is at a paragraph boundary fairly early</span><br /><span class="line">         in the IBMBIO segment (seen at 0070:0190h)</span><br /><span class="line">    DOS 3.3:   The code segment is at a paragraph boundary in the DOS data</span><br /><span class="line">         segment, which may be determined by inspecting the segment</span><br /><span class="line">         pointers of the vectors for those of interrupts 02h, 08h-0Eh,</span><br /><span class="line">         70h, 72-77h which have not been redirected by device drivers</span><br /><span class="line">         or TSRs.</span><br /><span class="line">    DOS 4.0+   Identified by sub-segment control block type &#34;S&#34; within the DOS</span><br /><span class="line">         data segment.</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #1322,INT B4&#34;STACKMAN&#34;</span><br /><span class="line"></span><br /><span class="line">Format of array elements in STACKS data segment:</span><br /><span class="line">Offset Size    Description (Table 1321)</span><br /><span class="line"> 00h   BYTE    status: 00h=free, 01h=in use, 03h=corrupted by overflow of</span><br /><span class="line">         higher stack.</span><br /><span class="line"> 01h   BYTE    not used</span><br /><span class="line"> 02h   WORD    previous SP</span><br /><span class="line"> 04h   WORD    previous SS</span><br /><span class="line"> 06h   WORD    ptr to word at top of stack (new value for SP). The word at the</span><br /><span class="line">         top of the stack is preset to point back to this control</span><br /><span class="line">         block.</span><br /><span class="line"></span><br /><span class="line">Format of SHARE.EXE hooks (DOS 3.1-6.00):</span><br /><span class="line">Offset Size    Description (Table 1322)</span><br /><span class="line">(offsets from first system file table--pointed at by ListOfLists+04h)</span><br /><span class="line">-3Ch   DWORD   pointer to FAR routine for ???</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Note:</span> not called by MS-DOS 3.3, set to 0000h:0000h by</span><br /><span class="line">           SHARE 3.3+</span><br /><span class="line">-38h   DWORD   pointer to FAR routine called on opening file</span><br /><span class="line">       on call, internal DOS location points at filename</span><br /><span class="line">         (see #1373 at AX=5D06h)</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Return:</span> CF clear if successful</span><br /><span class="line">           CF set on error</span><br /><span class="line">               AX = DOS error code (24h)</span><br /><span class="line">                 (see #1366 at AH=59h/BX=0000h)</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Note:</span> SHARE directly accesses DOS-internal data to get name of</span><br /><span class="line">           file just opened</span><br /><span class="line">-34h   DWORD   pointer to FAR routine called on closing file</span><br /><span class="line">       ES:DI -&gt; system file table</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Note:</span> does something to every Record Lock Record for file</span><br /><span class="line">-30h   DWORD   pointer to FAR routine to close all files for given computer</span><br /><span class="line">       (called by AX=5D03h)</span><br /><span class="line">-2Ch   DWORD   pointer to FAR routine to close all files for given process</span><br /><span class="line">       (called by AX=5D04h)</span><br /><span class="line">-28h   DWORD   pointer to FAR routine to close file by name</span><br /><span class="line">       (called by AX=5D02h)</span><br /><span class="line">       DS:SI -&gt; DOS parameter list (see #1372 at AX=5D00h)</span><br /><span class="line">          DPL&#39;s DS:DX -&gt; name of file to close</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Return:</span> CF clear if successful</span><br /><span class="line">           CF set on error</span><br /><span class="line">               AX = DOS error code (03h)</span><br /><span class="line">                 (see #1366 at AH=59h/BX=0000h)</span><br /><span class="line">-24h   DWORD   pointer to FAR routine to lock region of file</span><br /><span class="line">       call with BX = file handle</span><br /><span class="line">             ---DOS 3.x---</span><br /><span class="line">             CX:DX = starting offset</span><br /><span class="line">             SI:AX = size</span><br /><span class="line">             ---DOS 4.0+ ---</span><br /><span class="line">             DS:DX -&gt; lock range</span><br /><span class="line">                   DWORD start offset</span><br /><span class="line">                   DWORD size in bytes</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Return:</span> CF set on error</span><br /><span class="line">               AL = DOS error code (21h) (see #1366 at AH=59h)</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Note:</span> not called if file is marked as remote</span><br /><span class="line">-20h   DWORD   pointer to FAR routine to unlock region of file</span><br /><span class="line">       call with BX = file handle</span><br /><span class="line">             ---DOS 3.x---</span><br /><span class="line">             CX:DX = starting offset</span><br /><span class="line">             SI:AX = size</span><br /><span class="line">             ---DOS 4.0+ ---</span><br /><span class="line">             DS:DX -&gt; lock range</span><br /><span class="line">                   DWORD start offset</span><br /><span class="line">                   DWORD size in bytes</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Return:</span> CF set on error</span><br /><span class="line">               AL = DOS error code (21h) (see #1366 at AH=59h)</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Note:</span> not called if file is marked as remote</span><br /><span class="line">-1Ch   DWORD   pointer to FAR routine to check if file region is locked</span><br /><span class="line">       call with ES:DI -&gt; system file table entry for file</span><br /><span class="line">           CX = length of region from current position in file</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Return:</span> CF set if any portion of region locked</span><br /><span class="line">               AX = 0021h</span><br /><span class="line">-18h   DWORD   pointer to FAR routine to get open file list entry</span><br /><span class="line">       (called by AX=5D05h)</span><br /><span class="line">       call with DS:SI -&gt; DOS parameter list (see #1372 at AX=5D00h)</span><br /><span class="line">           DPL&#39;s BX = index of sharing record</span><br /><span class="line">           DPL&#39;s CX = index of SFT in SFT chain of sharing rec</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Return:</span> CF set on error or not loaded</span><br /><span class="line">               AX = DOS error code (12h) (see #1366 at AH=59h)</span><br /><span class="line">           CF clear if successful</span><br /><span class="line">               ES:DI -&gt; filename</span><br /><span class="line">               CX = number of locks owned by specified SFT</span><br /><span class="line">               BX = network machine number</span><br /><span class="line">               DX destroyed</span><br /><span class="line">-14h   DWORD   pointer to FAR routine for updating FCB from SFT???</span><br /><span class="line">       call with DS:SI -&gt; unopened FCB</span><br /><span class="line">             ES:DI -&gt; system file table entry</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Return:</span> BL = C0h???</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Note:</span> copies following fields from SFT to FCB:</span><br /><span class="line">          starting cluster of file   0Bh    1Ah</span><br /><span class="line">          sharing record offset      33h    1Ch</span><br /><span class="line">          file attribute         04h    1Eh</span><br /><span class="line">-10h   DWORD   pointer to FAR routine to get first cluster of FCB file ???</span><br /><span class="line">       call with ES:DI -&gt; system file table entry</span><br /><span class="line">             DS:SI -&gt; FCB</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Return:</span> CF set if SFT closed or sharing record offsets</span><br /><span class="line">               mismatched</span><br /><span class="line">           CF clear if successful</span><br /><span class="line">               BX = starting cluster number from FCB</span><br /><span class="line">-0Ch   DWORD   pointer to FAR routine to close file if duplicate for process</span><br /><span class="line">       DS:SI -&gt; system file table</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Return:</span> AX = number of handle in JFT which already uses SFT</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Note:</span> called during open/create of a file</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Note:</span> if SFT was opened with inheritance enabled and sharing</span><br /><span class="line">           mode 111, does something to all other SFTs owned by</span><br /><span class="line">           same process which have the same file open mode and</span><br /><span class="line">           sharing record</span><br /><span class="line">-08h   DWORD   pointer to FAR routine for closing file</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Note:</span> closes various handles referring to file most-recently</span><br /><span class="line">           opened</span><br /><span class="line">-04h   DWORD   pointer to FAR routine to update directory info in related SFT</span><br /><span class="line">         entries</span><br /><span class="line">       call with ES:DI -&gt; system file table entry for file (see #1327)</span><br /><span class="line">             AX = subfunction (apply to each related SFT)</span><br /><span class="line">               00h: update time stamp (offset 0Dh) and date</span><br /><span class="line">                    stamp (offset 0Fh)</span><br /><span class="line">               01h: update file size (offset 11h) and starting</span><br /><span class="line">                    cluster (offset 0Bh).  Sets last-accessed</span><br /><span class="line">                    cluster fields to start of file if file</span><br /><span class="line">                    never accessed</span><br /><span class="line">               02h: as function 01h, but last-accessed fields</span><br /><span class="line">                    always changed</span><br /><span class="line">               03h: do both functions 00h and 02h</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Note:</span> follows ptr at offset 2Bh in system file table entries</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Note:</span> NOP if opened with no-inherit or via FCB</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Notes:</span> most of the above hooks (except -04h, -14h, -18h, and -3Ch) assume</span><br /><span class="line">     either that SS=DOS DS or SS=DS=DOS DS and directly access</span><br /><span class="line">     DOS-internal data</span><br /><span class="line">   sharing hooks are not supported by DR DOS 5-6; they appear to be</span><br /><span class="line">     supported by Novell DOS 7, with a segment of 0000h indicating the</span><br /><span class="line">     DOS data segment</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #1323,#1324</span><br /><span class="line"></span><br /><span class="line">Format of sharing record:</span><br /><span class="line">Offset Size    Description (Table 1323)</span><br /><span class="line"> 00h   BYTE    flag</span><br /><span class="line">       00h free block</span><br /><span class="line">       01h allocated block</span><br /><span class="line">       FFh end marker</span><br /><span class="line"> 01h   WORD    size of block</span><br /><span class="line"> 03h   BYTE    checksum of pathname (including NUL)</span><br /><span class="line">       if sum of ASCII values is N, checksum is (N/256 + N%256)</span><br /><span class="line"> 04h   WORD    offset in SHARE&#39;s DS of first Record Lock Record (see #1324)</span><br /><span class="line"> 06h   DWORD   pointer to start of system file table chain for file</span><br /><span class="line"> 0Ah   WORD    unique sequence number</span><br /><span class="line"> 0Ch   var ASCIZ full pathname</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Note:</span>  not supported by DR DOS SHARE 1.1 and 2.0; will reportedly be</span><br /><span class="line">     supported by Novell DOS 7</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #1322,#1324</span><br /><span class="line"></span><br /><span class="line">Format of SHARE.EXE Record Lock Record:</span><br /><span class="line">Offset Size    Description (Table 1324)</span><br /><span class="line"> 00h   WORD    offset in SHARE&#39;s DS of next lock table in list or 0000h</span><br /><span class="line"> 02h   DWORD   offset in file of start of locked region</span><br /><span class="line"> 06h   DWORD   offset in file of end of locked region</span><br /><span class="line"> 0Ah   DWORD   pointer to System File Table entry for this file</span><br /><span class="line"> 0Eh   WORD    PSP segment of lock&#39;s owner</span><br /><span class="line">---DOS 5+ ---</span><br /><span class="line"> 10h   WORD    lock type: (00h lock all, 01h lock writes only)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #1322,#1323,#1325,#1328</span><br /><span class="line"></span><br /><span class="line">Format of DOS 2.x system file tables:</span><br /><span class="line">Offset Size    Description (Table 1325)</span><br /><span class="line"> 00h   DWORD   pointer to next file table (offset FFFFh if last)</span><br /><span class="line"> 04h   WORD    number of files in this table</span><br /><span class="line"> 06h  28h bytes per file</span><br /><span class="line">   Offset  Size    Description</span><br /><span class="line">    00h    BYTE    number of file handles referring to this file</span><br /><span class="line">    01h    BYTE    file open mode (see #1090 at AH=3Dh)</span><br /><span class="line">    02h    BYTE    file attribute</span><br /><span class="line">    03h    BYTE    drive (0 = character device, 1 = A, 2 = B, etc)</span><br /><span class="line">    04h 11 BYTEs   filename in FCB format (no path,no period,blank-padded)</span><br /><span class="line">    0Fh    WORD    ???</span><br /><span class="line">    11h    WORD    ???</span><br /><span class="line">    13h    DWORD   file size???</span><br /><span class="line">    17h    WORD    file date in packed format (see #1352 at AX=5700h)</span><br /><span class="line">    19h    WORD    file time in packed format (see #1351 at AX=5700h)</span><br /><span class="line">    1Bh    BYTE    device attribute (see #1110 at AX=4400h)</span><br /><span class="line">   ---character device---</span><br /><span class="line">    1Ch    DWORD   pointer to device driver</span><br /><span class="line">   ---block device---</span><br /><span class="line">    1Ch    WORD    starting cluster of file</span><br /><span class="line">    1Eh    WORD    relative cluster in file of last cluster accessed</span><br /><span class="line">   ------</span><br /><span class="line">    20h    WORD    absolute cluster number of current cluster</span><br /><span class="line">    22h    WORD    ???</span><br /><span class="line">    24h    DWORD   current file position???</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #1326,#1327,#1328</span><br /><span class="line"></span><br /><span class="line">Format of DOS 3.0 system file tables and FCB tables:</span><br /><span class="line">Offset Size    Description (Table 1326)</span><br /><span class="line"> 00h   DWORD   pointer to next file table (offset FFFFh if last)</span><br /><span class="line"> 04h   WORD    number of files in this table</span><br /><span class="line"> 06h  38h bytes per file</span><br /><span class="line">   Offset  Size    Description</span><br /><span class="line">    00h-1Eh as for DOS 3.1+ (see #1327)</span><br /><span class="line">    1Fh    WORD    byte offset of directory entry within sector</span><br /><span class="line">    21h 11 BYTEs   filename in FCB format (no path/period, blank-padded)</span><br /><span class="line">    2Ch    DWORD   (SHARE.EXE) pointer to previous SFT sharing same file</span><br /><span class="line">    30h    WORD    (SHARE.EXE) network machine number which opened file</span><br /><span class="line">           (Windows Enhanced mode DOSMGR uses the virtual machine</span><br /><span class="line">             ID as the machine number; see INT 2F/AX=1683h)</span><br /><span class="line">    32h    WORD    PSP segment of file&#39;s owner (first three entries for</span><br /><span class="line">             AUX/CON/PRN contain segment of IO.SYS startup code)</span><br /><span class="line">    34h    WORD    (SHARE.EXE) offset in SHARE code seg of share record</span><br /><span class="line">    36h    WORD    ??? apparently always 0000h</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #1325,#1327,#1328</span><br /><span class="line"></span><br /><span class="line">Format of DOS 3.1-3.3x, DR DOS 5.0-6.0 system file tables and FCB tables:</span><br /><span class="line">Offset Size    Description (Table 1327)</span><br /><span class="line"> 00h   DWORD   pointer to next file table (offset FFFFh if last)</span><br /><span class="line"> 04h   WORD    number of files in this table</span><br /><span class="line"> 06h  35h bytes per file</span><br /><span class="line">   Offset  Size    Description</span><br /><span class="line">    00h    WORD    number of file handles referring to this file</span><br /><span class="line">    02h    WORD    file open mode (see AX=6C00h, #1090 at AH=3Dh)</span><br /><span class="line">           bit 15 set if this file opened via FCB</span><br /><span class="line">    04h    BYTE    file attribute (see #1107 at AX=4301h)</span><br /><span class="line">    05h    WORD    device info word (see #1110 at AX=4400h)</span><br /><span class="line">           bit 15 set if remote file</span><br /><span class="line">           bit 14 set means do not set file date/time on closing</span><br /><span class="line">           bit 12 set means don&#39;t inherit on EXEC</span><br /><span class="line">           bits 5-0 drive number for disk files</span><br /><span class="line">    07h    DWORD   pointer to device driver header if character device</span><br /><span class="line">           else pointer to DOS Drive Parameter Block</span><br /><span class="line">             (see #1083 at AH=32h)</span><br /><span class="line">    0Bh    WORD    starting cluster of file</span><br /><span class="line">    0Dh    WORD    file time in packed format (see #1351 at AX=5700h)</span><br /><span class="line">           not used for character devices in DR DOS</span><br /><span class="line">    0Fh    WORD    file date in packed format (see #1352 at AX=5700h)</span><br /><span class="line">           not used for character devices in DR DOS</span><br /><span class="line">    11h    DWORD   file size</span><br /><span class="line">   ---system file table---</span><br /><span class="line">    15h    DWORD   current offset in file (may be larger than size of</span><br /><span class="line">             file; INT 21/AH=42h does not check new position)</span><br /><span class="line">   ---FCB table---</span><br /><span class="line">    15h    WORD    counter for last I/O to FCB</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">.NG limit reached, continued in next section...</span></span><br /></pre>
  
  
  


      </article>

    </section>

  </body>

</html>

