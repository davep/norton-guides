





<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="generator" content="ng2web v1.1.0 (ngdb v1.1.0)">
    <link rel="stylesheet" type="text/css" href="rbint-style.css">
    <title>Ralf Brown » Lists » CMOS</title>
    <meta name="description" content="Ralf Brown">
    <link rel="prev" href="rbint-180432.html">
    <link rel="next" href="rbint-192763.html">
    
  </head>

  <body>

    <header>
      <nav class="box">
        <ul>
          

<li><a href="rbint-about.html">About</a></li>


          

<li><a href="rbint-180432.html">Previous</a></li>


          

<li><a href="rbint-180090.html">Up</a></li>


          

<li><a href="rbint-192763.html">Next</a></li>


        </ul>
      </nav>
    </header>

    <section>

      <nav class="menu box">
        <ul>
            <li>Lists</li>
            <ul>
              <li><a href="index.html">Comments</a></li>
              <li><a href="rbint-7995.html">Interrupts</a></li>
              <li><a href="rbint-15401.html">Glossary</a></li>
              <li><a href="rbint-64347.html">Memory</a></li>
              <li><a href="rbint-180090.html">CMOS</a></li>
              <li><a href="rbint-250757.html">86 Bugs</a></li>
              
            </ul>
        </ul>
      </nav>

      <article class="box">
        
  
  
    <pre class="entry"><span class="line"></span><br /><span class="line"><span class="ngu">Accessing the CMOS</span></span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">The CMOS memory exists outside of the normal address space and cannot</span><br /><span class="line">contain directly executable code. It is reachable through IN and OUT</span><br /><span class="line">commands at port number 70h (112d) and 71h (113d). To read a CMOS byte,</span><br /><span class="line">an OUT to port 70h is executed with the address of the byte to be read and</span><br /><span class="line">an IN from port 71h will then retrieve the requested information. The</span><br /><span class="line">following BASIC fragment will read 128 CMOS bytes and print them to the</span><br /><span class="line">screen in 8 rows of 16 values.</span><br /><span class="line"></span><br /><span class="line">The CMOS RAM space has an upper limit of 128 bytes because of the structure</span><br /><span class="line">of port 70: only bits 0-6 are used for addressing, bit 7 is used to</span><br /><span class="line">enable (0) or disable (1) Non-Maskable Interrupts (NMI) and explains why</span><br /><span class="line">IBM uses 80h OR &lt;address&gt; to read/write data &amp; follows with  a &#34;throw-away&#34;</span><br /><span class="line">call.</span><br /><span class="line"></span><br /><span class="line">Note that if the CMOS only has 64 bytes available, addressing will</span><br /><span class="line">generally wrap and addresses from 40h-7Fh will mirror 00h-3Fh. Output will</span><br /><span class="line">be hexadecimal.</span><br /><span class="line"></span><br /><span class="line">10 CLS</span><br /><span class="line">20 FOR i = 0 TO &amp;H7F</span><br /><span class="line">30 OUT &amp;H70, i</span><br /><span class="line">40 PRINT USING &#34;\   \&#34;; HEX$(INP(&amp;H71));</span><br /><span class="line">50 NEXT i</span><br /><span class="line">60 PRINT &#34; &#34;</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Note:</span> where not otherwise noted, all data points are expressed as BYTES</span><br /><span class="line">      these are eight bit values and are read from MSB to LSB e.g.</span><br /><span class="line">      0000 0000        0101 1010 binary would be written as 5Ah</span><br /><span class="line">      7654 3210        where only some bits are used this is represented with</span><br /><span class="line">           Xs e.g bits 5-3 would be shown as 00xx x000</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Note:</span> the entries for AMI WinBIOS also apply to AMIBIOS with core dates of</span><br /><span class="line">   12/15/95 or later</span><br /><span class="line"></span><br /><span class="line">--------!---Note-----------------------------</span><br /><span class="line">       Organization of CMOS Memory - Clock</span><br /><span class="line"></span><br /><span class="line">00h-0Eh is defined by the clock hardware and all must follow it. Other</span><br /><span class="line">manufacturers generally follow the same format as specified for the</span><br /><span class="line">region 10h - 2Fh. Some also follow the IBM format for 30h-33h but not all</span><br /><span class="line">(Zenith in particular is different).</span><br /><span class="line"></span><br /><span class="line">The first fourteen bytes are dedicated to the MC146818 chip clock functions</span><br /><span class="line">and consist of ten read/write data registers and four status registers, two</span><br /><span class="line">of which are read/write and two of which are read only.</span><br /><span class="line"></span><br /><span class="line">The format of the ten clock data registers (bytes 00h-09h) is:</span><br /><span class="line"></span><br /><span class="line">----------R00--------------------------------</span><br /><span class="line">CMOS 00h - RTC - SECONDS</span><br /><span class="line"><span class="ngb">Desc:</span>  (BCD 00-59, Hex 00-3B)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Note:</span> Bit 7 is read only</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> CMOS 01h,CMOS 02h,CMOS 04h</span><br /><span class="line">----------R01--------------------------------</span><br /><span class="line">CMOS 01h - RTC - SECOND ALARM</span><br /><span class="line"><span class="ngb">Desc:</span>  (BCD 00-59, Hex 00-3B; &#34;don&#39;t care&#34; if C0-FF)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> CMOS 00h,CMOS 03h,CMOS 05h</span><br /><span class="line">----------R02--------------------------------</span><br /><span class="line">CMOS 02h - RTC - MINUTES</span><br /><span class="line"><span class="ngb">Desc:</span>  (BCD 00-59, Hex 00-3B)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> CMOS 00h,CMOS 03h,CMOS 04h</span><br /><span class="line">----------R03--------------------------------</span><br /><span class="line">CMOS 03h - RTC - MINUTE ALARM</span><br /><span class="line"><span class="ngb">Desc:</span>  (BCD 00-59, Hex 00-3B; &#34;don&#39;t care&#34; if C0-FF))</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> CMOS 00h,CMOS 02h,CMOS 05h</span><br /><span class="line">----------R04--------------------------------</span><br /><span class="line">CMOS 04h - RTC - HOURS</span><br /><span class="line"><span class="ngb">Desc:</span>  (BCD 00-23, Hex 00-17 if 24 hr mode)</span><br /><span class="line">   (BCD 01-12, Hex 01-0C if 12 hr am)</span><br /><span class="line">   (BCD 81-92. Hex 81-8C if 12 hr pm)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> CMOS 00h,CMOS 02h,CMOS 05h</span><br /><span class="line">----------R05--------------------------------</span><br /><span class="line">CMOS 05h - RTC - HOUR ALARM</span><br /><span class="line"><span class="ngb">Desc:</span>  (same as hours; &#34;don&#39;t care&#34; if C0-FF))</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> CMOS 01h,CMOS 03h,CMOS 04h</span><br /><span class="line">----------R06--------------------------------</span><br /><span class="line">CMOS 06h - RTC - DAY OF WEEK</span><br /><span class="line"><span class="ngb">Desc:</span>  (01-07 Sunday=1)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> CMOS 07h,CMOS 08h,CMOS 09h</span><br /><span class="line">----------R07--------------------------------</span><br /><span class="line">CMOS 07h - RTC - DATE OF MONTH</span><br /><span class="line"><span class="ngb">Desc:</span>  (BCD 01-31, Hex 01-1F)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> CMOS 06h,CMOS 08h,CMOS 09h</span><br /><span class="line">----------R08--------------------------------</span><br /><span class="line">CMOS 08h - RTC - MONTH</span><br /><span class="line"><span class="ngb">Desc:</span>  (BCD 01-12, Hex 01-0C)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> CMOS 06h,CMOS 07h,CMOS 09h</span><br /><span class="line">----------R09--------------------------------</span><br /><span class="line">CMOS 09h - RTC - YEAR</span><br /><span class="line"><span class="ngb">Desc:</span>  (BCD 00-99, Hex 00-63)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Notes:</span> BCD/Hex selection depends on Bit 2 of register B (0Bh)</span><br /><span class="line">   12/24 Hr selection depends on Bit 1 of register B (0Bh)</span><br /><span class="line">   Alarm will trigger when contents of all three Alarm byte registers</span><br /><span class="line">     match their companions.</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> CMOS 06h,CMOS 07h,CMOS 08h</span><br /><span class="line"></span><br /><span class="line">The following is the on-chip status register information.</span><br /><span class="line"></span><br /><span class="line">----------R0A--------------------------------</span><br /><span class="line">CMOS 0Ah - RTC - STATUS REGISTER A (read/write) (usu 26h)</span><br /><span class="line"></span><br /><span class="line">Bitfields for Real-Time Clock status register A:</span><br /><span class="line">Bit(s) Description (Table C001)</span><br /><span class="line"> 7 =1 time update cycle in progress, data ouputs undefined</span><br /><span class="line">   (bit 7 is read only)</span><br /><span class="line"> 6-4   22 stage divider</span><br /><span class="line">   010 = 32768 Hz time base (default)</span><br /><span class="line"> 3-0   rate selection bits for interrupt</span><br /><span class="line">   0000 none</span><br /><span class="line">   0011 122 microseconds (minimum)</span><br /><span class="line">   1111 500 milliseconds</span><br /><span class="line">   0110 976.562 microseconds (default 1024 Hz)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #C002,#C003,#C004</span><br /><span class="line">----------R0B--------------------------------</span><br /><span class="line">CMOS 0Bh - RTC - STATUS REGISTER B (read/write)</span><br /><span class="line"></span><br /><span class="line">Bitfields for Real-Time Clock status register B:</span><br /><span class="line">Bit(s) Description (Table C002)</span><br /><span class="line"> 7 enable cycle update</span><br /><span class="line"> 6 enable periodic interrupt</span><br /><span class="line"> 5 enable alarm interrupt</span><br /><span class="line"> 4 enable update-ended interrupt</span><br /><span class="line"> 3 enable square wave output</span><br /><span class="line"> 2 Data Mode - 0: BCD, 1: Binary</span><br /><span class="line"> 1 24/12 hour selection - 1 enables 24 hour mode</span><br /><span class="line"> 0 Daylight Savings Enable - 1 enables</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #C001,#C003,#C004</span><br /><span class="line">----------R0C--------------------------------</span><br /><span class="line">CMOS 0Ch - RTC - STATUS REGISTER C (Read only)</span><br /><span class="line"></span><br /><span class="line">Bitfields for Real-Time Clock status register C:</span><br /><span class="line">Bit(s) Description (Table C003)</span><br /><span class="line"> 7 Interrupt request flag</span><br /><span class="line">   =1 when any or all of bits 6-4 are 1 and appropriate enables</span><br /><span class="line">     (Register B) are set to 1. Generates IRQ 8 when triggered.</span><br /><span class="line"> 6 Periodic Interrupt flag</span><br /><span class="line"> 5 Alarm Interrupt flag</span><br /><span class="line"> 4 Update-Ended Interrupt Flag</span><br /><span class="line"> 3-0   unused???</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #C001,#C002,#C004</span><br /><span class="line">----------R0D--------------------------------</span><br /><span class="line">CMOS 0Dh - RTC - STATUS REGISTER D (read only)</span><br /><span class="line"></span><br /><span class="line">Bitfields for Real-Time Clock status register D:</span><br /><span class="line">Bit(s) Description (Table C004)</span><br /><span class="line"> 7 Valid RAM - 1 indicates batery power good, 0 if dead or disconnected.</span><br /><span class="line"> 6-0   unused??? (0)</span><br /><span class="line">--------!---Note-----------------------------</span><br /><span class="line">       Organization of CMOS Memory - non-Clock</span><br /><span class="line"></span><br /><span class="line">The last two bytes in the first hexadecimal decade (hexade ?) were not</span><br /><span class="line">specified in the PC/AT but may have the following use on some systems:</span><br /><span class="line">----------R0E--------------------------------</span><br /><span class="line">CMOS 0Eh  - IBM PS/2 - DIAGNOSTIC STATUS BYTE</span><br /><span class="line"></span><br /><span class="line">Bitfields for IBM PS/2 diagnostic status byte:</span><br /><span class="line">Bit(s) Description (Table C005)</span><br /><span class="line"> 7 indicates clock has lost power</span><br /><span class="line"> 6 incorrect checksum&gt;</span><br /><span class="line"> 5 equipment configuration is incorrect</span><br /><span class="line">     (power-on check requires that atleast one floppy be installed)</span><br /><span class="line"> 4 error in memory size</span><br /><span class="line"> 3 controller or disk drive failed initialization</span><br /><span class="line"> 2 time is invalid</span><br /><span class="line"> 1 installed adaptors do not match configuration</span><br /><span class="line"> 0 time-out while reading adaptor ID</span><br /><span class="line">----------R0E13------------------------------</span><br /><span class="line">CMOS 0Eh-13h - AMSTRAD - TIME AND DATE MACHINE LAST USED</span><br /><span class="line">----------R0F--------------------------------</span><br /><span class="line">CMOS 0Fh - IBM - RESET CODE (IBM PS/2 &#34;Shutdown Status Byte&#34;)</span><br /><span class="line"></span><br /><span class="line">(Table C006)</span><br /><span class="line">Values for Reset Code / Shutdown Status Byte:</span><br /><span class="line"> 00h-03h perform power-on reset</span><br /><span class="line">   00h software reset or unexpected reset</span><br /><span class="line">   01h reset after memory size check in real/virtual mode</span><br /><span class="line">   (or: chip set initialization for real mode reentry)</span><br /><span class="line">   02h reset after successful memory test in real/virtual mode</span><br /><span class="line">   03h reset after failed memory test in real/virtual mode</span><br /><span class="line"> 04h   INT 19h reboot</span><br /><span class="line"> 05h   flush keyboard (issue EOI) and jump via 40h:0067h</span><br /><span class="line"> 06h   reset (after successful test in virtual mode)</span><br /><span class="line">   (or: jump via 40h:0067h without EOI)</span><br /><span class="line"> 07h   reset (after failed test in virtual mode)</span><br /><span class="line"> 08h   used by POST during protected-mode RAM test (return to POST)</span><br /><span class="line"> 09h   used for INT 15/87h (block move) support</span><br /><span class="line"> 0Ah   resume execution by jump via 40h:0067h</span><br /><span class="line"> 0Bh   resume execution via IRET via 40h:0067h</span><br /><span class="line"> 0Ch   resume execution via RETF via 40h:0067h</span><br /><span class="line"> 0Dh-FFh perform power-on reset</span><br /><span class="line">--------!---Note-----------------------------</span><br /><span class="line"></span><br /><span class="line">The second group of values extends from address 10h to 2Dh. The word at</span><br /><span class="line">2Eh-2Fh is a byte-wise summation of the values in these bytes. Most BIOSes</span><br /><span class="line">will generate a CMOS Checksum error if this value is invalid however many</span><br /><span class="line">programs ignore the checksum and report the apparent value. The current</span><br /><span class="line">version of MSD reports my XT as having 20+ MB of extended memory.</span><br /><span class="line"></span><br /><span class="line">Where a definiton appears universal, no identification is made. Where</span><br /><span class="line">the definition is thought to be specific to a manufacturer/model (AMI,</span><br /><span class="line">AMSTRAD, IBM AT, IBM PS/2) the identification is enclosed in parens. The</span><br /><span class="line">AMSTAD definitions appear to relate to 8088/8086 (PC and PC/XT class)</span><br /><span class="line">mchines only. AT class machines appear to adhere to IBM PC/AT fornat.</span><br /><span class="line"></span><br /><span class="line">----------R10--------------------------------</span><br /><span class="line">CMOS 10h - IBM - FLOPPY DRIVE TYPE</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Note:</span>  a PC having a 5 1/4 1.2 Mb A: drive and a 1.44 Mb B: drive will</span><br /><span class="line">     have a value of 24h in byte 10h. With a single 1.44 drive: 40h.</span><br /><span class="line"></span><br /><span class="line">Bitfields for floppy drives A/B types:</span><br /><span class="line">Bit(s) Description (Table C007)</span><br /><span class="line"> 7-4   first floppy disk drive type (see #C008)</span><br /><span class="line"> 3-0   second floppy disk drive type (see #C008)</span><br /><span class="line"></span><br /><span class="line">(Table C008)</span><br /><span class="line">Values for floppy drive type:</span><br /><span class="line"> 00h   no drive</span><br /><span class="line"> 01h   360 KB 5.25 Drive</span><br /><span class="line"> 02h   1.2 MB 5.25 Drive - note: not listed in PS/2 technical manual</span><br /><span class="line"> 03h   720 KB 3.5 Drive</span><br /><span class="line"> 04h   1.44 MB 3.5 Drive</span><br /><span class="line"> 05h   2.88 MB 3.5 drive</span><br /><span class="line"> 06h-0Fh unused</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #C007</span><br /><span class="line">----------R11--------------------------------</span><br /><span class="line">CMOS 11h - IBM PS/2 - FIRST FIXED DISK DRIVE TYPE BYTE (00-FFh)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Note:</span>  if IBM ESDI or SCSI drive controller is used, CMOS drive type will be</span><br /><span class="line">     zero (00 - no drive) and INT 13h will be directed to controller ROM.</span><br /><span class="line">----------R11--------------------------------</span><br /><span class="line">CMOS 11h - older AMI Hi-Flex BIOS - KEYBOARD TYPEMATIC DATA</span><br /><span class="line"></span><br /><span class="line">Bitfields for AMI Hi-Flex BIOS keyboard typematic data:</span><br /><span class="line">Bit(s) Description (Table C009)</span><br /><span class="line"> 7 enable Typematic</span><br /><span class="line"> 6-5   Typematic Delay (wait before begin repeating)</span><br /><span class="line">   00b 250 ms</span><br /><span class="line">   01b 500 ms</span><br /><span class="line">   10b 750 ms</span><br /><span class="line">   11b 100 ms</span><br /><span class="line"> 4-0   Typematic Rate (char/sec)</span><br /><span class="line">   00000b - 30.0    01000b - 15.9  10000b - 7.5  11000b - 3.7</span><br /><span class="line">   00001b - 26.7    01001b - 13.3  10001b - 6.7  11001b - 3.3</span><br /><span class="line">   00010b - 24.0    01010b - 12.0  10010b - 6.0  11010b - 3.0</span><br /><span class="line">   00011b - 21.8    01011b - 10.9  10011b - 5.5  11011b - 2.7</span><br /><span class="line">   00100b - 20.0    01100b - 10.0  10100b - 5.0  11100b - 2.5</span><br /><span class="line">   00101b - 18.5    01101b -  9.2  10101b - 4.6  11101b - 2.3</span><br /><span class="line">   00110b - 17.1    01110b -  8.6  10110b - 4.3  11110b - 2.1</span><br /><span class="line">   00111b - 16.0    01111b -  8.0  10111b - 4.0  11111b - 2.0</span><br /><span class="line">----------R11--------------------------------</span><br /><span class="line">CMOS 11h - AMI - ADVANCED SETUP OPTIONS</span><br /></pre>
  
  
  


      </article>

    </section>

  </body>

</html>

