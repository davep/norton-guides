





<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="generator" content="ng2web v1.1.0 (ngdb v1.1.0)">
    <link rel="stylesheet" type="text/css" href="rbint-style.css">
    <title>Ralf Brown » Lists » Interrupts</title>
    <meta name="description" content="Ralf Brown">
    <link rel="prev" href="rbint-6068832.html">
    <link rel="next" href="rbint-6078914.html">
    
  </head>

  <body>

    <header>
      <nav class="box">
        <ul>
          

<li><a href="../index.html">Guides</a></li>


          

<li><a href="rbint-about.html">About</a></li>


          

<li><a href="rbint-6068832.html">Previous</a></li>


          

<li><a href="rbint-6065199.html">Up</a></li>


          

<li><a href="rbint-6078914.html">Next</a></li>


        </ul>
      </nav>
    </header>

    <section>

      <nav class="menu box">
        <ul>
            <li>Lists</li>
            <ul>
              <li><a href="index.html">Comments</a></li>
              <li><a href="rbint-7995.html">Interrupts</a></li>
              <li><a href="rbint-15401.html">Glossary</a></li>
              <li><a href="rbint-64347.html">Memory</a></li>
              <li><a href="rbint-180090.html">CMOS</a></li>
              <li><a href="rbint-250757.html">86 Bugs</a></li>
              
            </ul>
        </ul>
      </nav>

      <article class="box">
        
  
  
    <pre class="entry"><span class="line"></span><br /><span class="line"><span class="ngu">Int D4 Fn 04  - Pc-mos/386 V3.0+ - Get Task Control Block                </span>  [<span class="ngb">O</span>]</span><br /><span class="line"></span><br /><span class="line">   AH = 04h</span><br /><span class="line">   BX = task ID or FFFFh for calling task</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Return:</span> CF clear if successful</span><br /><span class="line">       ES = segment of Task Control Block (TCB) (see #3677)</span><br /><span class="line">   CF set on error</span><br /><span class="line">       AX = error code (see #1366 at INT 21/AH=59h/BX=0000h)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Note:</span>  superseded by AH=27h</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> AH=02h,AH=27h,AH=28h,AH=29h,AH=2Ah,INT 38</span><br /><span class="line"></span><br /><span class="line">Format of PC-MOS/386 Task Control Block:</span><br /><span class="line">Offset Size    Description (Table 3677)</span><br /><span class="line"> 00h   BYTE    signature byte &#34;H&#34; if allocated from system memory pool</span><br /><span class="line"> 01h   BYTE    header block ID, &#34;T&#34; = TCB</span><br /><span class="line"> 02h   WORD    length of block in paragraphs</span><br /><span class="line"> 04h   WORD    segment address of next header block (0000h if last)</span><br /><span class="line"> 06h   WORD    segment address of previous header block (0000h if first)</span><br /><span class="line"> 08h   WORD    pointer to next TCB</span><br /><span class="line"> 0Ah   WORD    pointer to previous TCB</span><br /><span class="line"> 0Ch   WORD    pointer to associated TCB (if applicable)</span><br /><span class="line"> 0Eh   WORD    reserved</span><br /><span class="line">---TCB---</span><br /><span class="line"> 10h   WORD    TCB task ID</span><br /><span class="line"> 12h   WORD    native context save area</span><br /><span class="line"> 14h   WORD    start address of task</span><br /><span class="line"> 16h   WORD    end address of task</span><br /><span class="line"> 18h   BYTE    task priority</span><br /><span class="line"> 19h   BYTE    task time slice</span><br /><span class="line"> 1Ah   BYTE    &#34;TCBWAIT&#34; run status of task</span><br /><span class="line"> 1Bh   BYTE    &#34;TCBSTAT&#34; what the task is waiting for</span><br /><span class="line"> 1Ch   DWORD   address of polling routine</span><br /><span class="line"> 20h   BYTE    error code from last function call</span><br /><span class="line"> 21h 11 BYTEs  name of currently executing task</span><br /><span class="line"> 2Ch  4 BYTEs  ???</span><br /><span class="line"> 30h   BYTE    keyboard disabled if bit 1 set</span><br /><span class="line"> 31h   BYTE    current shift state and toggles</span><br /><span class="line"> 32h  2 BYTEs  ???</span><br /><span class="line"> 34h   BYTE    current video mode</span><br /><span class="line"> 35h   BYTE    current video page</span><br /><span class="line"> 36h   BYTE    number of text columns per screen</span><br /><span class="line"> 37h   BYTE    number of text rows per screen</span><br /><span class="line"> 38h   WORD    length of video buffer</span><br /><span class="line"> 3Ah   WORD    video page length</span><br /><span class="line"> 3Ch   WORD    apge start address in video RAM</span><br /><span class="line"> 3Eh  4 WORDs  current cursor positions for four screen pages</span><br /><span class="line"> 46h  8 BYTEs  ???</span><br /><span class="line"> 4Eh   WORD    current cursor type</span><br /><span class="line"> 50h   BYTE    current palette setting</span><br /><span class="line"> 51h   BYTE    original video mode</span><br /><span class="line"> 52h   BYTE    start CRT row (00h or 01h)</span><br /><span class="line"> 53h   BYTE    video RAM in task active</span><br /><span class="line"> 54h   WORD    handle of video save area</span><br /><span class="line"> 56h   WORD    page count of video save area</span><br /><span class="line"> 58h   WORD    segment address of video save area</span><br /><span class="line"> 5Ah   WORD    poitner to first Task File Block (see #3680)</span><br /><span class="line"> 5Ch   WORD    pointer to first Current Directory Block (see #3683)</span><br /><span class="line"> 5Eh   WORD    pointer to active Current Directory Block (see #3683)</span><br /><span class="line"> 60h   BYTE    number of drives</span><br /><span class="line"> 61h   BYTE    current drive (0=A:, etc.)</span><br /><span class="line"> 62h   DWORD   disk transfer address</span><br /><span class="line"> 66h  4 BYTEs  ???</span><br /><span class="line"> 6Ah   BYTE    verify flag (nonzero = on)</span><br /><span class="line"> 6Bh   BYTE    break flag (nonzero = on)</span><br /><span class="line"> 6Ch   WORD    share/lock retry count</span><br /><span class="line"> 6Eh   WORD    ticks between share/lock retries</span><br /><span class="line"> 70h   BYTE    remote printer flags (see #3678)</span><br /><span class="line"> 71h   BYTE    ETX/ACK delay count</span><br /><span class="line"> 72h   WORD    spooler segment address</span><br /><span class="line"> 74h  2 BYTEs  ???</span><br /><span class="line"> 76h  3 BYTEs  remote printer redirection for LPT1 through LPT3 (see #3679)</span><br /><span class="line"> 79h  2 BYTEs  ???</span><br /><span class="line"> 7Bh   DWORD   offset of username in TCB</span><br /><span class="line"> 7Fh   BYTE    current output class</span><br /><span class="line"> 80h  7 BYTEs  protection access rights, 2 bits per class (writeable!)</span><br /><span class="line"> 87h 122 BYTEs ???</span><br /><span class="line">101h   BYTE    TCB sleep downcounter value</span><br /><span class="line">102h 20 BYTEs  ???</span><br /><span class="line">116h   BYTE    last scan code</span><br /><span class="line">   ...</span><br /><span class="line">5D0h   DWORD   far pointer to Device Driver Terminal&#39;s entry point</span><br /><span class="line">5D4h   WORD    offset of logical screen</span><br /><span class="line">5D6h   WORD    segment of logical screen</span><br /><span class="line">5D8h   WORD    cursor offset within page</span><br /><span class="line">5DAh   BYTE    screen columns</span><br /><span class="line">5DBh   WORD    async port number (0000h = none)</span><br /><span class="line">5DDh   DWORD   physical baudrate</span><br /><span class="line">5E1h 19 BYTEs  reserved for Device Driver Terminal (DDT)</span><br /><span class="line">   ...</span><br /><span class="line">7A6h   DWORD   far pointer to unregister calling chain</span><br /><span class="line"></span><br /><span class="line">Bitfields for PC-MOS/386 remote printer flags:</span><br /><span class="line">Bit(s) Description (Table 3678)</span><br /><span class="line"> 0 LPT1 to terminal</span><br /><span class="line"> 1 LPT2 to terminal</span><br /><span class="line"> 2 LPT3 to terminal</span><br /><span class="line"> 3 escape to printer pending</span><br /><span class="line"> 4 use XON/XOFF</span><br /><span class="line"> 5 use ETX/ACK</span><br /><span class="line"> 6 waiting for ACK or XON</span><br /><span class="line"> 7 transparent printing on</span><br /><span class="line"></span><br /><span class="line">(Table 3679)</span><br /><span class="line">Values for PC-MOS/386 remote printer redirection:</span><br /><span class="line"> 00h   not redirected</span><br /><span class="line"> 01h   redirected to COM1</span><br /><span class="line"> ...</span><br /><span class="line"> 18h   redirected to COM24</span><br /><span class="line"> 51h   redirected to LPT1</span><br /><span class="line"> 52h   redirected to LPT2</span><br /><span class="line"> 53h   redirected to LPT3</span><br /><span class="line"></span><br /><span class="line">Format of PC-MOS/386 Task File Block:</span><br /><span class="line">Offset Size    Description (Table 3680)</span><br /><span class="line"> 00h   BYTE    signature byte &#34;H&#34; if allocated from system memory pool</span><br /><span class="line"> 01h   BYTE    header block ID, &#34;F&#34; = task file block</span><br /><span class="line"> 02h   WORD    length of block in paragraphs</span><br /><span class="line"> 04h   WORD    segment address of next header block (0000h if last)</span><br /><span class="line"> 06h   WORD    segment address of previous header block (0000h if first)</span><br /><span class="line"> 08h   WORD    pointer to next TCB</span><br /><span class="line"> 0Ah   WORD    pointer to previous TCB</span><br /><span class="line"> 0Ch   WORD    pointer to associated TCB (if applicable)</span><br /><span class="line"> 0Eh   WORD    reserved</span><br /><span class="line">---TFB---</span><br /><span class="line"> 10h   WORD    segment address of next TFB</span><br /><span class="line"> 12h   WORD    segment address of previous TFB</span><br /><span class="line"> 14h   WORD    segment address of TFB&#39;s Global File Block (see #3682)</span><br /><span class="line"> 16h   WORD    segment address of owner&#39;s PSP</span><br /><span class="line"> 18h   WORD    file handle</span><br /><span class="line"> 1Ah  3 BYTEs  ???</span><br /><span class="line"> 1Dh   DWORD   file position</span><br /><span class="line"> 21h  4 BYTEs  ???</span><br /><span class="line"> 25h   BYTE    IOCTL flags (see #3681)</span><br /><span class="line"> 26h  2 BYTEs  ???</span><br /><span class="line"></span><br /><span class="line">Bitfields for PC-MOS/386 IOCTL flags:</span><br /><span class="line">Bit(s) Description (Table 3681)</span><br /><span class="line"> 0 stdin</span><br /><span class="line"> 1 stdout</span><br /><span class="line"> 2 null device</span><br /><span class="line"> 3 clock device</span><br /><span class="line"> 4 reserved</span><br /><span class="line"> 5 ASCII mode instead of binary</span><br /><span class="line"> 6 EOF encountered on input</span><br /><span class="line"> 7 device rather than file</span><br /><span class="line"></span><br /><span class="line">Format of PC-MOS/386 Global File Block:</span><br /><span class="line">Offset Size    Description (Table 3682)</span><br /><span class="line"> 00h   BYTE    signature byte &#34;H&#34; if allocated from system memory pool</span><br /><span class="line"> 01h   BYTE    header block ID, &#34;G&#34; = global file block</span><br /><span class="line"> 02h   WORD    length of block in paragraphs</span><br /><span class="line"> 04h   WORD    segment address of next header block (0000h if last)</span><br /><span class="line"> 06h   WORD    segment address of previous header block (0000h if first)</span><br /><span class="line"> 08h   WORD    pointer to next TCB</span><br /><span class="line"> 0Ah   WORD    pointer to previous TCB</span><br /><span class="line"> 0Ch   WORD    pointer to associated TCB (if applicable)</span><br /><span class="line"> 0Eh   WORD    reserved</span><br /><span class="line">---GFB---</span><br /><span class="line"> 10h 10 BYTEs  ???</span><br /><span class="line"> 1Ah   WORD    file attribute</span><br /><span class="line"> 1Ch   BYTE    ???</span><br /><span class="line"> 1Dh   DWORD   address of device driver</span><br /><span class="line"> 21h   WORD    first cluster</span><br /><span class="line"> 23h   WORD    time of last modification</span><br /><span class="line"> 25h   WORD    date of last modification</span><br /><span class="line"> 27h   DWORD   size of file in bytes</span><br /><span class="line"> 2Bh 11 BYTEs  ???</span><br /><span class="line"> 36h 11 BYTEs  device name or FCB-format filename</span><br /><span class="line"> 41h   WORD    segment address of TFB list</span><br /><span class="line"> 43h   WORD    segment address of first RLB (see #3685) (0000h = none)</span><br /><span class="line"> 45h   BYTE    flag: nonzero if GFB refers to character device</span><br /><span class="line"> 46h   WORD    address of Block Device Block (see #3684)</span><br /><span class="line"> 48h   WORD    sector of file&#39;s directory entry (see #1041)</span><br /><span class="line"> 4Ah   WORD    high word of file&#39;s directory entry</span><br /><span class="line"> 4Ch   WORD    ofsset of directory entry within sector</span><br /><span class="line"></span><br /><span class="line">Format of PC-MOS/386 Current Directory Block:</span><br /><span class="line">Offset Size    Description (Table 3683)</span><br /><span class="line"> 00h   BYTE    signature byte &#34;H&#34; if allocated from system memory pool</span><br /><span class="line"> 01h   BYTE    header block ID, &#34;C&#34; = current directory block</span><br /><span class="line"> 02h   WORD    length of block in paragraphs</span><br /><span class="line"> 04h   WORD    segment address of next header block (0000h if last)</span><br /><span class="line"> 06h   WORD    segment address of previous header block (0000h if first)</span><br /><span class="line"> 08h   WORD    pointer to next TCB</span><br /><span class="line"> 0Ah   WORD    pointer to previous TCB</span><br /><span class="line"> 0Ch   WORD    pointer to associated TCB (if applicable)</span><br /><span class="line"> 0Eh   WORD    reserved</span><br /><span class="line">---CDB---</span><br /><span class="line"> 10h   BYTE    drive number</span><br /><span class="line"> 11h   BYTE    ???</span><br /><span class="line"> 12h 64 BYTEs  directory name</span><br /><span class="line"> 52h   WORD    first directory cluster (0000h = root)</span><br /><span class="line"></span><br /><span class="line">Format of PC-MOS/386 Block Device Block:</span><br /><span class="line">Offset Size    Description (Table 3684)</span><br /><span class="line"> 00h   BYTE    signature byte &#34;H&#34; if allocated from system memory pool</span><br /><span class="line"> 01h   BYTE    header block ID, &#34;B&#34; = block device block</span><br /><span class="line"> 02h   WORD    length of block in paragraphs</span><br /><span class="line"> 04h   WORD    segment address of next header block (0000h if last)</span><br /><span class="line"> 06h   WORD    segment address of previous header block (0000h if first)</span><br /><span class="line"> 08h   WORD    pointer to next TCB</span><br /><span class="line"> 0Ah   WORD    pointer to previous TCB</span><br /><span class="line"> 0Ch   WORD    pointer to associated TCB (if applicable)</span><br /><span class="line"> 0Eh   WORD    reserved</span><br /><span class="line">---BDB---</span><br /><span class="line"> 10h   BYTE    logical drive</span><br /><span class="line"> 11h   BYTE    unit passed to driver</span><br /><span class="line"> 12h   WORD    sector size</span><br /><span class="line"> 14h   BYTE    cluster mask</span><br /><span class="line"> 15h   BYTE    cluster shift count</span><br /><span class="line"> 16h   WORD    starting sector of first FAT</span><br /><span class="line"> 18h   BYTE    number of FATs</span><br /><span class="line"> 19h   WORD    number of root directories</span><br /><span class="line"> 1Bh   WORD    sector number of first data sector (cluster 0002h)</span><br /><span class="line"> 1Dh   WORD    number of clusters + 1 (number of highest data cluster)</span><br /><span class="line"> 1Fh   BYTE    number of sectors in FAT</span><br /><span class="line"> 20h   WORD    beginning root directory sector number</span><br /><span class="line"> 22h   DWORD   device driver address</span><br /><span class="line"> 26h   BYTE    media descriptor byte</span><br /><span class="line"> 27h  5 BYTEs  ???</span><br /><span class="line"> 2Ch   BYTE    flag: volume &gt; 32MB</span><br /><span class="line"> 2Dh   BYTE    ???</span><br /><span class="line"> 2Eh   BYTE    number of sectors per cluster</span><br /><span class="line"> 2Fh   WORD    number of clusters on device</span><br /><span class="line"> 31h   WORD    number of free clusters (FFFFh = unknown)</span><br /><span class="line"> 33h   WORD    root directory cluster number</span><br /><span class="line"> 35h   WORD    pointer to alias/subst string</span><br /><span class="line"> 37h   WORD    TCB segment address of owner (0000h = none)</span><br /><span class="line"></span><br /><span class="line">Format of PC-MOS/386 Record Lock Block:</span><br /><span class="line">Offset Size    Description (Table 3685)</span><br /><span class="line"> 00h   BYTE    signature byte &#34;H&#34; if allocated from system memory pool</span><br /><span class="line"> 01h   BYTE    header block ID, &#34;R&#34; = record lock block</span><br /><span class="line"> 02h   WORD    length of block in paragraphs</span><br /><span class="line"> 04h   WORD    segment address of next header block (0000h if last)</span><br /><span class="line"> 06h   WORD    segment address of previous header block (0000h if first)</span><br /><span class="line"> 08h   WORD    pointer to next TCB</span><br /><span class="line"> 0Ah   WORD    pointer to previous TCB</span><br /><span class="line"> 0Ch   WORD    pointer to associated TCB (if applicable)</span><br /><span class="line"> 0Eh   WORD    reserved</span><br /><span class="line">---RLB---</span><br /><span class="line"> 10h   WORD    segment address of owner&#39;s PSP</span><br /><span class="line"> 12h   WORD    segment address of Global File Block (see #3682)</span><br /><span class="line"> 14h   WORD    segment address of owner&#39;s Task File Block (see #3680)</span><br /><span class="line"> 16h   DWORD   file offset of locked region start</span><br /><span class="line"> 1Ah   DWORD   length of locked region</span><br /><span class="line"> 1Eh   WORD    owner&#39;s handle for file</span><br /></pre>
  
  
  


      </article>

    </section>

  </body>

</html>

