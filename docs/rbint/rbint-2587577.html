





<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="generator" content="ng2web v1.1.0 (ngdb v1.1.0)">
    <link rel="stylesheet" type="text/css" href="rbint-style.css">
    <title>Ralf Brown » Lists » Interrupts</title>
    <meta name="description" content="Ralf Brown">
    <link rel="prev" href="rbint-2586771.html">
    <link rel="next" href="rbint-2597064.html">
    
  </head>

  <body>

    <header>
      <nav class="box">
        <ul>
          

<li><a href="rbint-about.html">About</a></li>


          

<li><a href="rbint-2586771.html">Previous</a></li>


          

<li><a href="rbint-2471063.html">Up</a></li>


          

<li><a href="rbint-2597064.html">Next</a></li>


        </ul>
      </nav>
    </header>

    <section>

      <nav class="menu box">
        <ul>
            <li>Lists</li>
            <ul>
              <li><a href="index.html">Comments</a></li>
              <li><a href="rbint-7995.html">Interrupts</a></li>
              <li><a href="rbint-15401.html">Glossary</a></li>
              <li><a href="rbint-64347.html">Memory</a></li>
              <li><a href="rbint-180090.html">CMOS</a></li>
              <li><a href="rbint-250757.html">86 Bugs</a></li>
              
            </ul>
        </ul>
      </nav>

      <article class="box">
        
  
  
    <pre class="entry"><span class="line"></span><br /><span class="line"><span class="ngu">Int 21 Fn 5D06  U - Dos 3.0+ Internal - Get Address Of Dos Swappable Data</span>  [<span class="ngb">D</span>]</span><br /><span class="line"></span><br /><span class="line">   AX = 5D06h</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Return:</span> CF set on error</span><br /><span class="line">      AX = error code (see #1366)</span><br /><span class="line">   CF clear if successful</span><br /><span class="line">       DS:SI -&gt; nonreentrant data area (includes all three DOS stacks)</span><br /><span class="line">       (critical error flag is first byte) (see #1373)</span><br /><span class="line">       CX = size in bytes of area which must be swapped while in DOS</span><br /><span class="line">       DX = size in bytes of area which must always be swapped</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Notes:</span> the Critical Error flag is used in conjunction with the InDOS flag</span><br /><span class="line">     (see AH=34h) to determine when it is safe to enter DOS from a TSR</span><br /><span class="line">   setting CritErr flag allows use of functions 50h/51h from INT 28h under</span><br /><span class="line">     DOS 2.x by forcing use of correct stack</span><br /><span class="line">   swapping the data area allows reentering DOS unless DOS is in a</span><br /><span class="line">     critical section delimited by INT 2A/AH=80h and INT 2A/AH=81h,82h</span><br /><span class="line">   under DOS 4.0, AX=5D0Bh should be used instead of this function</span><br /><span class="line">   SHARE and other DOS utilities consult the byte at offset 04h in the</span><br /><span class="line">     DOS data segment (see INT 2F/AX=1203h) to determine the SDA format</span><br /><span class="line">     in use: 00h = DOS 3.x, 01h = DOS 4.0-6.0, other = error.</span><br /><span class="line">   DR DOS 3.41+ supports this function, but the SDA format beyond the</span><br /><span class="line">     first 18h bytes is completely different from MS-DOS</span><br /><span class="line">BUG:   calling this function with certain values in DX crashes Novell DOS 7.0</span><br /><span class="line">     prior to Update 14</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> AX=5D0Bh,INT 2A/AH=80h,INT 2A/AH=81h,INT 2A/AH=82h</span><br /><span class="line"></span><br /><span class="line">Format of DOS 3.10-3.30 Swappable Data Area:</span><br /><span class="line">Offset Size    Description (Table 1373)</span><br /><span class="line"> -34   BYTE    (DOS 3.10+) printer echo flag (00h off, FFh active)</span><br /><span class="line"> -31   BYTE    (DOS 3.30) current switch character</span><br /><span class="line"> -30   BYTE    current memory allocation strategy (see AH=58h)</span><br /><span class="line"> -28   BYTE    (DOS 3.30) incremented on each INT 21/AX=5E01h call</span><br /><span class="line"> -27 16 BYTEs  (DOS 3.30) machine name set by INT 21/AX=5E01h</span><br /><span class="line"> -11  5 WORDs  zero-terminated list of offsets which need to be patched to</span><br /><span class="line">         enable critical-section calls (see INT 2A/AH=80h)</span><br /><span class="line"> -1    BYTE    unused padding</span><br /><span class="line">---start of actual SDA---</span><br /><span class="line"> 00h   BYTE    critical error flag (&#34;ErrorMode&#34;)</span><br /><span class="line"> 01h   BYTE    InDOS flag (count of active INT 21 calls)</span><br /><span class="line"> 02h   BYTE    drive on which current critical error occurred, or FFh</span><br /><span class="line">       (DR DOS sets to drive number during INT 24, 00h otherwise)</span><br /><span class="line"> 03h   BYTE    locus of last error</span><br /><span class="line"> 04h   WORD    extended error code of last error</span><br /><span class="line"> 06h   BYTE    suggested action for last error</span><br /><span class="line"> 07h   BYTE    class of last error</span><br /><span class="line"> 08h   DWORD   ES:DI pointer for last error</span><br /><span class="line"> 0Ch   DWORD   current DTA (Disk Transfer Address)</span><br /><span class="line">       note: may point into SDA during the DOS EXEC function</span><br /><span class="line">         (see AH=4Bh), so programs which swap the SDA must be</span><br /><span class="line">         prepared to move the DTA to a private buffer if they</span><br /><span class="line">         might be invoked during an EXEC</span><br /><span class="line"> 10h   WORD    current PSP</span><br /><span class="line"> 12h   WORD    stores SP across an INT 23</span><br /><span class="line"> 14h   WORD    return code from last process termination (zerod after reading</span><br /><span class="line">         with AH=4Dh)</span><br /><span class="line"> 16h   BYTE    current drive</span><br /><span class="line"> 17h   BYTE    extended break flag</span><br /><span class="line">---remainder need only be swapped if in DOS---</span><br /><span class="line"> 18h   WORD    value of AX on call to INT 21</span><br /><span class="line"> 1Ah   WORD    PSP segment for sharing/network</span><br /><span class="line"> 1Ch   WORD    network machine number for sharing/network (0000h = us)</span><br /><span class="line"> 1Eh   WORD    first usable memory block found when allocating memory</span><br /><span class="line"> 20h   WORD    best usable memory block found when allocating memory</span><br /><span class="line"> 22h   WORD    last usable memory block found when allocating memory</span><br /><span class="line"> 24h   WORD    memory size in paragraphs (used only during initialization)</span><br /><span class="line"> 26h   WORD    last entry checked during directory search</span><br /><span class="line"> 28h   BYTE    flag: INT 24 returned Fail</span><br /><span class="line"> 29h   BYTE    flags: allowable INT 24 actions (passed to INT 24 in AH)</span><br /><span class="line"> 2Ah   BYTE    directory flag (00h directory, 01h file)</span><br /><span class="line"> 2Bh   BYTE    flag: FFh if Ctrl-Break termination, 00h otherwise</span><br /><span class="line"> 2Ch   BYTE    flag: allow embedded blanks in FCB</span><br /><span class="line"> 2Dh   BYTE    padding (unused)</span><br /><span class="line"> 2Eh   BYTE    day of month</span><br /><span class="line"> 2Fh   BYTE    month</span><br /><span class="line"> 30h   WORD    year - 1980</span><br /><span class="line"> 32h   WORD    number of days since 01jan1980</span><br /><span class="line"> 34h   BYTE    day of week (0 = Sunday)</span><br /><span class="line"> 35h   BYTE    flag: console swapped during read from device</span><br /><span class="line"> 36h   BYTE    flag: safe to call INT 28 if nonzero</span><br /><span class="line"> 37h   BYTE    flag: if nonzero, INT 24 Abort turned into INT 24 Fail</span><br /><span class="line">       (set only during process termination)</span><br /><span class="line"> 38h 26 BYTEs  device driver request header (see #2284 at INT 2F/AX=0802h)</span><br /><span class="line"> 52h   DWORD   pointer to device driver entry point (used in calling driver)</span><br /><span class="line"> 56h 22 BYTEs  device driver request header for I/O calls</span><br /><span class="line"> 6Ch 14 BYTEs  device driver request header for disk status check</span><br /><span class="line"> 7Ah   DWORD   pointer to device I/O buffer???</span><br /><span class="line"> 7Eh   WORD    ???</span><br /><span class="line"> 80h   WORD    ???</span><br /><span class="line"> 82h   BYTE    type of PSP copy (00h=simple for INT 21/AH=26h, FFh=make child)</span><br /><span class="line"> 83h   BYTE    padding (unused)</span><br /><span class="line"> 84h  3 BYTEs  24-bit user number (see AH=30h)</span><br /><span class="line"> 87h   BYTE    OEM number (see #1082 at AH=30h)</span><br /><span class="line"> 88h   WORD    offset to error code conversion table for INT 25/INT 26</span><br /><span class="line"> 8Ah  6 BYTEs  CLOCK$ transfer record (see #1374)</span><br /><span class="line"> 90h   BYTE    device I/O buffer for single-byte I/O functions</span><br /><span class="line"> 91h   BYTE    padding??? (unused)</span><br /><span class="line"> 92h 128 BYTEs buffer for filename</span><br /><span class="line">112h 128 BYTEs buffer for filename</span><br /><span class="line">192h 21 BYTEs  findfirst/findnext search data block (see #1312 at AH=4Eh)</span><br /><span class="line">1A7h 32 BYTEs  directory entry for found file (see #1041 at AH=11h)</span><br /><span class="line">1C7h 81 BYTEs  copy of current directory structure for drive being accessed</span><br /><span class="line">218h 11 BYTEs  FCB-format filename for device name comparison</span><br /><span class="line">223h   BYTE    terminating NUL for above filename</span><br /><span class="line">224h 11 BYTEs  wildcard destination specification for rename (FCB format)</span><br /><span class="line">22Fh   BYTE    terminating NUL for above spec</span><br /><span class="line">230h   BYTE    ???</span><br /><span class="line">231h   WORD    destination file/directory starting sector</span><br /><span class="line">233h  5 BYTEs  ???</span><br /><span class="line">238h   BYTE    extended FCB file attribute</span><br /><span class="line">239h   BYTE    type of FCB (00h regular, FFh extended)</span><br /><span class="line">23Ah   BYTE    directory search attributes</span><br /><span class="line">23Bh   BYTE    file open/access mode</span><br /><span class="line">23Ch   BYTE    file found/delete flag</span><br /><span class="line">       bit 0: file found</span><br /><span class="line">       bit 4: file deleted</span><br /><span class="line">23Dh   BYTE    flag: device name found on rename, or file not found</span><br /><span class="line">23Eh   BYTE    splice flag (file name and directory name together)</span><br /><span class="line">23Fh   BYTE    flag indicating how DOS function was invoked</span><br /><span class="line">       (00h = direct INT 20/INT 21, FFh = server call AX=5D00h)</span><br /><span class="line">240h   BYTE    sector position within cluster</span><br /><span class="line">241h   BYTE    flag: translate sector/cluster (00h no, 01h yes)</span><br /><span class="line">242h   BYTE    flag: 00h if read, 01h if write</span><br /><span class="line">243h   BYTE    current working drive number</span><br /><span class="line">244h   BYTE    cluster factor</span><br /><span class="line">245h   BYTE    flag: cluster split mode</span><br /><span class="line">246h   BYTE    line edit (AH=0Ah) insert mode flag (nonzero = on)</span><br /><span class="line">247h   BYTE    canonicalized filename referred to existing file/dir if FFh</span><br /><span class="line">248h   BYTE    volume ID flag</span><br /><span class="line">249h   BYTE    type of process termination (00h-03h) (see AH=4Dh)</span><br /><span class="line">24Ah   BYTE    file create flag (00h = no, search only)</span><br /><span class="line">24Bh   BYTE    value with which to replace first byte of deleted file&#39;s name</span><br /><span class="line">         (normally E5h, but 00h as described under INT 21/AH=13h)</span><br /><span class="line">24Ch   DWORD   pointer to Drive Parameter Block for critical error invocation</span><br /><span class="line">       temp: used during process termination</span><br /><span class="line">250h   DWORD   pointer to stack frame containing user registers on INT 21</span><br /><span class="line">254h   WORD    stores SP across INT 24</span><br /><span class="line">256h   DWORD   pointer to DOS Drive Parameter Block for ???</span><br /><span class="line">25Ah   WORD    saving partial cluster number</span><br /><span class="line">25Ch   WORD    temp: sector of work current cluster</span><br /><span class="line">25Eh   WORD    high part of cluster number (only low byte referenced)</span><br /><span class="line">260h   WORD    ??? temp</span><br /><span class="line">262h   BYTE    Media ID byte returned by AH=1Bh,1Ch</span><br /><span class="line">263h   BYTE    padding (unused)</span><br /><span class="line">264h   DWORD   pointer to device header when filename is character device</span><br /><span class="line">268h   DWORD   pointer to current SFT</span><br /><span class="line">26Ch   DWORD   pointer to current directory structure for drive being accessed</span><br /><span class="line">270h   DWORD   pointer to caller&#39;s FCB</span><br /><span class="line">274h   WORD    number of SFT to which file being opened will refer</span><br /><span class="line">276h   WORD    temporary storage for file handle</span><br /><span class="line">278h   DWORD   pointer to a JFT entry in process handle table</span><br /><span class="line">         (see #1066 at AH=26h)</span><br /><span class="line">27Ch   WORD    offset in DOS DS of first filename argument</span><br /><span class="line">27Eh   WORD    offset in DOS DS of second filename argument</span><br /><span class="line">280h   WORD    offset of last component in pathname or FFFFh</span><br /><span class="line">282h   WORD    offset of transfer address to add</span><br /><span class="line">284h   WORD    last relative cluster within file being accessed</span><br /><span class="line">286h   WORD    temp: absolute cluster number being accessed</span><br /><span class="line">288h   WORD    directory sector number</span><br /><span class="line">28Ah   WORD    ??? current cluster number</span><br /><span class="line">28Ch   WORD    current relative sector number within file</span><br /><span class="line">28Eh   WORD    current sector number</span><br /><span class="line">290h   WORD    current byte offset within sector</span><br /><span class="line">292h   DWORD   current offset in file</span><br /><span class="line">296h   DWORD   temp: file byte count</span><br /><span class="line">29Ah   WORD    temp: file byte count</span><br /><span class="line">29Ch   WORD    free file cluster entry</span><br /><span class="line">29Eh   WORD    last file cluster entry</span><br /><span class="line">2A0h   WORD    next file cluster number</span><br /><span class="line">2A2h   DWORD   number of bytes appended to file</span><br /><span class="line">2A6h   DWORD   pointer to current work disk buffer</span><br /><span class="line">2AAh   DWORD   pointer to working SFT</span><br /><span class="line">2AEh   WORD    used by INT 21 dispatcher to store caller&#39;s BX</span><br /><span class="line">2B0h   WORD    used by INT 21 dispatcher to store caller&#39;s DS</span><br /><span class="line">2B2h   WORD    temporary storage while saving/restoring caller&#39;s registers</span><br /><span class="line">2B4h   DWORD   pointer to prev call frame (offset 250h) if INT 21 reentered</span><br /><span class="line">       also switched to for duration of INT 24</span><br /><span class="line">2B8h 21 BYTEs  FindFirst search data for source file(s) of a rename operation</span><br /><span class="line">       (see #1312 at AH=4Eh)</span><br /><span class="line">2CDh 32 BYTEs  directory entry for file being renamed (see #1041 at AH=11h)</span><br /><span class="line">2EDh 331 BYTEs critical error stack</span><br /><span class="line">   403h     35 BYTEs scratch SFT</span><br /><span class="line">438h 384 BYTEs disk stack (functions greater than 0Ch, INT 25,INT 26)</span><br /><span class="line">5B8h 384 BYTEs character I/O stack (functions 01h through 0Ch)</span><br /><span class="line">---DOS 3.2,3.3x only---</span><br /><span class="line">738h   BYTE    device driver lookahead flag (usually printer)</span><br /><span class="line">       (see AH=64h&#34;DOS 3.2+&#34;)</span><br /><span class="line">739h   BYTE    volume change flag</span><br /><span class="line">73Ah   BYTE    flag: virtual open</span><br /><span class="line">73Bh   BYTE    ???</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #1376</span><br /><span class="line"></span><br /><span class="line">Format of CLOCK$ transfer record:</span><br /><span class="line">Offset Size    Description (Table 1374)</span><br /><span class="line"> 00h   WORD    number of days since 1-Jan-1980</span><br /><span class="line"> 02h   BYTE    minutes</span><br /><span class="line"> 03h   BYTE    hours</span><br /><span class="line"> 04h   BYTE    hundredths of second</span><br /><span class="line"> 05h   BYTE    seconds</span><br /></pre>
  
  
  


      </article>

    </section>

  </body>

</html>

