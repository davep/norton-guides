





<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="generator" content="ng2web v1.1.0 (ngdb v1.1.0)">
    <link rel="stylesheet" type="text/css" href="rbint-style.css">
    <title>Ralf Brown » Lists » Interrupts</title>
    <meta name="description" content="Ralf Brown">
    <link rel="prev" href="rbint-5743214.html">
    <link rel="next" href="rbint-5749083.html">
    
  </head>

  <body>

    <header>
      <nav class="box">
        <ul>
          

<li><a href="../index.html">Guides</a></li>


          

<li><a href="rbint-about.html">About</a></li>


          

<li><a href="rbint-5743214.html">Previous</a></li>


          

<li><a href="rbint-5735217.html">Up</a></li>


          

<li><a href="rbint-5749083.html">Next</a></li>


        </ul>
      </nav>
    </header>

    <section>

      <nav class="menu box">
        <ul>
            <li>Lists</li>
            <ul>
              <li><a href="index.html">Comments</a></li>
              <li><a href="rbint-7995.html">Interrupts</a></li>
              <li><a href="rbint-15401.html">Glossary</a></li>
              <li><a href="rbint-64347.html">Memory</a></li>
              <li><a href="rbint-180090.html">CMOS</a></li>
              <li><a href="rbint-250757.html">86 Bugs</a></li>
              
            </ul>
        </ul>
      </nav>

      <article class="box">
        
  
  
    <pre class="entry"><span class="line"></span><br /><span class="line"><span class="ngu">Int 78 Fn 0001  - Hugerealmode Driver - Get Entry Point                  </span>  [<span class="ngb">E</span>]</span><br /><span class="line"></span><br /><span class="line">   AX = 0001h</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Return:</span> ES:BX -&gt; far call entry point (see #3459,#3474)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> AX=0000h</span><br /><span class="line"></span><br /><span class="line">(Table 3458)</span><br /><span class="line">Values for HugeRealMode Server error code:</span><br /><span class="line"> 00h   successful</span><br /><span class="line"> 01h   unknown function</span><br /><span class="line"> 02h   A20 disabled</span><br /><span class="line"> 03h   A20 enabled</span><br /><span class="line"> 04h   memory allocation error</span><br /><span class="line"> 05h   memory not fixeable (LOCK)</span><br /><span class="line"> 06h   memory not deallocaable</span><br /><span class="line"> 07h   memory not moveable (UNLOCK)</span><br /><span class="line"> 08h   change in memory allocation size not possible</span><br /><span class="line"> 09h   file error (with .XMF-file)</span><br /><span class="line"> 0Ah   memory error (with .XMF-file)</span><br /><span class="line"> 0Bh   unknown procedure (currently Turbo Pascal unit only)</span><br /><span class="line"></span><br /><span class="line">(Table 3459)</span><br /><span class="line">Call HugeRealMode Server &#34;Enable A20&#34; function with:</span><br /><span class="line">   AL = 00h</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Return:</span> AX = error code (see #3458)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Note:</span>  The HugeRealMode Server requires an XMS-driver like HIMEM.SYS loaded</span><br /><span class="line">     before HUGEREAL (for XMS-memory allocation and A20 control). It</span><br /><span class="line">     utilizes some undocumented 386+ features to enable 4G code and data</span><br /><span class="line">     segments (flat memory model) in the CPUs real-mode. It is not</span><br /><span class="line">     compatible with V86-mode (as with most EMM386). For maximum speed</span><br /><span class="line">     and compatibility with DOS it uses a two stage interrupt model</span><br /><span class="line">     (see #3462)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #3460,#3461,#3462</span><br /><span class="line"></span><br /><span class="line">(Table 3460)</span><br /><span class="line">Call HugeRealMode Server &#34;Disable A20&#34; function with:</span><br /><span class="line">   AL = 01h</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Return:</span> AX = error code (see #3458)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #3459,#3461</span><br /><span class="line"></span><br /><span class="line">(Table 3461)</span><br /><span class="line">Call HugeRealMode Server &#34;Query A20 State&#34; function with:</span><br /><span class="line">   AL = 02h</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Return:</span> AX = A20 state (0000h disabled, 0001h enabled)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #3459,#3460</span><br /><span class="line"></span><br /><span class="line">(Table 3462)</span><br /><span class="line">Call HugeRealMode Server &#34;Enable Two-Stage Interrupt Model&#34; function with:</span><br /><span class="line">   AL = 03h</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Return:</span> AX = error code (see #3458)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Notes:</span> If the two stage interrupt model is disabled, the IP must stay below</span><br /><span class="line">     1MB, because the high word of EIP is not saved correctly by the</span><br /><span class="line">     standard interrupt management in real mode.  Routines in extended</span><br /><span class="line">     memory may only be called with interrupts disabled (only usable for</span><br /><span class="line">     very short routines).</span><br /><span class="line">   If the two stage interupt model is enabled, these conventions are not</span><br /><span class="line">     required.  The outer (transparent) ISRs save the higher word of EIP</span><br /><span class="line">     in the high word of CR3 (possible modification: in memory, if this</span><br /><span class="line">     is not safe) and then invoke the standard ISRs.</span><br /><span class="line">   Because of this handling, one should use pseudo segmented code even in</span><br /><span class="line">     extended memory (64K blocks located on 64K boundaries) to avoid the</span><br /><span class="line">     misalignment of the saved EIP (in CR3). Another way is to track and</span><br /><span class="line">     realign CR3 each time when jumping over a 64K boundary in extended</span><br /><span class="line">     memory</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #3459,#3463</span><br /><span class="line"></span><br /><span class="line">(Table 3463)</span><br /><span class="line">Call HugeRealMode Server &#34;Disable Two-Stage Interrupt Model&#34; function with:</span><br /><span class="line">   AL = 04h</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Return:</span> AX = error code (see #3458)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #3459,#3462</span><br /><span class="line"></span><br /><span class="line">(Table 3464)</span><br /><span class="line">Call HugeRealMode Server &#34;Get Segment Address Of Server-Management Range&#34; with:</span><br /><span class="line">   AL = 05h</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Return:</span> AX = error code (see #3458)</span><br /><span class="line">   ES = segment address</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #3474</span><br /><span class="line"></span><br /><span class="line">(Table 3465)</span><br /><span class="line">Call HugeRealMode Server &#34;Allocate Memory&#34; function with:</span><br /><span class="line">   AL = 06h</span><br /><span class="line">   DX = length in KB</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Return:</span> AX = error code (see #3458)</span><br /><span class="line">   DX = handle</span><br /><span class="line">   EBX = start address of allocated block</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #3466,#3467</span><br /><span class="line"></span><br /><span class="line">(Table 3466)</span><br /><span class="line">Call HugeRealMode Server &#34;Deallocate Memory&#34; function with:</span><br /><span class="line">   AL = 07h</span><br /><span class="line">   DX = handle</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Return:</span> AX = error code (see #3458)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #3465,#3467</span><br /><span class="line"></span><br /><span class="line">(Table 3467)</span><br /><span class="line">Call HugeRealMode Server &#34;Modify Allocated Memory Size&#34; function with:</span><br /><span class="line">   AL = 08h</span><br /><span class="line">   DX = handle</span><br /><span class="line">   BX = new size in KB</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Return:</span> AX = error code (see #3458)</span><br /><span class="line">   EBX = new address</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #3465,#3466</span><br /><span class="line"></span><br /><span class="line">(Table 3468)</span><br /><span class="line">Call HugeRealMode Server &#34;Load .XMF-file&#34; function with:</span><br /><span class="line">   AL = 09h</span><br /><span class="line">   ES:BX -&gt; filename (see #3469)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Return:</span> AX = error code (see #3458)</span><br /><span class="line">   ECX = target address</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Notes:</span> memory must be allocated before loading</span><br /><span class="line">   .XMF file format (eXtended Memory executable File format) is supported</span><br /><span class="line">     by the HugeRealMode server for easier handling of XMS-code.</span><br /><span class="line">   The utility CONFXMF converts .OBJ-files (.COM &#39;tiny&#39; model) to</span><br /><span class="line">     .XMF-format</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #3465</span><br /><span class="line"></span><br /><span class="line">Format of .XMF program file header:</span><br /><span class="line">Offset Size    Description (Table 3469)</span><br /><span class="line"> 00h   DWORD   signature &#34;XMF_&#34;</span><br /><span class="line"> 04h   WORD    length of programs code</span><br /><span class="line"> 06h   WORD    count of 32bit addresses to relocate</span><br /><span class="line"> 08h   WORD    offset to code start (releative to file start) (see #3470)</span><br /><span class="line"> 0Ah   WORD    relocation table</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Note:</span>  each word contains a 16bit address, where a relocation has to be</span><br /><span class="line">     performed</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #3468,#3470</span><br /><span class="line"></span><br /><span class="line">Format of .XMF-file code header:</span><br /><span class="line">Offset Size    Description (Table 3470)</span><br /><span class="line"> 00h   WORD    count of exported functions</span><br /><span class="line"> 02h  N PWORDs 48bit pointers (16bit segment+32bit offset) to each function</span><br /><span class="line">       (16bit segment is always zero)</span><br /><span class="line"> var       start of program&#39;s code</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #3468,#3469</span><br /><span class="line"></span><br /><span class="line">(Table 3471)</span><br /><span class="line">Call HugeRealMode Server &#34;Set Segment Limits&#34; function with:</span><br /><span class="line">   AL = 0Ah</span><br /><span class="line">   BL = segment limits (see #3472)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Return:</span> AX = error code (see #3458)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #3464</span><br /><span class="line"></span><br /><span class="line">Bitfields for HugeRealMode Server segment limits:</span><br /><span class="line">Bit(s) Description (Table 3472)</span><br /><span class="line"> 7 CS size: 1=4GB, 0=64KB</span><br /><span class="line"> 6-5   not used</span><br /><span class="line"> 4 SS size: 1=4GB, 0=64KB</span><br /><span class="line"> 3 GS size</span><br /><span class="line"> 2 FS size</span><br /><span class="line"> 1 ES size</span><br /><span class="line"> 0 DS size</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #3471</span><br /><span class="line"></span><br /><span class="line">(Table 3473)</span><br /><span class="line">Call HugeRealMode Server &#34;Transfer Memory From DOS To XMS&#34; function with:</span><br /><span class="line">   AL = 0Bh</span><br /><span class="line">   ES:SI = source address</span><br /><span class="line">   EDI = target address</span><br /><span class="line">   ECX = length</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Return:</span> AX = error code</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #3474</span><br /><span class="line"></span><br /><span class="line">(Table 3474)</span><br /><span class="line">Call HugeRealMode Server &#34;Transfer Memory From XMS To DOS&#34; function with:</span><br /><span class="line">   AL = 0Ch</span><br /><span class="line">   ESI = source address</span><br /><span class="line">   ES:DI = target address</span><br /><span class="line">   ECX = length</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Return:</span> AX = error code</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #3473</span><br /></pre>
  
  
  


      </article>

    </section>

  </body>

</html>

