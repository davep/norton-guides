





<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="generator" content="ng2web v1.1.0 (ngdb v1.1.0)">
    <link rel="stylesheet" type="text/css" href="rbint-style.css">
    <title>Ralf Brown » Lists » Interrupts</title>
    <meta name="description" content="Ralf Brown">
    <link rel="prev" href="rbint-4245986.html">
    <link rel="next" href="rbint-4251966.html">
    
  </head>

  <body>

    <header>
      <nav class="box">
        <ul>
          

<li><a href="rbint-about.html">About</a></li>


          

<li><a href="rbint-4245986.html">Previous</a></li>


          

<li><a href="rbint-4197937.html">Up</a></li>


          

<li><a href="rbint-4251966.html">Next</a></li>


        </ul>
      </nav>
    </header>

    <section>

      <nav class="menu box">
        <ul>
            <li>Lists</li>
            <ul>
              <li><a href="index.html">Comments</a></li>
              <li><a href="rbint-7995.html">Interrupts</a></li>
              <li><a href="rbint-15401.html">Glossary</a></li>
              <li><a href="rbint-64347.html">Memory</a></li>
              <li><a href="rbint-180090.html">CMOS</a></li>
              <li><a href="rbint-250757.html">86 Bugs</a></li>
              
            </ul>
        </ul>
      </nav>

      <article class="box">
        
  
  
    <pre class="entry"><span class="line"></span><br /><span class="line"><span class="ngu">Int 2F Fn AD80  u - Ms-dos 3.3+ Keyb.com Internal - Installation Check   </span>  [<span class="ngb">K</span>]</span><br /><span class="line"></span><br /><span class="line">   AX = AD80h</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Return:</span> AL = FFh if installed</span><br /><span class="line">       BX = version number (BH = major, BL = minor)</span><br /><span class="line">       ES:DI -&gt; internal data (see #2657)</span><br /><span class="line">       AH destroyed (set to FFh by some implementations/versions)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Notes:</span> MS-DOS 3.30, PC-DOS 4.01, MS-DOS 5.00, and MS-DOS 6.22 all report</span><br /><span class="line">     version 1.00.</span><br /><span class="line">   this function was undocumented prior to the release of DOS 5.0</span><br /><span class="line">   most versions of KEYB completely replace the BIOS INT 09 handler, but</span><br /><span class="line">     Novell DOS&#39;s KEYB partially uses the BIOS code and thus continues</span><br /><span class="line">     to chain to the original INT 09 at times</span><br /><span class="line">   some utilities check for AX=FFFFh on return</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> AX=AD80h&#34;Novell&#34;,AX=AD81h,AX=AD82h,AX=AD83h</span><br /><span class="line"></span><br /><span class="line">Format of KEYB internal data:</span><br /><span class="line">Offset Size    Description (Table 2657)</span><br /><span class="line"> 00h   DWORD   original INT 09</span><br /><span class="line"> 04h   DWORD   original INT 2F</span><br /><span class="line"> 08h   DWORD   unused (0) original INT 16 in older KEYB versions???</span><br /><span class="line"> 0Ch   WORD    flags A (see #3762)</span><br /><span class="line"> 0Eh   WORD    flags B (see #2658)</span><br /><span class="line"> 10h   BYTE    flags??? (bit1 used)</span><br /><span class="line"> 11h   BYTE    ???</span><br /><span class="line"> 12h  4 BYTEs  ???</span><br /><span class="line"> 16h  2 BYTEs  country ID letters, default is &#34;US&#34;</span><br /><span class="line"> 18h   WORD    current code page (see #1446 at INT 21/AX=6602h)</span><br /><span class="line">---DOS 3.3---</span><br /><span class="line"> 1Ah   WORD    pointer to first item in list of code page tables???</span><br /><span class="line"> 1Ch   WORD    pointer to ??? item in list of code page tables</span><br /><span class="line"> 1Eh  2 BYTEs  unused???</span><br /><span class="line"> 20h   WORD    pointer to key translation data (see #2660)</span><br /><span class="line"> 22h   WORD    pointer to last item in code page table list (see #2659)</span><br /><span class="line"> 24h  9 BYTEs  ???</span><br /><span class="line">---DOS 4.01---</span><br /><span class="line"> 1Ah  2 BYTEs  ???</span><br /><span class="line"> 1Ch   WORD    pointer to first item in list of code page tables???</span><br /><span class="line"> 1Eh   WORD    pointer to ??? item in list of code page tables</span><br /><span class="line"> 20h 2 BYTEs   unused???</span><br /><span class="line"> 22h   WORD    pointer to key translation data (see #2660)</span><br /><span class="line"> 24h   WORD    pointer to last item in code page table list (see #2659)</span><br /><span class="line"> 26h  9 BYTEs  ???</span><br /><span class="line">---DOS 6.22--- (checked out with 6.22, but might be earlier)</span><br /><span class="line"> 1Ah  2 BYTEs  ???</span><br /><span class="line"> 1Ch   WORD    pointer to current (first???) item in list of code page tables</span><br /><span class="line">       (corresponding to codepage indicated at offset 18h)</span><br /><span class="line">       (initial value is FFFFh)</span><br /><span class="line"> 1Eh   WORD    pointer to (entry to) list of code page tables (see #2659)</span><br /><span class="line">       If not FFFFh, INT 2F/AX=AD81h scans this list of code page</span><br /><span class="line">         tables until the requested code page was found in list or</span><br /><span class="line">         end of table was reached (FFFFh). If found, offsets 18h and</span><br /><span class="line">         1Ch will be changed to requested new code page. If not found,</span><br /><span class="line">         it returns with AX=0001h &#39;code page not supported&#39;).</span><br /><span class="line"> 20h   WORD    unused??? (initial value: FFFFh)</span><br /><span class="line"> 22h   WORD    pointer to key translation data (see #2143)</span><br /><span class="line"> 24h   WORD    pointer to last item in code page table list (see #2142)</span><br /><span class="line"> 26h   WORD    CAPSLock/ShiftLock management flags??? (0)</span><br /><span class="line"></span><br /><span class="line">       <span class="ngb">Note:</span>   It appears that none of the bits is ever set inside</span><br /><span class="line">             KEYBs code!</span><br /><span class="line">             The following is guesswork:</span><br /><span class="line">       bit15: =1: With country specific keyboard mapping (&lt;Ctrl&gt;+</span><br /><span class="line">             &lt;Alt&gt;+&lt;F2&gt;) active, &lt;CapsLock&gt; works as CAPSLock</span><br /><span class="line">             instead of ShiftLock??? Pressing a key in first row</span><br /><span class="line">             resets CapsLock???</span><br /><span class="line">             (Effective only on PC Convertible or with Enhanced</span><br /><span class="line">             keyboard).</span><br /><span class="line">       bit14-10:  unused (0)</span><br /><span class="line">       bit 9: =1: With country specific keyboard mapping active:</span><br /><span class="line">             some kind of temporary (table) shift???</span><br /><span class="line">       bit 8-0: unused (0)</span><br /><span class="line"> 28h   BYTE    unused (0)</span><br /><span class="line"> 29h   BYTE    make code xx for &lt;Ctrl&gt;+&lt;Alt&gt;+&lt;xx&gt; to set keyboard mapping</span><br /><span class="line">         to US-layout (default is 3Bh=&lt;F1&gt;???)</span><br /><span class="line">         (see INT 2F/AX=AD82h,INT 2F/AX=AD83h)</span><br /><span class="line"> 2Ah   BYTE    make code yy for &lt;Ctrl&gt;+&lt;Alt&gt;+&lt;yy&gt; to set keyboard mapping</span><br /><span class="line">         to country specific layout (default is 3Ch=&lt;F2&gt;???),</span><br /><span class="line">         (see INT 2F/AX=AD82h,INT 2F/AX=AD83h)</span><br /><span class="line"> 2Bh 16 BYTEs  unused (0) ???</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Note:</span>  at least in MS-DOS v6.22, the signature &#34;SHARED DATA&#34; immediately</span><br /><span class="line">     precedes this structure</span><br /><span class="line"></span><br /><span class="line">Bitfields for MS-DOS v6.22 KEYB flags A:</span><br /><span class="line">Bit(s) Description (Table 3762)</span><br /><span class="line"> 15    unused??? (0)</span><br /><span class="line"> 14    set on machine with BIOS machine type FBh or FEh/FFh without enh kbd</span><br /><span class="line"> 13    not FAh: ???</span><br /><span class="line"> 12    set on start of machine detection, cleared on machine types F9h, FBh,</span><br /><span class="line">     FEh, FFh</span><br /><span class="line"> 11    not FAh: ???</span><br /><span class="line">   (on ATs: override bit12 NOT to set NumLock on)</span><br /><span class="line"> 10    set on machine type F9h</span><br /><span class="line"> 9 unused??? (0)</span><br /><span class="line"> 8 unused??? (0)</span><br /><span class="line"> 7 used by INT 09, but never set!</span><br /><span class="line">   =1: after keyboard self test resulting AAh, INT 09 handler will (re)set</span><br /><span class="line">         keyboard code-set 1 and temporarily disable a PS/2 mouseport.</span><br /><span class="line"> 6 used by INT09, but never set!</span><br /><span class="line">   =1: after keyboard self test resulting AAh, INT 09 handler will (re)set</span><br /><span class="line">         keyboard code-set 1 and temporarily disable a PS/2 mouseport.</span><br /><span class="line"> 5 set for JP, KO, PR, TA layouts during installation???</span><br /><span class="line">   =1: some special codepage (&gt;932???) management???</span><br /><span class="line"> 4-0   unused??? (0)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #2658,MEM F000h:FFFEh,INT 15/AH=C0h</span><br /><span class="line"></span><br /><span class="line">Bitfields for MS-DOS v6.22 KEYB flags B:</span><br /><span class="line">Bit(s) Description (Table 2658)</span><br /><span class="line"> 15    INT 16/AH=1xh supported (INT 16h/AH=92h call returns AH&lt;=80h)</span><br /><span class="line">   if clear, extended keyboard scan codes are immediately discarded</span><br /><span class="line"> 14    INT 16/AH=2xh supported (INT 16h/AH=A2h call returns AH&lt;=80h)</span><br /><span class="line"> 13    unused (0)</span><br /><span class="line"> 12    network installed (INT 2F/AX=B800h)</span><br /><span class="line"> 11    original IBM PC (BIOS date 1981)</span><br /><span class="line"> 10    PC or PC/XT (BIOS machine type byte of FBh or FEh)</span><br /><span class="line"> 9 PC Convertible (BIOS machine type byte of F9h); use INT 15/AX=4104h</span><br /><span class="line"> 8 unused (0)</span><br /><span class="line"> 7 IBM PS/2 model 30 (BIOS machine type byte of FAh)</span><br /><span class="line"> 6 IBM AT (BIOS machine type FCh)</span><br /><span class="line"> 5 IBM PS/2 (BIOS machine type F8h)</span><br /><span class="line"> 4 PS/2 and unknown only: non-standard 8042 reported by INT 15/AH=C0h</span><br /><span class="line">   =1: after keyboard self test resulting AAh, INT 09 handler will (re)set</span><br /><span class="line">         keyboard code-set 1 and temporarily disable a PS/2 mouseport.</span><br /><span class="line"> 3 temporary flag???</span><br /><span class="line"> 2-0   ???</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #2657,#3762</span><br /><span class="line"></span><br /><span class="line">Format of code page table list entries:</span><br /><span class="line">Offset Size    Description (Table 2659)</span><br /><span class="line"> 00h   WORD    pointer to next item, FFFFh = last</span><br /><span class="line"> 02h   WORD    code page (see #1446 at INT 21/AX=6602h)</span><br /><span class="line"> 04h  2 BYTEs  ???</span><br /><span class="line"></span><br /><span class="line">Format of KEYB translation data:</span><br /><span class="line">Offset Size    Description (Table 2660)</span><br /><span class="line"> 00h   WORD    size of data in bytes, including this word</span><br /><span class="line"> 02h N-2 BYTEs ???</span><br /></pre>
  
  
  


      </article>

    </section>

  </body>

</html>

