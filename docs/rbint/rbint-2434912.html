





<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="generator" content="ng2web v1.2.0 (ngdb v1.1.0)">
    <link rel="stylesheet" type="text/css" href="rbint-style.css">
    <title>Ralf Brown » Lists » Interrupts</title>
    <meta name="description" content="Ralf Brown">
    <link rel="prev" href="rbint-2434558.html">
    <link rel="next" href="rbint-2446259.html">
    
  </head>

  <body>

    <header>
      <nav class="box">
        <ul>
          

<li><a href="../index.html">Guides</a></li>


          

<li><a href="rbint-about.html">About</a></li>


          

<li><a href="rbint-2434558.html">Previous</a></li>


          

<li><a href="rbint-2204700.html">Up</a></li>


          

<li><a href="rbint-2446259.html">Next</a></li>


        </ul>
      </nav>
    </header>

    <section>

      
        <nav class="menu box">
          <ul>
              <li>Lists</li>
              <ul>
                <li><a href="index.html">Comments</a></li>
                <li><a href="rbint-7995.html">Interrupts</a></li>
                <li><a href="rbint-15401.html">Glossary</a></li>
                <li><a href="rbint-64347.html">Memory</a></li>
                <li><a href="rbint-180090.html">CMOS</a></li>
                <li><a href="rbint-250757.html">86 Bugs</a></li>
                
              </ul>
          </ul>
        </nav>
      

      <article class="box">
        
  
  
    <pre class="entry"><span class="line"></span><br /><span class="line"><span class="ngu">Int 21 Fn 4B  - Dos 2+ - &#34;exec&#34; - Load And/or Execute Program            </span>  [<span class="ngb">D</span>]</span><br /><span class="line"></span><br /><span class="line">   AH = 4Bh</span><br /><span class="line">   AL = type of load</span><br /><span class="line">       00h load and execute</span><br /><span class="line">       01h load but do not execute</span><br /><span class="line">       03h load overlay (see #1277)</span><br /><span class="line">       04h load and execute in background (European MS-DOS 4.0 only)</span><br /><span class="line">       &#34;Exec &amp; Go&#34; (see also AH=80h)</span><br /><span class="line">   DS:DX -&gt; ASCIZ program name (must include extension)</span><br /><span class="line">   ES:BX -&gt; parameter block (see #1276,#1277,#1278)</span><br /><span class="line">   CX = mode (subfunction 04h only)</span><br /><span class="line">       0000h child placed in zombie mode after termination</span><br /><span class="line">       0001h child&#39;s return code discarded on termination</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Return:</span> CF clear if successful</span><br /><span class="line">       BX,DX destroyed</span><br /><span class="line">       if subfunction 01h, process ID set to new program&#39;s PSP; get with</span><br /><span class="line">       INT 21/AH=62h</span><br /><span class="line">   CF set on error</span><br /><span class="line">       AX = error code (01h,02h,05h,08h,0Ah,0Bh) (see #1366 at AH=59h)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Notes:</span> DOS 2.x destroys all registers, including SS:SP</span><br /><span class="line">   under ROM-based DOS, if no disk path characters (colons or slashes)</span><br /><span class="line">     are included in the program name, the name is searched for in the</span><br /><span class="line">     ROM module headers (see #1281) before searching on disk</span><br /><span class="line">   for functions 00h and 01h, the calling process must ensure that there</span><br /><span class="line">     is enough unallocated memory available; if necessary, by releasing</span><br /><span class="line">     memory with AH=49h or AH=4Ah</span><br /><span class="line">   for function 01h, the AX value to be passed to the child program is put</span><br /><span class="line">     on top of the child&#39;s stack</span><br /><span class="line">   for function 03h, DOS assumes that the overlay is being loaded into</span><br /><span class="line">     memory allocated by the caller</span><br /><span class="line">   function 01h was undocumented prior to the release of DOS 5.0</span><br /><span class="line">   some versions (such as DR DOS 6.0) check the parameters and parameter</span><br /><span class="line">     block and return an error if an invalid value (such as an offset of</span><br /><span class="line">     FFFFh) is found</span><br /><span class="line">   background programs under European MS-DOS 4.0 must use the new</span><br /><span class="line">     executable format</span><br /><span class="line">   this function ignores the filename extension, instead checking the</span><br /><span class="line">     first two bytes of the file to determine whether there is a valid</span><br /><span class="line">     .EXE header (see #1280); if not, the file is assumed to be in .COM</span><br /><span class="line">     format.  If present, the file may be in any of several formats which</span><br /><span class="line">     are extensions of the original .EXE format (see #1279)</span><br /><span class="line">   .COM-format executables begin running with the following register</span><br /><span class="line">     values:</span><br /><span class="line">       AL = 00h if first FCB has valid drive letter, FFh if not</span><br /><span class="line">       AH = 00h if second FCB has valid drive letter, FFh if not</span><br /><span class="line">       CS,DS,ES,SS = PSP segment</span><br /><span class="line">       SP = offset of last word available in first 64K segment</span><br /><span class="line">       (note: AX is always 0000h under DESQview)</span><br /><span class="line">   old-format executables begin running with the following register</span><br /><span class="line">     values:</span><br /><span class="line">       AL = 00h if first FCB has valid drive letter, FFh if not</span><br /><span class="line">       AH = 00h if second FCB has valid drive letter, FFh if not</span><br /><span class="line">       DS,ES = PSP segment</span><br /><span class="line">       SS:SP as defined in .EXE header</span><br /><span class="line">       (note: AX is always 0000h under DESQview)</span><br /><span class="line">   new executables begin running with the following register values</span><br /><span class="line">       AX = environment segment</span><br /><span class="line">       BX = offset of command tail in environment segment</span><br /><span class="line">       CX = size of automatic data segment (0000h = 64K)</span><br /><span class="line">       ES,BP = 0000h</span><br /><span class="line">       DS = automatic data segment</span><br /><span class="line">       SS:SP = initial stack</span><br /><span class="line">     the command tail corresponds to an old executable&#39;s PSP:0081h and</span><br /><span class="line">     following, except that the 0Dh is turned into a NUL (00h); new</span><br /><span class="line">     format executables have no PSP</span><br /><span class="line">   under the FlashTek X-32 DOS extender, only function 00h is supported</span><br /><span class="line">     and the pointers are passed in DS:EDX and ES:EBX</span><br /><span class="line">   DR DOS 6 always loads .EXE-format programs with no fixups and</span><br /><span class="line">     .COM-format programs starting with 9Ch 55h (PUSHF/PUSH BP) above the</span><br /><span class="line">     64K mark to avoid the EXEPACK bug, by extending the memory block</span><br /><span class="line">     containing the program&#39;s environment; this code is disabled if the</span><br /><span class="line">     name of the parent program as stored in the MCB is &#39;WIN&#39;.</span><br /><span class="line">   DR DOS 3.41 and 5.0 check for a valid filename before testing the</span><br /><span class="line">     subfunction number, so the otherwise invalid subfunction 02h will</span><br /><span class="line">     only return error code 01h if the given filename actually exists;</span><br /><span class="line">     otherwise, errors 02h, 03h, or 05h are returned</span><br /><span class="line">BUGS:  DOS 2.00 assumes that DS points at the current program&#39;s PSP</span><br /><span class="line">   Load Overlay (subfunction 03h) loads up to 512 bytes too many if the</span><br /><span class="line">     file contains additional data after the actual overlay</span><br /><span class="line">   Load but Do Not Execute (subfunction 01h) is reported to corrupt the</span><br /><span class="line">     top word of the caller&#39;s stack if the loaded module terminates with</span><br /><span class="line">     INT 21/AH=4Ch in some versions of MS-DOS, including v5.00.</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> AX=4B05h,AH=4Ch,AH=4Dh,AH=64h/BX=0025h,AH=8Ah,INT 2E,INT 60/DI=0604h</span><br /><span class="line"></span><br /><span class="line">Format of EXEC parameter block for AL=00h,01h,04h:</span><br /><span class="line">Offset Size    Description (Table 1276)</span><br /><span class="line"> 00h   WORD    segment of environment to copy for child process (copy caller&#39;s</span><br /><span class="line">         environment if 0000h)</span><br /><span class="line"> 02h   DWORD   pointer to command tail to be copied into child&#39;s PSP</span><br /><span class="line"> 06h   DWORD   pointer to first FCB to be copied into child&#39;s PSP</span><br /><span class="line"> 0Ah   DWORD   pointer to second FCB to be copied into child&#39;s PSP</span><br /><span class="line"> 0Eh   DWORD   (AL=01h) will hold subprogram&#39;s initial SS:SP on return</span><br /><span class="line"> 12h   DWORD   (AL=01h) will hold entry point (CS:IP) on return</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #1277,#1278</span><br /><span class="line"></span><br /><span class="line">Format of EXEC parameter block for AL=03h:</span><br /><span class="line">Offset Size    Description (Table 1277)</span><br /><span class="line"> 00h   WORD    segment at which to load overlay</span><br /><span class="line"> 02h   WORD    relocation factor to apply to overlay if in .EXE format</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #1276,#1278</span><br /><span class="line"></span><br /><span class="line">Format of EXEC parameter block for FlashTek X-32:</span><br /><span class="line">Offset Size    Description (Table 1278)</span><br /><span class="line"> 00h   PWORD   48-bit far pointer to environment string</span><br /><span class="line"> 06h   PWORD   48-bit far pointer to command tail string</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #1276,#1277</span><br /><span class="line"></span><br /><span class="line">(Table 1279)</span><br /><span class="line">Values for the executable types understood by various environments:</span><br /><span class="line"> MZ    old-style DOS executable (see #1280)</span><br /><span class="line"> NE    Windows or OS/2 1.x segmented (&#34;new&#34;) executable (see #1282)</span><br /><span class="line"> LE    Windows virtual device driver (VxD) linear executable (see #1295)</span><br /><span class="line"> LX    variant of LE used in OS/2 2.x (see #1295)</span><br /><span class="line"> W3    Windows WIN386.EXE file; a collection of LE files</span><br /><span class="line"> W4    Windows95 VMM32.VXD file</span><br /><span class="line"> PE    Win32 (Windows NT and Win32s) portable executable based on Unix COFF</span><br /><span class="line"> DL    HP 100LX/200LX system manager compliant executable (.EXM)</span><br /><span class="line"> MP    old PharLap .EXP (see #1305)</span><br /><span class="line"> P2    PharLap 286 .EXP (see #1306)</span><br /><span class="line"> P3    PharLap 386 .EXP (see #1306)</span><br /><span class="line"></span><br /><span class="line">Format of .EXE file header:</span><br /><span class="line">Offset Size    Description (Table 1280)</span><br /><span class="line"> 00h  2 BYTEs  .EXE signature, either &#34;MZ&#34; or &#34;ZM&#34; (5A4Dh or 4D5Ah)</span><br /><span class="line">         (see also #1279)</span><br /><span class="line"> 02h   WORD    number of bytes in last 512-byte page of executable</span><br /><span class="line"> 04h   WORD    total number of 512-byte pages in executable (includes any</span><br /><span class="line">       partial last page)</span><br /><span class="line"> 06h   WORD    number of relocation entries</span><br /><span class="line"> 08h   WORD    header size in paragraphs</span><br /><span class="line"> 0Ah   WORD    minimum paragraphs of memory required to allocate in addition</span><br /><span class="line">         to executable&#39;s size</span><br /><span class="line"> 0Ch   WORD    maximum paragraphs to allocate in addition to executable&#39;s size</span><br /><span class="line"> 0Eh   WORD    initial SS relative to start of executable</span><br /><span class="line"> 10h   WORD    initial SP</span><br /><span class="line"> 12h   WORD    checksum (one&#39;s complement of sum of all words in executable)</span><br /><span class="line"> 14h   DWORD   initial CS:IP relative to start of executable</span><br /><span class="line"> 18h   WORD    offset within header of relocation table</span><br /><span class="line">       40h or greater for new-format (NE,LE,LX,W3,PE,etc.) executable</span><br /><span class="line"> 1Ah   WORD    overlay number (normally 0000h = main program)</span><br /><span class="line">---new executable---</span><br /><span class="line"> 1Ch  4 BYTEs  ???</span><br /><span class="line"> 20h   WORD    behavior bits</span><br /><span class="line"> 22h 26 BYTEs  reserved for additional behavior info</span><br /><span class="line"> 3Ch   DWORD   offset of new executable (NE,LE,etc) header within disk file,</span><br /><span class="line">       or 00000000h if plain MZ executable</span><br /><span class="line">---Borland TLINK---</span><br /><span class="line"> 1Ch  2 BYTEs  ??? (apparently always 01h 00h)</span><br /><span class="line"> 1Eh   BYTE    signature FBh</span><br /><span class="line"> 1Fh   BYTE    TLINK version (major in high nybble, minor in low nybble)</span><br /><span class="line"> 20h  2 BYTEs  ??? (v2.0 apparently always 72h 6Ah, v3.0+ seems always 6Ah 72h)</span><br /><span class="line">---ARJ self-extracting archive---</span><br /><span class="line"> 1Ch  4 BYTEs  signature &#34;RJSX&#34; (older versions, new signature is &#34;aRJsfX&#34; in</span><br /><span class="line">       the first 1000 bytes of the file)</span><br /><span class="line">---LZEXE 0.90 compressed executable---</span><br /><span class="line"> 1Ch  4 BYTEs  signature &#34;LZ09&#34;</span><br /><span class="line">---LZEXE 0.91 compressed executable---</span><br /><span class="line"> 1Ch  4 BYTEs  signature &#34;LZ91&#34;</span><br /><span class="line">---PKLITE compressed executable---</span><br /><span class="line"> 1Ch   BYTE    minor version number</span><br /><span class="line"> 1Dh   BYTE    bits 0-3: major version</span><br /><span class="line">       bit 4: extra compression</span><br /><span class="line">       bit 5: huge (multi-segment) file</span><br /><span class="line"> 1Eh  6 BYTEs  signature &#34;PKLITE&#34; (followed by copyright message)</span><br /><span class="line">---LHarc 1.x self-extracting archive---</span><br /><span class="line"> 1Ch  4 BYTEs  unused???</span><br /><span class="line"> 20h  3 BYTEs  jump to start of extraction code</span><br /><span class="line"> 23h  2 BYTEs  ???</span><br /><span class="line"> 25h 12 BYTEs  signature &#34;LHarc&#39;s SFX &#34;</span><br /><span class="line">---LHA 2.x self-extracting archive---</span><br /><span class="line"> 1Ch  8 BYTEs  ???</span><br /><span class="line"> 24h 10 BYTEs  signature &#34;LHa&#39;s SFX &#34; (v2.10) or &#34;LHA&#39;s SFX &#34; (v2.13)</span><br /><span class="line">---TopSpeed C 3.0 CRUNCH compressed file---</span><br /><span class="line"> 1Ch   DWORD   018A0001h</span><br /><span class="line"> 20h   WORD    1565h</span><br /><span class="line">---PKARCK 3.5 self-extracting archive---</span><br /><span class="line"> 1Ch   DWORD   00020001h</span><br /><span class="line"> 20h   WORD    0700h</span><br /><span class="line">---BSA (Soviet archiver) self-extracting archive---</span><br /><span class="line"> 1Ch   WORD    000Fh</span><br /><span class="line"> 1Eh   BYTE    A7h</span><br /><span class="line">---LARC self-extracting archive---</span><br /><span class="line"> 1Ch  4 BYTEs  ???</span><br /><span class="line"> 20h 11 BYTEs  &#34;SFX by LARC &#34;</span><br /><span class="line">---LH self-extracting archive---</span><br /><span class="line"> 1Ch  8 BYTEs  ???</span><br /><span class="line"> 24h  8 BYTEs  &#34;LH&#39;s SFX &#34;</span><br /><span class="line">---RAR self-extracting archive---</span><br /><span class="line"> 1Ch  4 BYTEs  signature &#34;RSFX&#34;</span><br /><span class="line">---other linkers---</span><br /><span class="line"> 1Ch   var optional information</span><br /><span class="line">---</span><br /><span class="line">  N   N DWORDs relocation items</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Notes:</span> if word at offset 02h is 4, it should be treated as 00h, since pre-1.10</span><br /><span class="line">     versions of the MS linker set it that way</span><br /><span class="line">   if both minimum and maximum allocation (offset 0Ah/0Ch) are zero, the</span><br /><span class="line">     program is loaded as high in memory as possible (DOS only checks</span><br /><span class="line">     the maximum allocation, however)</span><br /><span class="line">   the maximum allocation is set to FFFFh by default</span><br /><span class="line">   additional data may be contained in the file beyond the end of the</span><br /><span class="line">     load image described by the .EXE header; this data may be overlays,</span><br /><span class="line">     the actual executable for newer-format executables, or debugging</span><br /><span class="line">     information (see #1286,#1310)</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">See Also:</span> #1282</span><br /><span class="line"></span><br /><span class="line">Format of ROM Module Header:</span><br /><span class="line">Offset Size    Description (Table 1281)</span><br /><span class="line"> 00h  2 BYTEs  ROM signature 55h, AAh</span><br /><span class="line"> 02h   BYTE    size of ROM in 512-byte blocks</span><br /><span class="line"> 03h  3 BYTEs  POST initialization entry point (near JMP instruction)</span><br /><span class="line"> 06h   ROM Program Name List [array]</span><br /><span class="line">   Offset  Size    Description</span><br /><span class="line">    00h    BYTE    length of ROM program&#39;s name (00h if end of name list)</span><br /><span class="line">    01h  N BYTEs   program name</span><br /><span class="line">    N+1  3 BYTEs   program entry point (near JMP instruction)</span><br /><span class="line"></span><br /><span class="line">Format of new executable header:</span><br /><span class="line">Offset Size    Description (Table 1282)</span><br /><span class="line"> 00h  2 BYTEs  &#34;NE&#34; (4Eh 45h) signature</span><br /><span class="line"> 02h  2 BYTEs  linker version (major, then minor)</span><br /><span class="line"> 04h   WORD    offset from start of this header to entry table (see #1289)</span><br /><span class="line"> 06h   WORD    length of entry table in bytes</span><br /><span class="line"> 08h   DWORD   file load CRC (0 in Borland&#39;s TPW)</span><br /><span class="line"> 0Ch   BYTE    program flags (see #1283)</span><br /><span class="line"> 0Dh   BYTE    application flags (see #1284)</span><br /><span class="line"> 0Eh   WORD    auto data segment index</span><br /><span class="line"> 10h   WORD    initial local heap size</span><br /><span class="line"> 12h   WORD    initial stack size (added to data seg, 0000h if SS &lt;&gt; DS)</span><br /><span class="line"> 14h   DWORD   program entry point (CS:IP), &#34;CS&#34; is index into segment table</span><br /><span class="line"> 18h   DWORD   initial stack pointer (SS:SP), &#34;SS&#34; is segment index</span><br /><span class="line">       if SS=automatic data segment and SP=0000h, the stack pointer is</span><br /><span class="line">         set to the top of the automatic data segment, just below the</span><br /><span class="line">         local heap</span><br /><span class="line"> 1Ch   WORD    segment count</span><br /><span class="line"> 1Eh   WORD    module reference count</span><br /><span class="line"> 20h   WORD    length of nonresident names table in bytes</span><br /><span class="line"> 22h   WORD    offset from start of this header to segment table (see #1287)</span><br /><span class="line"> 24h   WORD    offset from start of this header to resource table</span><br /><span class="line"> 26h   WORD    offset from start of this header to resident names table</span><br /><span class="line"> 28h   WORD    offset from start of this header to module reference table</span><br /><span class="line"> 2Ah   WORD    offset from start of this header to imported names table</span><br /><span class="line">       (array of counted strings, terminated with a string of length</span><br /><span class="line">         00h)</span><br /><span class="line"> 2Ch   DWORD   offset from start of file to nonresident names table</span><br /><span class="line"> 30h   WORD    count of moveable entry point listed in entry table</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">.NG limit reached, continued in next section...</span></span><br /></pre>
  
  
  


      </article>

    </section>

    
      <footer>
        <nav class="box">
          <dl>
            <dt>Generated</dt><dd>2025-12-02 09:10:33</dd>
            <dt>Generator</dt><dd><a href="https://ng2web.davep.dev">ng2web v1.2.0 (ngdb v1.1.0)</a></dd>
          </dl>
        </nav>
      </footer>
    

  </body>

</html>

