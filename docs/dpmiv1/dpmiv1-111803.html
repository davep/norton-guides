





<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="generator" content="ng2web v1.1.0 (ngdb v1.1.0)">
    <link rel="stylesheet" type="text/css" href="dpmiv1-style.css">
    <title>DPMI v1 Norton Guide » DPMI » Functions</title>
    <meta name="description" content="DPMI v1 Norton Guide">
    <link rel="prev" href="dpmiv1-110316.html">
    <link rel="next" href="dpmiv1-115712.html">
    
  </head>

  <body>

    <header>
      <nav class="box">
        <ul>
          

<li><a href="../index.html">Guides</a></li>


          

<li><a href="dpmiv1-about.html">About</a></li>


          

<li><a href="dpmiv1-110316.html">Previous</a></li>


          

<li><a href="index.html">Up</a></li>


          

<li><a href="dpmiv1-115712.html">Next</a></li>


        </ul>
      </nav>
    </header>

    <section>

      <nav class="menu box">
        <ul>
            <li>DPMI</li>
            <ul>
              <li><a href="index.html">Functions</a></li>
              <li><a href="dpmiv1-126452.html">Errors</a></li>
              
            </ul>
        </ul>
      </nav>

      <article class="box">
        
  
  
    <pre class="entry"><span class="line"></span><br /><span class="line">Allocate Shared Memory</span><br /><span class="line"></span><br /><span class="line">Allocates a memory block that may be shared by DPMI clients.</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Call With:</span></span><br /><span class="line"></span><br /><span class="line">   AX     = 0D00H</span><br /><span class="line">   ES:(E)DI= selector:offset of shared memory allocation</span><br /><span class="line">           request structure in the following format:</span><br /><span class="line"></span><br /><span class="line">           Offset   Length  Contents</span><br /><span class="line">           00H      4       Requested length of shared</span><br /><span class="line">                            memory block (set by client, may</span><br /><span class="line">                            be zero)</span><br /><span class="line">           04H      4       Length actually allocated (set</span><br /><span class="line">           by host)</span><br /><span class="line">           08H      4       Shared memory handle (set by</span><br /><span class="line">           host)</span><br /><span class="line">           0CH      4       Linear address of shared memory</span><br /><span class="line">                            block (set by host)</span><br /><span class="line">           10H      6       offset32:selector of ASCIIZ</span><br /><span class="line">                            (null-terminated ASCII) name for</span><br /><span class="line">                            shared memory block (set by</span><br /><span class="line">                            client)</span><br /><span class="line">           16H      2       Reserved</span><br /><span class="line">           18H      4       Reserved, must be zero</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Returns:</span></span><br /><span class="line"></span><br /><span class="line">   if function successful</span><br /><span class="line">   Carry flag= clear</span><br /><span class="line"></span><br /><span class="line">   and the request structure fields at offsets 04H, 08H, and</span><br /><span class="line">           0CH updated  by host</span><br /><span class="line">   if function unsuccessful</span><br /><span class="line">   Carry flag= set</span><br /><span class="line">   AX     = error code</span><br /><span class="line">           8012H   linear memory unavailable</span><br /><span class="line">           8013H   physical memory unavailable</span><br /><span class="line">           8014H   backing store unavailable</span><br /><span class="line">           8016H   handle unavailable</span><br /><span class="line">           8021H   invalid value (name for the memory block</span><br /><span class="line">                   is too long)</span><br /><span class="line"></span><br /><span class="line">   and the request structure fields at offsets 04H, 08H and</span><br /><span class="line">                   0CH unmodified by host</span><br /><span class="line"></span><br /><span class="line"><span class="ngb">Notes:</span></span><br /><span class="line"></span><br /><span class="line">o  For 16-bit programs, the high word of the offset32 for</span><br /><span class="line">   the ASCIIZ name must be zero.</span><br /><span class="line">o  The maximum length of the shared memory block name is 128</span><br /><span class="line">   characters, including the terminal null character.</span><br /><span class="line">o  The linear address provided by the host is guaranteed to</span><br /><span class="line">   be the same for all clients in all virtual machines using</span><br /><span class="line">   a shared memory block.  The client must establish</span><br /><span class="line">   addressability for the block by allocating and</span><br /><span class="line">   initializing a descriptor with separate function calls.</span><br /><span class="line">o  No assumptions should be made about handle values.</span><br /><span class="line">   Successive allocations of the same shared memory block by</span><br /><span class="line">    the same client may return distinct handles; the client</span><br /><span class="line">   is responsible for tracking and individually deallocating</span><br /><span class="line">   each handle.</span><br /><span class="line">o  The first client that allocates a shared memory block</span><br /><span class="line">   determines its size; the length requested and the length</span><br /><span class="line">   actually allocated will always be equal, if the</span><br /><span class="line">   allocation succeeds at all.  Subsequent allocations by</span><br /><span class="line">   the same or different clients that specify the same or a</span><br /><span class="line">   different size will succeed, but the size of the block</span><br /><span class="line">   will remain unchanged.  The actual size of the block is</span><br /><span class="line">   always returned to the client at offset 4 in the shared</span><br /><span class="line">   memory allocation request structure.</span><br /><span class="line">o  Allocation of zero-length shared memory blocks is</span><br /><span class="line">   explicitly allowed.  The handle of a zero-length block</span><br /><span class="line">   can be used with the serialization functions (Int 31H</span><br /><span class="line">   Functions 0D02H and 0D03H) as a semaphore for</span><br /><span class="line">   inter-client communication.  The linear address that is</span><br /><span class="line">   returned at offset 0CH in the data structure for</span><br /><span class="line">   zero-length blocks is undefined, and any reference to it</span><br /><span class="line">   may produce a page fault.</span><br /><span class="line">o  The first paragraph (16 bytes) of the shared memory block</span><br /><span class="line">   (or the entire shared block, if smaller than 16 bytes)</span><br /><span class="line">   will always be initialized to zero on the first</span><br /><span class="line">   allocation and can be used by clients as an &#34;area</span><br /><span class="line">   initialized&#34; indicator.  For example, a shared memory</span><br /><span class="line">   block might be used by a suite of cooperating client</span><br /><span class="line">   programs to hold a table of static data or a subroutine</span><br /><span class="line">   library.  The first client to allocate the shared memory</span><br /><span class="line">   block can obtain exclusive ownership of the block with</span><br /><span class="line">   Int 31H Fn 0D02H, load the necessary data or code</span><br /><span class="line">   into the block from disk, set the first 16 bytes of the</span><br /><span class="line">   block to a nonzero value, and finally release its</span><br /><span class="line">   ownership</span><br /><span class="line">of the block with Int 31H Fn 0D03H.  Other clients that allocate</span><br /><span class="line">   the shared memory block can check the &#34;area initialized&#34;</span><br /><span class="line">   indicator and know that the desired code or data is</span><br /><span class="line">   already present in memory.</span><br /><span class="line">o  Shared memory block allocations and serializations are</span><br /><span class="line">   tracked by the host on a per client basis. All shared</span><br /><span class="line">   memory allocations for a client are freed by the host</span><br /><span class="line">   when the client terminates.</span><br /></pre>
  
  
  


      </article>

    </section>

  </body>

</html>

