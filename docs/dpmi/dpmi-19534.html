





<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="generator" content="ng2web v1.1.0 (ngdb v1.1.0)">
    <link rel="stylesheet" type="text/css" href="dpmi-style.css">
    <title>Dos Protected Mode Interface » DPMI » OverView</title>
    <meta name="description" content="Dos Protected Mode Interface">
    <link rel="prev" href="dpmi-19202.html">
    <link rel="next" href="dpmi-22431.html">
    
  </head>

  <body>

    <header>
      <nav class="box">
        <ul>
          

<li><a href="dpmi-about.html">About</a></li>


          

<li><a href="dpmi-19202.html">Previous</a></li>


          

<li><a href="index.html">Up</a></li>


          

<li><a href="dpmi-22431.html">Next</a></li>


        </ul>
      </nav>
    </header>

    <section>

      <nav class="menu box">
        <ul>
            <li>DPMI</li>
            <ul>
              <li><a href="index.html">OverView</a></li>
              <li><a href="dpmi-38393.html">DPMI API</a></li>
              
            </ul>
        </ul>
      </nav>

      <article class="box">
        
  
  
    <pre class="entry"><span class="line">        <span class="ngb">Stacks and Stack Switching</span></span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">            Every  DPMI   task  runs  on  four  different  stacks:    An</span><br /><span class="line">            application ring  protected mode  stack, a  locked protected</span><br /><span class="line">            mode stack, a real mode stack, and a DPMI host ring 0 stack.</span><br /><span class="line"></span><br /><span class="line">            The protected  mode stack  is the  one the  DPMI client  was</span><br /><span class="line">            running on  when it  switched into protected mode by calling</span><br /><span class="line">            the protected  mode entry  point (although  the  client  can</span><br /><span class="line">            switch to  another protected  mode stack  if desired).   The</span><br /><span class="line">            locked protected  mode stack  is provided by the DPMI server</span><br /><span class="line">            and  is   used  for   simulating  hardware   interrupts  and</span><br /><span class="line">            processing real mode call-backs.  The DPMI host provides the</span><br /><span class="line">            real mode  stack, which  is usually located in the data area</span><br /><span class="line">            provided by the client.  The ring 0 stack is only accessible</span><br /><span class="line">            by the  DPMI host.   However,  this stack  may contain state</span><br /><span class="line">            information about the currently running program.</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">        <span class="ngu">Protected Mode Stack</span></span><br /><span class="line"></span><br /><span class="line">            This is  the stack that the client uses for normal execution</span><br /><span class="line">            in protected  mode.   The protected  mode stack  of  a  DPMI</span><br /><span class="line">            client can  be unlocked  if desired.    Software  interrupts</span><br /><span class="line">            executed in protected mode will be reflected on this stack.</span><br /><span class="line"></span><br /><span class="line">        <span class="ngu">Locked Protected Mode Stack</span></span><br /><span class="line"></span><br /><span class="line">            During hardware  interrupts, Int  1Ch,  Int  23h,  Int  24h,</span><br /><span class="line">            exceptions, and  real mode  call-back handling  in protected</span><br /><span class="line">            mode, the  DPMI will  host automatically  switch to a locked</span><br /><span class="line">            protected mode  stack.   When the interrupt or call returns,</span><br /><span class="line">            the host  will return  to the original protected mode stack.</span><br /><span class="line">            Note that  there is  only one,  4K, locked stack provided by</span><br /><span class="line">            the host.  The stack will be switched onto the first time an</span><br /><span class="line">            interrupt or  call is  reflected to protected mode, and will</span><br /><span class="line">            be switched  away from  when the client returns.  Subsequent</span><br /><span class="line">            nested interrupts  or calls  will not  cause a stack switch.</span><br /><span class="line">            Software interrupts do not automatically switch stacks.</span><br /><span class="line"></span><br /><span class="line">        <span class="ngu">Real Mode Stack</span></span><br /><span class="line"></span><br /><span class="line">            The DPMI host will provide the client with a real mode stack</span><br /><span class="line">            that is  at least  200h bytes  in size  and will  always  be</span><br /><span class="line">            locked.   Interrupts that  are reflected  into real mode, as</span><br /><span class="line">            well as  calls made  using the translation services, will be</span><br /><span class="line">            reflected on  this stack.  DPMI hosts will not automatically</span><br /><span class="line">            switch stacks for hardware interrupt processing in real mode</span><br /><span class="line">            since DOS performs this function automatically.</span><br /><span class="line"></span><br /><span class="line">        <span class="ngu">DPMI Host Ring 0 Stack</span></span><br /><span class="line"></span><br /><span class="line">            DPMI hosts  will normally  have a stack associated with each</span><br /><span class="line">            DPMI task.   The DPMI client will not be able to access this</span><br /><span class="line">            stack in  any way -- it is used by the host for execution at</span><br /><span class="line">            ring 0 to handle interrupts and exceptions.  This stack will</span><br /><span class="line">            sometimes be used to store state information while switching</span><br /><span class="line">            modes.   For example,  the original  SS:ESP of the protected</span><br /><span class="line">            mode program  could be  saved on  the ring 0 stack while the</span><br /><span class="line">            DPMI host switches onto the locked protected mode stack.</span><br /></pre>
  
  
  


      </article>

    </section>

  </body>

</html>

