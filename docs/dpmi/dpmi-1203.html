





<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="generator" content="ng2web v1.1.0 (ngdb v1.1.0)">
    <link rel="stylesheet" type="text/css" href="dpmi-style.css">
    <title>Dos Protected Mode Interface » DPMI » OverView</title>
    <meta name="description" content="Dos Protected Mode Interface">
    
    <link rel="next" href="dpmi-7221.html">
    
  </head>

  <body>

    <header>
      <nav class="box">
        <ul>
          

<li><a href="../index.html">Guides</a></li>


          

<li><a href="dpmi-about.html">About</a></li>


          

<li><span>Previous</span></li>


          

<li><a href="index.html">Up</a></li>


          

<li><a href="dpmi-7221.html">Next</a></li>


        </ul>
      </nav>
    </header>

    <section>

      <nav class="menu box">
        <ul>
            <li>DPMI</li>
            <ul>
              <li><a href="index.html">OverView</a></li>
              <li><a href="dpmi-38393.html">DPMI API</a></li>
              
            </ul>
        </ul>
      </nav>

      <article class="box">
        
  
  
    <pre class="entry"><span class="line">        <span class="ngb">INTRODUCTION</span></span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">            The DOS Protected Mode Interface (DPMI) was defined to allow</span><br /><span class="line">            DOS  programs   to  access   the  extended   memory  of   PC</span><br /><span class="line">            architecture computers  while maintaining system protection.</span><br /><span class="line">            DPMI defines  a specific  subset of  DOS and BIOS calls that</span><br /><span class="line">            can be made by protected mode DOS programs.  It also defines</span><br /><span class="line">            a new  interface via  software interrupt  31h that protected</span><br /><span class="line">            mode programs  use to  allocate memory,  modify descriptors,</span><br /><span class="line">            call real  mode software,  etc.   Any operating  system that</span><br /><span class="line">            currently supports virtual DOS sessions should be capable of</span><br /><span class="line">            supporting DPMI without affecting system security.</span><br /><span class="line"></span><br /><span class="line">            Some DPMI  implementations can  execute  multiple  protected</span><br /><span class="line">            mode programs  in independent  virtual machines.  Thus, DPMI</span><br /><span class="line">            applications can  behave exactly like any other standard DOS</span><br /><span class="line">            program and  can, for example, run in the background or in a</span><br /><span class="line">            window  (if   the  environment   supports  these  features).</span><br /><span class="line">            Programs that  run in  protected  mode  also  gain  all  the</span><br /><span class="line">            benefits of  virtual memory and can run in 32-bit flat model</span><br /><span class="line">            if desired.</span><br /><span class="line"></span><br /><span class="line">            Throughout this  document, the  term &#34;real mode&#34; software is</span><br /><span class="line">            used to  refer to  code that  runs in  the  low  1  megabyte</span><br /><span class="line">            address space  and uses  segment:offset addressing.    Under</span><br /><span class="line">            many implementations  of DPMI,  so called real mode software</span><br /><span class="line">            is actually  executed in  virtual 8086 mode.  However, since</span><br /><span class="line">            virtual 8086  mode is  a very  close approximation  of  real</span><br /><span class="line">            mode, we will refer to it as real mode in this document.</span><br /><span class="line"></span><br /><span class="line">            DPMI services are only available to protected mode programs.</span><br /><span class="line">            Programs running  in real  mode can  not use these services.</span><br /><span class="line">            Protected mode  programs <span class="ngu">must</span>  use  the service described to</span><br /><span class="line">            enter  protected mode  before  calling  Int  31h services.</span><br /><span class="line"></span><br /><span class="line">            All Int 31h functions will modify flags and the AX register.</span><br /><span class="line">            All other  registers  will  be  preserved  unless  they  are</span><br /><span class="line">            specified as  return values.   Unsupported calls will return</span><br /><span class="line">            with the  carry flag set.  Since Int 31h is set up as a trap</span><br /><span class="line">            gate, the interrupt flag will not be modified by any Int 31h</span><br /><span class="line">            calls  except  for  memory  management  and  interrupt  flag</span><br /><span class="line">            management calls.   All  memory management  calls may enable</span><br /><span class="line">            interrupts.  Interrupt flag management calls will modify the</span><br /><span class="line">            interrupt flag  as specified  by the  call.    All  Int  31h</span><br /><span class="line">            services are reentrant.</span><br /><span class="line"></span><br /><span class="line">            Some implementations  of DPMI  can run 32-bit 80386 specific</span><br /><span class="line">            programs.   DPMI functions  that take pointers as parameters</span><br /><span class="line">            will use  the extended  32-bit registers  for  offsets  (for</span><br /><span class="line">            example, ES:EDI  instead of  ES:DI) when running 32-bit mode</span><br /><span class="line">            programs.   The high  word of  the 32-bit  registers will be</span><br /><span class="line">            ignored when running 16-bit protected mode programs.</span><br /><span class="line"></span><br /><span class="line">            DPMI services  are provided  by what  will be referred to as</span><br /><span class="line">            the DPMI  host  program.    The  program(s)  that  use  DPMI</span><br /><span class="line">            services are  called DPMI  clients.  Generally, DPMI clients</span><br /><span class="line">            are two categories:</span><br /><span class="line"></span><br /><span class="line">                 o    Extended Applications</span><br /><span class="line">                 o    Applications that use DPMI directly</span><br /><span class="line"></span><br /><span class="line">            It is  believed that most DPMI applications will be extended</span><br /><span class="line">            applications.   Extended  applications  are  bound  with  an</span><br /><span class="line">            extender that  is the actual DPMI client and the application</span><br /><span class="line">            calls extender  services that  then are  translated  by  the</span><br /><span class="line">            client into  DPMI calls.    The  advantage  of  an  extended</span><br /><span class="line">            application over  one that  calls DPMI  services directly is</span><br /><span class="line">            that generally an extender will support more than just DPMI.</span><br /><span class="line">            In fact  it is recommended that extenders look for extension</span><br /><span class="line">            services in the following order:</span><br /><span class="line"></span><br /><span class="line">                 o    DPMI</span><br /><span class="line">                 o    VCPI/EMS</span><br /><span class="line">                 o    XMS</span><br /><span class="line">                 o    Top-down (Int 15h)</span><br /><span class="line"></span><br /><span class="line">            An extender  can provide  a single set of APIs to the actual</span><br /><span class="line">            application and then translate them to the services that are</span><br /><span class="line">            provided.   Where the  host extension services are &#34;lacking&#34;</span><br /><span class="line">            in a  particular function  the extender  must  provide  that</span><br /><span class="line">            function for the application.</span><br /><span class="line"></span><br /><span class="line">            Figure 1 shows a picture of how this works. The</span><br /><span class="line">            application code  sits on  top of  a set  of  base  extender</span><br /><span class="line">            functions and  APIs.  The extender then has separate modules</span><br /><span class="line">            for each  type of extension service and code to &#34;fill in the</span><br /><span class="line">            slack&#34; where  services are lacking.  An example of a typical</span><br /><span class="line">            extender service  is protected  mode program  loading.   The</span><br /><span class="line">            actual shipped  application is the application code bound in</span><br /><span class="line">            with the extender and all of its styles of client support.</span><br /><span class="line"></span><br /><span class="line">            The host  support is  generally an  extension of the base OS</span><br /><span class="line">            functions or  a device  driver used  to extend  the base  OS</span><br /><span class="line">            functions.</span><br /><span class="line"></span><br /><span class="line">            This document  is intended  to provide  a definition  of the</span><br /><span class="line">            DPMI  services  that  a  DPMI  host  would  be  required  to</span><br /><span class="line">            implement and that a DPMI client would use.</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">            Figure 1.  Application/Extender/Client/Host/OS structure</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">            +----------------------------------------------------------+</span><br /><span class="line">            |                                                          |</span><br /><span class="line">            |  +----------------------------------------------------+  |</span><br /><span class="line">            |  |                                                    |  |</span><br /><span class="line">            |  |                  Application Code                  |  |</span><br /><span class="line">            |  |                                                    |  |</span><br /><span class="line">            |  +----------------------------------------------------+  |</span><br /><span class="line">            |                                                          |</span><br /><span class="line">            |  +----------------------------------------------------+  |</span><br /><span class="line">            |  |           Extender Base (including APIs)           |  |</span><br /><span class="line">            |  | -------------------------------------------------- |  |</span><br /><span class="line">            |  |    DPMI                                            |  |</span><br /><span class="line">            |  |   client                                           |  |</span><br /><span class="line">            |  +------------+                                       |  |</span><br /><span class="line">            |               |    VCPI                               |  |</span><br /><span class="line">            |               |   client                              |  |</span><br /><span class="line">            |               +------------+                          |  |</span><br /><span class="line">            |                            |    XMS                   |  |</span><br /><span class="line">            |                            |   client                 |  |</span><br /><span class="line">            |                            +------------+             |  |</span><br /><span class="line">            |                                         |  Top-down   |  |</span><br /><span class="line">            |                                         |   client    |  |</span><br /><span class="line">            |                                         +-------------+  |</span><br /><span class="line">            |                                                          |</span><br /><span class="line">            +----------------------------------------------------------+</span><br /><span class="line"></span><br /><span class="line">               +------------+</span><br /><span class="line">               |            |</span><br /><span class="line">               |            |</span><br /><span class="line">               |            |------------+</span><br /><span class="line">               |            |            |</span><br /><span class="line">               |    DPMI    |            |</span><br /><span class="line">               |    host    |    VCPI    |------------+</span><br /><span class="line">               |            |            |            |</span><br /><span class="line">               |            |            |            |</span><br /><span class="line">               |            |------------|    XMS     |-------------+</span><br /><span class="line">               |            |    EMS     |            |  Top-down   |</span><br /><span class="line">               |            |            |            |  (Int 15h)  |</span><br /><span class="line">               +----------------------------------------------------+</span><br /><span class="line"></span><br /><span class="line">               +----------------------------------------------------+</span><br /><span class="line">               |                                                    |</span><br /><span class="line">               |             Operating System (e.g. DOS)            |</span><br /><span class="line">               |                                                    |</span><br /><span class="line">               +----------------------------------------------------+</span><br /></pre>
  
  
  


      </article>

    </section>

  </body>

</html>

