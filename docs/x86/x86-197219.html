





<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="generator" content="ng2web v1.1.0 (ngdb v1.1.0)">
    <link rel="stylesheet" type="text/css" href="x86-style.css">
    <title>iAPx86 » CPU » Protection, privilege</title>
    <meta name="description" content="iAPx86">
    <link rel="prev" href="x86-195957.html">
    <link rel="next" href="x86-204295.html">
    
  </head>

  <body>

    <header>
      <nav class="box">
        <ul>
          

<li><a href="../index.html">Guides</a></li>


          

<li><a href="x86-about.html">About</a></li>


          

<li><a href="x86-195957.html">Previous</a></li>


          

<li><a href="x86-190707.html">Up</a></li>


          

<li><a href="x86-204295.html">Next</a></li>


        </ul>
      </nav>
    </header>

    <section>

      <nav class="menu box">
        <ul>
            <li>CPU</li>
            <ul>
              <li><a href="index.html">Instruction set</a></li>
              <li><a href="x86-175915.html">Registers</a></li>
              <li><a href="x86-190707.html">Protection, privilege</a></li>
              <li><a href="x86-224627.html">Exceptions</a></li>
              <li><a href="x86-225699.html">Addressing modes</a></li>
              <li><a href="x86-229455.html">Opcodes</a></li>
              
            </ul>
            <li>FPU</li>
            <ul>
              <li><a href="x86-245307.html">Instruction set</a></li>
              <li><a href="x86-307843.html">Registers, data types</a></li>
              
            </ul>
            <li>MMX</li>
            <ul>
              <li><a href="x86-318646.html">Instruction set</a></li>
              
            </ul>
        </ul>
      </nav>

      <article class="box">
        
  
  
    <pre class="entry"><span class="line"></span><br /><span class="line"><span class="ngb">Segment descriptors</span></span><br /><span class="line"></span><br /><span class="line">    Descriptors are those objects to which the segment selectors</span><br /><span class="line">    point. They are 8-byte quantities that contain attributes about a</span><br /><span class="line">    given linear address space (that is, about a segment). These</span><br /><span class="line">    attributes include the segment 32-bit base linear address, the</span><br /><span class="line">    segment&#39;s 20-bit length and granularity, the protection level,</span><br /><span class="line">    read, write or execute privileges, the default size of the</span><br /><span class="line">    operands (16- or 32-bit), and the type of segment.</span><br /><span class="line"></span><br /><span class="line">    All descriptor attribute information is contained in 12 bits of</span><br /><span class="line">    the segment descriptor. Segments on the 80386+ have three attribute</span><br /><span class="line">    fields in common: the P (Present) bit, the DPL (Descriptor</span><br /><span class="line">    Privilege Level) bits, and the S (Segment Descriptor) bit.</span><br /><span class="line"></span><br /><span class="line">    Segment descriptors are stored in either a Global Descriptor Table</span><br /><span class="line">    (GDT) or Local Descriptor Table (LDT). The 80386+ locates the GDT</span><br /><span class="line">    and the current LDT in memory by means of the GDTR and LDTR</span><br /><span class="line">    registers.</span><br /><span class="line"></span><br /><span class="line">    A segment descriptor provides the 80386+ with the data it needs to</span><br /><span class="line">    map a logical address into a linear address. These descriptors are</span><br /><span class="line">    <span class="ngu">not</span> created by programs, but by compilers, linkers, loaders, or</span><br /><span class="line">    the operating system.</span><br /><span class="line"></span><br /><span class="line">    ──────────────────────────────────────────────────────────────────</span><br /><span class="line"></span><br /><span class="line">    General segment descriptor format:</span><br /><span class="line">    </span><br /><span class="line">     6               5       5       4       4     4 3             3</span><br /><span class="line">     3               5       1       7       3     0 9             2</span><br /><span class="line">    ┌───────────────┬─┬─┬─┬─┬───────┬─┬───┬─┬───────┬───────────────┐</span><br /><span class="line">    │ Base 31..24   │G│D│0│A│Seg lim│P│DPL│S│ Type  │ Base 23..16   │</span><br /><span class="line">    │               │ │ │ │V│ 19..16│ │   │ │      A│               │</span><br /><span class="line">    ├───────────────┴─┴─┴─┴─┴───────┼─┴───┴─┴─────┴─┴───────────────┤</span><br /><span class="line">    │ Base Address 15..0            │ Segment Limit 15..0           │</span><br /><span class="line">    └───────────────────────────────┴───────────────────────────────┛</span><br /><span class="line">     3               2               1</span><br /><span class="line">     1               3               5               7             0</span><br /><span class="line"></span><br /><span class="line">    Note: In descriptors used for application code and data segments,</span><br /><span class="line">            bit 40 = Accessed field</span><br /><span class="line">          Bits 40-47 = Access Right Byte</span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">BASE</span>        Defines the location of the segment within the</span><br /><span class="line">                4 gigabyte linear address space. The 3 fragments of</span><br /><span class="line">                the base address are concatenated to form a single</span><br /><span class="line">                32-bit value.</span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">LIMIT</span>       Defines the size of the segment. The 2 parts of</span><br /><span class="line">                the field are linked to form a 20-bit result.</span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">G</span>ranularity When 0, LIMIT is interpreted as units of 1 byte.</span><br /><span class="line">                When 1, LIMIT is interpreted as units of 4 KB.</span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">D</span>efault operation size</span><br /><span class="line">                When D=0, operands and effective addresses default to</span><br /><span class="line">                16 bits in length; when D=1, 32 bits.</span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">AV</span>ailable for programmer use</span><br /><span class="line"></span><br /><span class="line">    segment <span class="ngb">P</span>resent</span><br /><span class="line">                If this bit holds a 0 value, the descriptor is not</span><br /><span class="line">                valid for use in address translation. The 80386+</span><br /><span class="line">                signals an exception when a selector for the</span><br /><span class="line">                descriptor is loaded into a segment register.</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">DPL</span> - Descriptor Privilege Level defines the privilege level</span><br /><span class="line">                of the segment. It controls access to the segment</span><br /><span class="line">                using the protection mechanism.</span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">S</span>egment     0 = system segment, 1 = code or data segment.</span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">Type</span></span><br /><span class="line">                System segments:</span><br /><span class="line">                    1 = available 286 TSS</span><br /><span class="line">                    2 = load descriptor table</span><br /><span class="line">                    3 = busy 286 TSS</span><br /><span class="line">                    4 = 286 call gate</span><br /><span class="line">                    5 = 286/386 task gate</span><br /><span class="line">                    6 = 286 interrupt gate</span><br /><span class="line">                    7 = 286 trap gate</span><br /><span class="line">                    9 = available 80386/486 TSS</span><br /><span class="line">                    B = busy      80386/486 TSS</span><br /><span class="line">                    C = 80386/486 call gate</span><br /><span class="line">                    E = 80386/486 interrupt gate</span><br /><span class="line">                    F = 80386 trap gate, 80486 task gate</span><br /><span class="line">                    0,8,A,D = reserved</span><br /><span class="line"></span><br /><span class="line">                Application code and data segments:</span><br /><span class="line">                    Specifies the kind of access that can be made to</span><br /><span class="line">                    the segment.</span><br /><span class="line"></span><br /><span class="line">                               Descriptor</span><br /><span class="line">                   <span class="ngb"> T E W A </span>      type    Description</span><br /><span class="line">                    0 0 0 0   0   Data    Read-only</span><br /><span class="line">                    0 0 0 1   1   Data    -, accessed</span><br /><span class="line">                    0 0 1 0   2   Data    Read/Write</span><br /><span class="line">                    0 0 1 1   3   Data    -, accessed</span><br /><span class="line">                    0 1 0 0   4   Data    Read-only, expand-down</span><br /><span class="line">                    0 1 0 1   5   Data    -, accessed</span><br /><span class="line">                    0 1 1 0   6   Data    Read/Write, expand-down</span><br /><span class="line">                    0 1 1 1   7   Data    -, accessed</span><br /><span class="line">                   <span class="ngb"> T C R A </span></span><br /><span class="line">                    1 0 0 0   8   Code    Execute-only</span><br /><span class="line">                    1 0 0 1   9   Code    -, accessed</span><br /><span class="line">                    1 0 1 0   A   Code    Execute/Read</span><br /><span class="line">                    1 0 1 1   B   Code    -, accessed</span><br /><span class="line">                    1 1 0 0   C   Code    Execute-only, conforming</span><br /><span class="line">                    1 1 0 1   D   Code    -, accessed</span><br /><span class="line">                    1 1 1 0   E   Code    Execute/Read-only, conforming</span><br /><span class="line">                    1 1 1 1   F   Code    -, accessed</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">    ──────────────────────────────────────────────────────────────────</span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">Note</span></span><br /><span class="line">    For compatibility, the 80386+ support all the 80286 segment</span><br /><span class="line">    descriptors. The only difference between the two formats are that</span><br /><span class="line">    the values of the type fields and the limit and base address</span><br /><span class="line">    fields have been expanded for the 80386+.</span><br /><span class="line"></span><br /><span class="line">    The 80286 system segment descriptors contain a 24-bit address and</span><br /><span class="line">    a 16-bit limit. The 80386+ system descriptors, on the other</span><br /><span class="line">    hand, have a 32-bit base address, a 20-bit limit, and a</span><br /><span class="line">    granularity bit. To tell the difference, if the upper word of the</span><br /><span class="line">    descriptor is zero, then it is an 80286-type descriptor.</span><br /><span class="line"></span><br /><span class="line">    ──────────────────────────────────────────────────────────────────</span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">Descriptor tables</span></span><br /><span class="line"></span><br /><span class="line">    Descriptor tables define all the segments used in the protected</span><br /><span class="line">    mode system. The 3 types of tables are:</span><br /><span class="line"></span><br /><span class="line">        ■ Global Descriptor Table     (GDT)</span><br /><span class="line">        ■ Local Descriptor Table      (LDT)</span><br /><span class="line">        ■ Interrupt Descriptor Table  (IDT)</span><br /><span class="line"></span><br /><span class="line">    Descriptor tables are variable-length memory arrays, with 8-byte</span><br /><span class="line">    entries that contain descriptors. In the 80386+, they range in</span><br /><span class="line">    size from 8 bytes to 64K, and each table holds up to 8192 8-byte</span><br /><span class="line">    descriptors. The upper 13 bits of a selector are used as an index</span><br /><span class="line">    into the descriptor table.</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">GDT</span></span><br /><span class="line">    Every protected mode 80386 system contains a Global Descriptor</span><br /><span class="line">    Table. The GDT holds descriptors that are available to all the</span><br /><span class="line">    tasks in a system. Except for descriptors that control interrupts</span><br /><span class="line">    or exceptions, the GDT can contain any other kind of segment</span><br /><span class="line">    descriptor.</span><br /><span class="line">    Generally, the GDT contains 3 types of descriptors: code and data</span><br /><span class="line">    segments used by the operating system, descriptors for the Local</span><br /><span class="line">    Descriptors in a system, and task state segments (TSS). The first</span><br /><span class="line">    slot of the GDT is not used; it corresponds to the null selector</span><br /><span class="line">    which defines a null pointer value.</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">LDT</span></span><br /><span class="line">    Operating systems are generally designed so that each task has a</span><br /><span class="line">    separate Local Descriptor Table. LDTs provide a way for isolating</span><br /><span class="line">    a given task&#39;s code and data segments from the rest of the</span><br /><span class="line">    operating system. The <span class="ngb">G</span>DT contains descriptors for segments that</span><br /><span class="line">    are common to all tasks. The LDT is associated with a given task</span><br /><span class="line">    and may contain only code, data, stack, task gate, and call gate</span><br /><span class="line">    descriptors.</span><br /><span class="line">    A segment cannot be accessed by a task if its segment descriptor</span><br /><span class="line">    does not exist either in the current LDT or the GDT. This both</span><br /><span class="line">    isolates and protects that task&#39;s segments, while still allowing</span><br /><span class="line">    global <span class="ngb">data</span> to be shared among tasks.</span><br /><span class="line">    Unlike the 48-bit GDTR and IDTR, the LDTR contains only a 16-bit</span><br /><span class="line">    selector which refers to an LDT descriptor in the GDT.</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">IDT</span></span><br /><span class="line">    The Interrupt Descriptor Table contains the descriptors that point</span><br /><span class="line">    to the location of up to 256 interrupt service routines. The IDT</span><br /><span class="line">    can only contain trap gates, task gates, and interrupt gates. The</span><br /><span class="line">    IDT should be at least 256 bytes in size so it can hold</span><br /><span class="line">    descriptors for the 32 Intel-reserved interrupts. Every interrupt</span><br /><span class="line">    used by the system <span class="ngb">must</span> have an entry in the IDT.</span><br /></pre>
  
  
  
    <nav class="seeAlso">
      <ul>
        <li>See Also:</li>
        
          <li><a href="x86-195957.html">Selectors</a></li>
        
          <li><a href="x86-213542.html">TSS</a></li>
        
          <li><a href="x86-185529.html">System address</a></li>
        
          <li><a href="x86-89671.html">LSL</a></li>
        
          <li><a href="x86-144694.html">SGDT</a></li>
        
          <li><a href="x86-72960.html">LAR</a></li>
        
      </ul>
    </nav>
  


      </article>

    </section>

  </body>

</html>

