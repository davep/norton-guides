





<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="generator" content="ng2web v1.1.0 (ngdb v1.1.0)">
    <link rel="stylesheet" type="text/css" href="x86-style.css">
    <title>iAPx86 » CPU » Protection, privilege</title>
    <meta name="description" content="iAPx86">
    <link rel="prev" href="x86-211438.html">
    <link rel="next" href="x86-217619.html">
    
  </head>

  <body>

    <header>
      <nav class="box">
        <ul>
          

<li><a href="../index.html">Guides</a></li>


          

<li><a href="x86-about.html">About</a></li>


          

<li><a href="x86-211438.html">Previous</a></li>


          

<li><a href="x86-190707.html">Up</a></li>


          

<li><a href="x86-217619.html">Next</a></li>


        </ul>
      </nav>
    </header>

    <section>

      <nav class="menu box">
        <ul>
            <li>CPU</li>
            <ul>
              <li><a href="index.html">Instruction set</a></li>
              <li><a href="x86-175915.html">Registers</a></li>
              <li><a href="x86-190707.html">Protection, privilege</a></li>
              <li><a href="x86-224627.html">Exceptions</a></li>
              <li><a href="x86-225699.html">Addressing modes</a></li>
              <li><a href="x86-229455.html">Opcodes</a></li>
              
            </ul>
            <li>FPU</li>
            <ul>
              <li><a href="x86-245307.html">Instruction set</a></li>
              <li><a href="x86-307843.html">Registers, data types</a></li>
              
            </ul>
            <li>MMX</li>
            <ul>
              <li><a href="x86-318646.html">Instruction set</a></li>
              
            </ul>
        </ul>
      </nav>

      <article class="box">
        
  
  
    <pre class="entry"><span class="line"></span><br /><span class="line"><span class="ngb">TSS - Task State Segment</span></span><br /><span class="line"></span><br /><span class="line">    A TSS is a data structure that holds the state of a task&#39;s virtual</span><br /><span class="line">    processor. The TSS is divided into two parts.</span><br /><span class="line"></span><br /><span class="line">    ──────────────────────────────────────────────────────────────────</span><br /><span class="line"></span><br /><span class="line">    The first class of information is the dynamic set that the</span><br /><span class="line">    processor updates with each switch from the task. This set</span><br /><span class="line">    includes the following:</span><br /><span class="line"></span><br /><span class="line">      ■ The selector of the TSS of the previously executing task (this</span><br /><span class="line">        is updated only when a return is expected)</span><br /><span class="line">      ■ Instruction pointer     EIP</span><br /><span class="line">      ■ Flags register          EFLAGS</span><br /><span class="line">      ■ General registers       EAX,ECX,EDX,EBX,ESP,EBP,ESI,EDI</span><br /><span class="line">      ■ Segment registers       ES,CS,SS,DS,FS,GS</span><br /><span class="line"></span><br /><span class="line">    ──────────────────────────────────────────────────────────────────</span><br /><span class="line"></span><br /><span class="line">    The second class of information in the TSS is a static set that</span><br /><span class="line">    the processor reads but does not change. This set includes fields</span><br /><span class="line">    that store the following:</span><br /><span class="line"></span><br /><span class="line">      ■ The stack definitions for level 0, 1, or 2 interrupt handlers</span><br /><span class="line">        that are to execute in the task&#39;s environment.</span><br /><span class="line">      ■ The selector of the task&#39;s LDT</span><br /><span class="line">      ■ The debug trap bit, T-bit, which causes the 80386 to raise a</span><br /><span class="line">        debug exception when a task switch occurs</span><br /><span class="line">      ■ The I/O map base</span><br /><span class="line"></span><br /><span class="line">    ──────────────────────────────────────────────────────────────────</span><br /><span class="line"></span><br /><span class="line">    A TSS may reside anywhere in the linear address space. The single</span><br /><span class="line">    caution is when the TSS spans a page boundary and the higher-</span><br /><span class="line">    addressed page is not present (exception generated).</span><br /><span class="line"></span><br /><span class="line">    When creating a new task, the operating system creates the TSS and</span><br /><span class="line">    initializes it to the values that the task should have when it</span><br /><span class="line">    begins execution. The information is updated when any of the</span><br /><span class="line">    values change.</span><br /><span class="line"></span><br /><span class="line">                <span class="ngb">Task State Segment</span></span><br /><span class="line">                <span class="ngb">Offset     [ bits 0..15 ][ bits 16..31 ]</span></span><br /><span class="line">                00h         -&gt; Prev. TSS       rr</span><br /><span class="line">                04h                    ESP0</span><br /><span class="line">                                 SS0           rr</span><br /><span class="line">                0Ch                    ESP1</span><br /><span class="line">                                 SS1           rr</span><br /><span class="line">                14h                    ESP2</span><br /><span class="line">                                 SS2           rr</span><br /><span class="line">                1Ch              rr            rr</span><br /><span class="line">                20h                    EIP</span><br /><span class="line">                24h                   EFLAGS</span><br /><span class="line">                28h              EAX,ECX,EDX,EBX</span><br /><span class="line">                38h              ESP,EBP,ESI,EDI</span><br /><span class="line">                48h              ES            rr</span><br /><span class="line">                4Ch              CS            rr</span><br /><span class="line">                50h              SS            rr</span><br /><span class="line">                54h              DS            rr</span><br /><span class="line">                58h              FS            rr</span><br /><span class="line">                5Ch              GS            rr</span><br /><span class="line">                60h              LDT           rr</span><br /><span class="line">                64h          T-bit, rr    I/O Bitmap Base</span><br /><span class="line">                   <span class="ngb">Note</span>: rr = Reserved, must be zero</span><br /><span class="line"></span><br /><span class="line">    ──────────────────────────────────────────────────────────────────</span><br /><span class="line"></span><br /><span class="line">    <span class="ngb">TSS descriptor</span></span><br /><span class="line">    Like all segments, the TSS is defined by a descriptor. This</span><br /><span class="line">    descriptor resides only in the Global Descriptor Table (GDT). An</span><br /><span class="line">    attempt to identify a TSS with a selector that has TI=1 (Table</span><br /><span class="line">    Indicator flag to indicate the current LDT) generates an exception.</span><br /><span class="line">    Also, even if it has access to a TSS descriptor, a procedure does</span><br /><span class="line">    not have the right to read or modify the TSS. Reading and changing</span><br /><span class="line">    can be done only with another descriptor that redefines the TSS as</span><br /><span class="line">    a data segment. An attempt to load a TSS descriptor into any of</span><br /><span class="line">    the segment registers causes an exception.</span><br /><span class="line"></span><br /><span class="line">                                             TSS descriptor (80386+)</span><br /><span class="line">    </span><br /><span class="line">     6               5       5       4       4     4 3             3</span><br /><span class="line">     3               5       1       7       3     0 9             2</span><br /><span class="line">    ┌───────────────┬─┬─┬─┬─┬───────┬─┬───┬─────────┬───────────────┐</span><br /><span class="line">    │ Base 31..24   │G│0│0│A│Seg lim│P│DPL│  Type   │ Base 23..16   │</span><br /><span class="line">    │               │ │ │ │V│ 19..16│ │   │0 1 0 B 1│               │</span><br /><span class="line">    ├───────────────┴─┴─┴─┴─┴───────┼─┴───┴─┴─┴─┴─┴─┴───────────────┤</span><br /><span class="line">    │ Base Address 15..0            │ Segment Limit 15..0           │</span><br /><span class="line">    └───────────────────────────────┴───────────────────────────────┛</span><br /><span class="line">     3               2               1</span><br /><span class="line">     1               3               5               7             0</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">    Tasks are <span class="ngu">not</span> re-entrant because both the LDT selector and CR3 for</span><br /><span class="line">    the task are stored in the TSS. The B-bit (busy) of the TYPE field</span><br /><span class="line">    allows the processor to detect an attempt to switch to a task that</span><br /><span class="line">    is already busy. A TYPE code of 09h shows the task is not-busy. A</span><br /><span class="line">    TYPE code of 0Bh indicates it is busy.</span><br /><span class="line"></span><br /><span class="line">    The BASE, LIMIT, and DPL fields and the G-bit (granularity) and</span><br /><span class="line">    P-bit (present) have functions similar to their counterparts in</span><br /><span class="line">    data-segment descriptors. The BASE defines the location of the</span><br /><span class="line">    segment within the linear address space. The LIMIT defines the</span><br /><span class="line">    size of the segment. With the TSS descriptor, the LIMIT must</span><br /><span class="line">    contain a value of 103 or higher because the TSS itself requires</span><br /><span class="line">    104 bytes. An attempt to switch to a task whose LIMIT has less</span><br /><span class="line">    than 103 causes an exception.</span><br /></pre>
  
  
  
    <nav class="seeAlso">
      <ul>
        <li>See Also:</li>
        
          <li><a href="x86-211438.html">Multitasking</a></li>
        
          <li><a href="x86-195957.html">Selectors</a></li>
        
          <li><a href="x86-197219.html">Descriptors</a></li>
        
          <li><a href="x86-217619.html">Task switch</a></li>
        
      </ul>
    </nav>
  


      </article>

    </section>

  </body>

</html>

