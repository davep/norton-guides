





<!DOCTYPE html>
<html lang="en">

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="generator" content="ng2web v1.5.1 (ngdb v1.2.0)">
    <link rel="stylesheet" type="text/css" href="rbint-style.css">
    <title>Ralf Brown » Lists » Interrupts</title>
    <meta name="description" content="Ralf Brown">
    <link rel="prev" href="rbint-2300547.html">
    <link rel="next" href="rbint-2309281.html">
    
  </head>

  <body>

    <header>
      <nav class="box">
        <ul>
          

<li><a href="../index.html">Guides</a></li>


          

<li><a href="rbint-about.html">About</a></li>


          

<li><a href="rbint-2300547.html">Previous</a></li>


          

<li><a href="rbint-2204700.html">Up</a></li>


          

<li><a href="rbint-2309281.html">Next</a></li>


        </ul>
      </nav>
    </header>

    <div id="body">

      
        <nav class="menu box">
          <ul>
              <li>Lists</li>
              <li>
                <ul>
                  <li><a href="index.html">Comments</a></li>
                  <li><a href="rbint-7995.html">Interrupts</a></li>
                  <li><a href="rbint-15401.html">Glossary</a></li>
                  <li><a href="rbint-64347.html">Memory</a></li>
                  <li><a href="rbint-180090.html">CMOS</a></li>
                  <li><a href="rbint-250757.html">86 Bugs</a></li>
                  
                </ul>
              </li>
          </ul>
        </nav>
      

      <div id="entry" class="box">
        
  
  
    <pre class="entry"><span class="line"></span><br><span class="line"><span class="ngu">Int 21 Fn 4402  - Advanced Scsi Programming Interface (aspi) - Interface </span>  [<span class="ngb">d</span>]</span><br><span class="line"></span><br><span class="line">   AX = 4402h</span><br><span class="line">   BX = file handle for device &#34;SCSIMGR$&#34;</span><br><span class="line">   CX = 0004h or 0005h (refer to notes below)</span><br><span class="line">   DS:DX -&gt; buffer for result (see #1139), set to zeros before call</span><br><span class="line"></span><br><span class="line"><span class="ngb">Return:</span> CF clear if successful</span><br><span class="line">       AX = 0004h or 0005h (refer to notes below)</span><br><span class="line">   CF set on error</span><br><span class="line">       AX = error code (01h,05h,06h,0Dh) (see #1366 at AH=59h/BX=0000h)</span><br><span class="line"></span><br><span class="line"><span class="ngb">Notes:</span> the variant of the call requesting five bytes is an UNDOCUMENTED</span><br><span class="line">     extension supported by Adaptec&#39;s ASPI2DOS.SYS, ASPI4DOS.SYS, and</span><br><span class="line">     ASPI7DOS.SYS; if made of a host manager which does not support the</span><br><span class="line">     variant, only four bytes will be returned.  If the variant is</span><br><span class="line">     supported, Adaptec&#39;s WINASPI.DLL assumes that the host manager is</span><br><span class="line">     an &#34;advanced&#34; one which operates in either real or protected mode</span><br><span class="line">     (and thus does not require a DPMI INT 31/AX=0301h call to be invoked</span><br><span class="line">     from protected mode).  Support of the five-byte variant also appears</span><br><span class="line">     to imply that an advanced ASPI host manager uses no temporary</span><br><span class="line">     storage space except the SRB (see #1141) and the stack, and that it</span><br><span class="line">     is fully reentrant.</span><br><span class="line">   if called with a standard request for four bytes, even Adaptec&#39;s</span><br><span class="line">     advanced drivers return only the requested four bytes containing the</span><br><span class="line">     ASPI entry point address</span><br><span class="line">   the function address is called with the address of a SCSI Request</span><br><span class="line">     Block (see #1141) on the stack and the caller must clean up the</span><br><span class="line">     stack</span><br><span class="line"></span><br><span class="line"><span class="ngb">See Also:</span> AX=440Ch&#34;ASPITAPE&#34;,INT 11/AH=FFh&#34;WD7000&#34;</span><br><span class="line"></span><br><span class="line">Format of ASPI IOCTL result:</span><br><span class="line">Offset Size    Description (Table 1139)</span><br><span class="line"> 00h   DWORD   function address</span><br><span class="line"> 04h   BYTE    number of SCSI host adapters supported by host manager</span><br><span class="line"></span><br><span class="line">(Table 1140)</span><br><span class="line">Values for ASPI request number:</span><br><span class="line"> 00h   &#34;HA_INQ&#34;    host adapter inquiry / extended host adapter inquiry</span><br><span class="line"> 01h   &#34;GET_TYPE&#34;  get device type</span><br><span class="line"> 02h   &#34;EXEC_SIO&#34;  execute SCSI I/O</span><br><span class="line"> 03h   &#34;ABORT_SRB&#34; abort SRB</span><br><span class="line"> 04h   &#34;RESET_DEV&#34; reset SCSI device</span><br><span class="line"> 05h   &#34;SET_HAPRMS&#34;    set host adapter parameters</span><br><span class="line"> 06h   get disk drive information</span><br><span class="line"></span><br><span class="line">Format of SCSI Request Block (64 bytes):</span><br><span class="line">Offset Size    Description (Table 1141)</span><br><span class="line"> 00h   BYTE    request number (see #1140)</span><br><span class="line"> 01h   BYTE    request status (see #1142)</span><br><span class="line"> 02h   BYTE    host adapter ID</span><br><span class="line"> 03h   BYTE    request flags (see #1143)</span><br><span class="line"> 04h   DWORD   reserved (0)</span><br><span class="line">---request 00h---</span><br><span class="line"> 08h   BYTE    (ret) number of host adapters</span><br><span class="line"> 09h   BYTE    (ret) target adapter ID</span><br><span class="line"> 0Ah 16 BYTEs  (ret) SCSI manager ID</span><br><span class="line"> 1Ah 16 BYTEs  (ret) host adapter ID</span><br><span class="line"> 2Ah 16 BYTEs  (ret) host adapter-unique parameters</span><br><span class="line">---extended request 00h---</span><br><span class="line"> 04h  2 BYTEs  (call) extended request signature 55h AAh</span><br><span class="line">       (ret) if extended request supported, reply AAh 55h</span><br><span class="line"> 06h   WORD    (call) length of extended buffer at offset 3Ah</span><br><span class="line">       (ret) number of bytes returned in extended buffer</span><br><span class="line"> 08h   BYTE    (ret) number of host adapters</span><br><span class="line"> 09h   BYTE    (ret) target adapter ID</span><br><span class="line"> 0Ah 16 BYTEs  (ret) SCSI manager ID</span><br><span class="line"> 1Ah 16 BYTEs  (ret) host adapter ID</span><br><span class="line"> 2Ah 16 BYTEs  (ret) host adapter-unique parameters</span><br><span class="line"> 3Ah  N BYTEs  extended buffer</span><br><span class="line">       3Ah WORD    features (see #1144)</span><br><span class="line">       3Ch WORD    maximum scatter/gather list length</span><br><span class="line">       3Eh DWORD   maximum SCIS data transfer size (0 = unlimited)</span><br><span class="line">---request 01h---</span><br><span class="line"> 08h   BYTE    target ID</span><br><span class="line"> 09h   BYTE    logical unit number</span><br><span class="line"> 0Ah   BYTE    (ret) device type (see #1147)</span><br><span class="line">---request 02h---</span><br><span class="line"> 08h   BYTE    target ID</span><br><span class="line"> 09h   BYTE    logical unit number</span><br><span class="line"> 0Ah   DWORD   data allocation length</span><br><span class="line">       (ret) residual byte length (if supported and requested)</span><br><span class="line"> 0Eh   BYTE    sense allocation length</span><br><span class="line"> 0Fh   DWORD   data buffer pointer</span><br><span class="line"> 13h   DWORD   next request pointer (for linking)</span><br><span class="line"> 17h   BYTE    CDB length</span><br><span class="line"> 18h   BYTE    (ret) host adapter status (see #1141)</span><br><span class="line"> 19h   BYTE    (ret) target status (see #1146)</span><br><span class="line"> 1Ah   DWORD   post routine address (see #1153)</span><br><span class="line"> 1Eh   WORD    real mode Post DS</span><br><span class="line"> 20h   DWORD   SRB pointer</span><br><span class="line"> 24h   WORD    reserved</span><br><span class="line"> 26h   DWORD   SRB physical address</span><br><span class="line"> 2Ah 22 BYTEs  SCSIMGR$ workspace</span><br><span class="line"> 40h  N BYTEs  CCB, including sense data (20-24 bytes)</span><br><span class="line">---request 03h---</span><br><span class="line"> 08h   DWORD   address of SRB to abort</span><br><span class="line">---request 04h---</span><br><span class="line"> 08h   BYTE    target ID</span><br><span class="line"> 09h   BYTE    logical unit number</span><br><span class="line"> 0Ah 14 BYTEs  reserved</span><br><span class="line"> 18h   BYTE    (ret) host adapter status (see #1145)</span><br><span class="line"> 19h   BYTE    (ret) target status (see #1146)</span><br><span class="line"> 1Ah   DWORD   post routine address</span><br><span class="line"> 1Eh 34 BYTEs  workspace</span><br><span class="line">---request 05h---</span><br><span class="line"> 08h 16 BYTEs  host adapter-unique parameters</span><br><span class="line">---request 06h---</span><br><span class="line"> 08h   BYTE    target ID</span><br><span class="line"> 09h   BYTE    logical unit number</span><br><span class="line"> 0Ah   BYTE    disk drive flags (see #1148)</span><br><span class="line"> 0Bh   BYTE    INT 13h drive number</span><br><span class="line"> 0Ch   BYTE    preferred head number translation</span><br><span class="line"> 0Dh   BYTE    preferred sector size translation</span><br><span class="line"> 0Eh 10 BYTEs  reserved</span><br><span class="line"></span><br><span class="line"><span class="ngb">See Also:</span> #1149</span><br><span class="line"></span><br><span class="line">(Table 1142)</span><br><span class="line">Values for ASPI request status:</span><br><span class="line"> 00h   not done yet</span><br><span class="line"> 01h   completed successfully</span><br><span class="line"> 02h   aborted by host</span><br><span class="line"> 04h   SCSI I/O error</span><br><span class="line"> 80h   invalid</span><br><span class="line"> 81h   no adapter</span><br><span class="line"> 82h   no device attached</span><br><span class="line"> else  status</span><br><span class="line"></span><br><span class="line"><span class="ngb">See Also:</span> #1141</span><br><span class="line"></span><br><span class="line">Bitfields for ASPI request flags:</span><br><span class="line">Bit(s) Description (Table 1143)</span><br><span class="line"> 0 posting enabled</span><br><span class="line"> 1 linking enabled</span><br><span class="line"> 2 residual byte length reported in Data Allocation Length field</span><br><span class="line"> 3 transfer from SCSI target to host</span><br><span class="line"> 4 transfer from host to SCSI target</span><br><span class="line"> 5 scatter/gather</span><br><span class="line"> 7-6   reserved</span><br><span class="line"></span><br><span class="line"><span class="ngb">Note:</span>  no data is transferred if both bits 3 and 4 are set; if neither is</span><br><span class="line">     set, the direction is determined by the SCSI command</span><br><span class="line"></span><br><span class="line"><span class="ngb">See Also:</span> #1141</span><br><span class="line"></span><br><span class="line">Bitfields for ASPI extended features:</span><br><span class="line">Bit(s) Description (Table 1144)</span><br><span class="line"> 0 scatter/gather supported</span><br><span class="line"> 1 residual byte length reported</span><br><span class="line"> 2 Wide SCSI 16 host adapter</span><br><span class="line"> 3 Wide SCSI 32 host adapter</span><br><span class="line"> 15-4  reserved</span><br><span class="line"></span><br><span class="line"><span class="ngb">See Also:</span> #1141</span><br><span class="line"></span><br><span class="line">(Table 1145)</span><br><span class="line">Values for host adapter status:</span><br><span class="line"> 00h   no error detected</span><br><span class="line"> 11h   select timeout</span><br><span class="line"> 12h   data overrun</span><br><span class="line"> 13h   bus error</span><br><span class="line"> 14h   bus failure</span><br><span class="line"></span><br><span class="line">(Table 1146)</span><br><span class="line">Values for target status:</span><br><span class="line"> 00h   no status</span><br><span class="line"> 02h   sense data stored in SRB</span><br><span class="line"> 08h   target busy</span><br><span class="line"> 18h   reservation error</span><br><span class="line"></span><br><span class="line">(Table 1147)</span><br><span class="line">Values for device type:</span><br><span class="line"> 00h   disk drive</span><br><span class="line"> 01h   tape drive (streamer)</span><br><span class="line"> 02h   printer</span><br><span class="line"> 03h   processor</span><br><span class="line"> 04h   WORM drive</span><br><span class="line"> 05h   CD-ROM drive</span><br><span class="line"> 06h   scanner</span><br><span class="line"> 07h   optical drive</span><br><span class="line"> 08h   autochanger</span><br><span class="line"> 09h   communications device</span><br><span class="line"></span><br><span class="line">(Table 1148)</span><br><span class="line">Values for disk drive flags:</span><br><span class="line"> 00h   no INT 13 access</span><br><span class="line"> 01h   INT 13 with DOS access</span><br><span class="line"> 02h   INT 13 without DOS access</span><br><span class="line"> 03h   invalid flags</span><br><span class="line"></span><br><span class="line">Format of CCB:</span><br><span class="line">Offset Size    Description (Table 1149)</span><br><span class="line"> 00h   BYTE    command code (see #1150)</span><br><span class="line"> 01h   BYTE    flags</span><br><span class="line">       bits 4-0: vary by function</span><br><span class="line">       bits 7-5: logical unit number</span><br><span class="line"> 02h   BYTE    &#34;adr_1&#34;</span><br><span class="line"> 03h   BYTE    &#34;adr_0&#34;</span><br><span class="line"> 04h   BYTE    length</span><br><span class="line"> 05h   BYTE    control</span><br><span class="line">   ...</span><br><span class="line"> 06h/0Ah 14 BYTEs buffer for sense data (see #1151)</span><br><span class="line"></span><br><span class="line"><span class="ngb">See Also:</span> #1141</span><br><span class="line"></span><br><span class="line">(Table 1150)</span><br><span class="line">Values for CCB command code:</span><br><span class="line"> 00h   test unit ready</span><br><span class="line"> 01h   rewind</span><br><span class="line"> 03h   request sense data</span><br><span class="line"> 05h   get block size limits</span><br><span class="line"> 08h   Group 0 read</span><br><span class="line"> 0Ah   Group 0 write</span><br><span class="line"> 10h   write file marks</span><br><span class="line"> 11h   SCSI Space (set position?)</span><br><span class="line"> 12h   SCSI Inquire</span><br><span class="line"> 15h   set mode information</span><br><span class="line"> 16h   reserve SCSI device</span><br><span class="line"> 17h   release SCSI device</span><br><span class="line"> 19h   erase</span><br><span class="line"> 1Ah   request mode information</span><br><span class="line"> 1Bh   load/unload media</span><br><span class="line"> 1Dh   request target self-check</span><br><span class="line"> 24h   set window parameters</span><br><span class="line"> 25h   get window parameters</span><br><span class="line"> 28h   Group 1 read</span><br><span class="line"> 2Ah   Group 1 write</span><br><span class="line"> 31h   document feeder control</span><br><span class="line"> 34h   get scan data status</span><br><span class="line">---vendor-specific commands---</span><br><span class="line"> D3h   get document feeder status</span><br><span class="line"> D4h   set document feeder mode</span><br><span class="line"></span><br><span class="line">Format of sense data:</span><br><span class="line">Offset Size    Description (Table 1151)</span><br><span class="line"> 00h   BYTE    error code (bit 7 set if valid)</span><br><span class="line"> 01h   BYTE    segment number</span><br><span class="line"> 02h   BYTE    sense key</span><br><span class="line">       bit 6: EOM</span><br><span class="line">       bit 5: ILI</span><br><span class="line">       bits 0-3: sense key (see #1152)</span><br><span class="line"> 03h  4 BYTEs  information bytes</span><br><span class="line"> 07h   BYTE    additional sense length (0Ah)</span><br><span class="line"> 08h  4 BYTEs  command-specific information</span><br><span class="line"> 0Ch   BYTE    additional sense code</span><br><span class="line"> 0Dh   BYTE    additional sense code qualifier</span><br><span class="line"> 0Eh   BYTE    field replaceable unit code</span><br><span class="line"> 0Fh  3 BYTEs  sense key specific bytes</span><br><span class="line"></span><br><span class="line">(Table 1152)</span><br><span class="line">Values for sense key:</span><br><span class="line"> 00h   no sense data</span><br><span class="line"> 02h   SCSI unit not ready</span><br><span class="line"> 03h   media error</span><br><span class="line"> 04h   unrecoverable hardware error</span><br><span class="line"> 05h   illegal parameter in CDB</span><br><span class="line"> 06h   target has been reset</span><br><span class="line"> 0Bh   target aborted command</span><br><span class="line"></span><br><span class="line">(Table 1153)</span><br><span class="line">Values APSI post function is called with:</span><br><span class="line">   STACK:  DWORD -&gt; SRB (see #1141) which completed</span><br><span class="line">   interrupts disabled</span><br><span class="line"></span><br><span class="line"><span class="ngb">Return:</span> EBP, EBX, ESI, EDI must be preserved</span><br><span class="line">   interrupts disabled</span><br><span class="line"></span><br><span class="line"><span class="ngb">Note:</span>  the post function may issue any APSI function except an abort; it</span><br><span class="line">     should complete as quickly as possible</span><br></pre>
  
  
  


      </div>

    </div>

    
      <footer>
        <nav class="box">
          <dl>
            <dt>Generated</dt><dd>2025-12-13 13:34:52</dd>
            <dt>Generator</dt><dd><a href="https://ng2web.davep.dev">ng2web v1.5.1 (ngdb v1.2.0)</a></dd>
          </dl>
        </nav>
      </footer>
    

  </body>

</html>

